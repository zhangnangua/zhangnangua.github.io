<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>Kotlin flow_shareFlow_stateFlow</title><link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color: #ffffff; --text-color: #333333; --select-text-bg-color: #B5D6FC; --select-text-font-color: auto; --monospace: "Lucida Console",Consolas,"Courier",monospace; --title-bar-height: 20px; }
.mac-os-11 { --title-bar-height: 28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.42857143; overflow-x: hidden; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; tab-size: 4; background-position: inherit; background-repeat: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font-family: inherit; font-size: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right-width: 0px; background-color: inherit; }
.CodeMirror-linenumber { }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; position: relative !important; background-position: inherit; background-repeat: inherit; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; background-position: 0px 0px; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background-color: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background-color: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; }
a.md-print-anchor { white-space: pre !important; border: none !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; text-shadow: initial !important; background-position: 0px 0px !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none 0s ease 0s; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom-width: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background-color: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
mark .md-meta { color: rgb(0, 0, 0); opacity: 0.3 !important; }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-require-zoom-fix foreignObject { font-size: var(--mermaid-font-zoom); }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit; background-repeat: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; white-space: nowrap; background-position: inherit; background-repeat: inherit; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit; background-repeat: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit; background-repeat: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; border: none !important; background-position: 0px 0px !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; background-position: 0px 0px; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right-width: 30px; border-right-style: solid; border-right-color: transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right-style: none; width: auto; }
.CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right-style: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background-color: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/* open-sans-regular - latin-ext_latin */
  /* open-sans-italic - latin-ext_latin */
    /* open-sans-700 - latin-ext_latin */
    /* open-sans-700italic - latin-ext_latin */
  html {
    font-size: 16px;
}

body {
    font-family: "Open Sans","Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
  	margin: 0 auto;
  	padding: 30px;
    padding-bottom: 100px;
}

@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}

/*@media print {
    .typora-export h1,
    .typora-export h2 {
        border-bottom: none;
        padding-bottom: initial;
    }

    .typora-export h1::after,
    .typora-export h2::after {
        content: "";
        display: block;
        height: 100px;
        margin-top: -96px;
        border-top: 1px solid #eee;
    }
}*/

h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border-top: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table th:first-child,
table td:first-child {
    margin-top: 0;
}
table th:last-child,
table td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.md-lang {
    color: #b4654d;
}

.html-for-mac .context-menu {
    --item-hover-bg-color: #E6F0FE;
}

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}

 :root {--mermaid-font-zoom:1em ;} 
</style>
</head>
<body class='typora-export'>
<div id='write'  class=''><h1><a name="flow" class="md-header-anchor"></a><span>Flow</span></h1><h2><a name="flowç®€ä»‹" class="md-header-anchor"></a><span>Flowç®€ä»‹</span></h2><p><code>Flow</code><span>æ˜¯ä»€ä¹ˆâ“</span></p><blockquote><p><span>A suspending function asynchronously returns a single value, but how can we return multiple asynchronously computed values? This is where Kotlin Flows come in.</span></p></blockquote><p><span>ç®€å•æ¥è¯´ï¼šæŒ‚èµ·å‡½æ•°å¯ä»¥å¼‚æ­¥å¤„ç†å¹¶ä¸”è¿”å›å•ä¸ªå€¼ï¼Œä½†æ˜¯å¦‚æœè¦è¿”å›å¤šä¸ªå¼‚æ­¥è®¡ç®—çš„å€¼å‘¢?è¿™å°±æ˜¯</span><code>flow</code><span>çš„ç”¨å¤„äº†ã€‚ä¸‹é¢ä»</span><code>å¦‚ä½•è¿”å›å¤šä¸ªå€¼</code><span>å¼€å§‹ä¸€æ­¥ä¸€æ­¥æ·±å…¥äº†è§£</span><code>flow</code><span>ã€‚</span></p><h2><a name="å¦‚ä½•è¿”å›å¤šä¸ªå€¼" class="md-header-anchor"></a><span>å¦‚ä½•è¿”å›å¤šä¸ªå€¼ï¼Ÿ</span></h2><h3><a name="for-example-1--list" class="md-header-anchor"></a><span>For example 1 : list</span></h3><p><span>æˆ‘ä»¬å¯ä»¥æœ‰ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ªåŒ…å«ä¸‰ä¸ªæ•°å­—çš„åˆ—è¡¨ï¼Œç„¶åä½¿ç”¨ forEach å°†å®ƒä»¬å…¨éƒ¨æ‰“å°å‡ºæ¥ï¼š</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">fun simple(): List&lt;Int&gt; = listOf(1, 2, 3)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">fun main() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  simple().forEach { value -&gt; println(value) } </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><span>ç»“æœ</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">1</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">3</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><h3><a name="for-example-2--sequences" class="md-header-anchor"></a><span>For example 2 : Sequences</span></h3><p><span>å¦‚æœæˆ‘ä»¬éœ€è¦é˜»å¡ä»£ç æ¥è®¡ç®—æ•°å­—ï¼ˆæ¯æ¬¡è®¡ç®—éœ€è¦ 100 æ¯«ç§’ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åºåˆ—æ¥è¡¨ç¤ºæ•°å­—ï¼š</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>â€‹</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">simple</span>(): <span class="cm-variable">Sequence</span><span class="cm-operator">&lt;</span><span class="cm-variable">Int</span><span class="cm-operator">&gt;</span> <span class="cm-operator">=</span> <span class="cm-variable">sequence</span> { <span class="cm-comment">// sequence æ„å»º</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-number">1.</span>.<span class="cm-number">3</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//æ¨¡æ‹Ÿè®¡ç®—è€—æ—¶</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">Thread</span>.<span class="cm-variable">sleep</span>(<span class="cm-number">100</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"send$i"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// yield ä¸‹ä¸€ä¸ªå€¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">yield</span>(<span class="cm-variable">i</span>) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">simple</span>().<span class="cm-variable">forEach</span> { <span class="cm-variable">value</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">println</span>(<span class="cm-string">"receiver$value"</span>) }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"end"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 308px;"></div><div class="CodeMirror-gutters" style="display: none; height: 308px;"></div></div></div></pre><p><span>ç»“æœ</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">send1</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">receiver1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">send2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">receiver2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">send3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">receiver3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">end</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><h3><a name="for-example-3--å¼‚æ­¥è®¡ç®—å¹¶è¿”å›å¼•å…¥flow" class="md-header-anchor"></a><span>For example 3 : å¼‚æ­¥è®¡ç®—å¹¶è¿”å›ï¼Ÿå¼•å…¥flow</span></h3><p><span>æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥å¼‚æ­¥è®¡ç®—å¤šä¸ªå€¼å¹¶ä¸”è¿”å›çš„å—ï¼Ÿå½“ç„¶å¯ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŒ‚èµ·å‡½æ•°ï¼Œä½¿è®¡ç®—è¿‡ç¨‹åœ¨å¼‚æ­¥çº¿ç¨‹æ‰§è¡Œï¼Œæœ€ç»ˆä»¥listçš„å½¢å¼è¿”å›ã€‚</span></p><p><span>ä¸¾ä¸ªğŸŒ°</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">suspend</span> <span class="cm-keyword">fun</span> <span class="cm-def">simple</span>(): <span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable">Int</span><span class="cm-operator">&gt;</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">//æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">1000</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">listOf</span>(<span class="cm-number">1</span>, <span class="cm-number">2</span>, <span class="cm-number">3</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>()<span class="cm-operator">=</span> <span class="cm-variable">runBlocking</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">job</span> <span class="cm-operator">=</span> <span class="cm-variable">launch</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">simple</span>().<span class="cm-variable">forEach</span> { <span class="cm-variable">value</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">println</span>(<span class="cm-variable">value</span>) }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">launch</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"other operate"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">job</span>.<span class="cm-variable">join</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 330px;"></div><div class="CodeMirror-gutters" style="display: none; height: 330px;"></div></div></div></pre><p><span>ç»“æœï¼šä»ç»“æœæ¥çœ‹ï¼Œè€—æ—¶æ“ä½œå¹¶æ²¡æœ‰å½±å“ä¸»çº¿ç¨‹çš„è¿è¡ŒğŸ˜</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">other operate</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><p><span>ä½†æ˜¯ï¼Œè¿™æ ·å°±å¤Ÿäº†å—ï¼Ÿno no no ï¼ğŸ™…â€â™€ï¸</span></p><p><span>ä½¿ç”¨</span><code>list</code><span>æ„å‘³ç€æˆ‘ä»¬åªèƒ½ä¸€æ¬¡æ€§çš„è¿”å›æ‰€æœ‰çš„å€¼ã€‚æ‰€ä»¥ä¸ºäº†è¡¨ç¤ºæµçš„è®¡ç®—ï¼Œå¼•å…¥äº†</span><code>flow</code><span>ã€‚å°±åƒå¯ä»¥ä½¿ç”¨</span><code>Sequence</code><span>ç±»å‹ç”¨äºåŒæ­¥è®¡ç®—å€¼ä¸€æ ·ã€‚</span></p><h2><a name="flowä½¿ç”¨" class="md-header-anchor"></a><span>Flowä½¿ç”¨</span></h2><h3><a name="flow-ç®€å•ä½¿ç”¨" class="md-header-anchor"></a><span>Flow ç®€å•ä½¿ç”¨</span></h3><p><span>ä¸Šé¢ä»‹ç»äº†</span><code>flow</code><span>è¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¼€å§‹ä½¿ç”¨èµ·æ¥å§ã€‚</span></p><p><span>å…ˆçœ‹ä¸€ä¸ªç®€å•çš„ğŸŒ°</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">simple</span>(): <span class="cm-variable">Flow</span><span class="cm-operator">&lt;</span><span class="cm-variable">Int</span><span class="cm-operator">&gt;</span> <span class="cm-operator">=</span> <span class="cm-variable">flow</span> { <span class="cm-comment">// flow æ„å»º</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-number">1.</span>.<span class="cm-number">3</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//æ¨¡æ‹Ÿå¼‚æ­¥è€—æ—¶è®¡ç®—</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">100</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//å‘å°„å€¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-variable">i</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>() <span class="cm-operator">=</span> <span class="cm-variable">runBlocking</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// launch ä¸€ä¸ªåç¨‹ åŒæ—¶å»¶æ—¶100æ¯«ç§’æ‰“å° æ ¡éªŒä¸»çº¿ç¨‹æ˜¯å¦é˜»å¡</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">launch</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">k</span> <span class="cm-keyword">in</span> <span class="cm-number">1.</span>.<span class="cm-number">3</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"I'm not blocked $k"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//ä¸»çº¿ç¨‹åœ¨è¿™ä¸ªæ—¶é—´æ®µå¯ä»¥å¹²åˆ«çš„äº‹æƒ…</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">100</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// collect flow value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">simple</span>().<span class="cm-variable">collect</span> { <span class="cm-variable">println</span>(<span class="cm-variable">it</span>) }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 462px;"></div><div class="CodeMirror-gutters" style="display: none; height: 462px;"></div></div></div></pre><p><span>ç»“æœï¼šé€šè¿‡çº¿ç¨‹æ‰“å° </span><code>I&#39;m not blocked</code><span>è¯æ˜å¼‚æ­¥è®¡ç®—ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œè®¡ç®—æˆåŠŸä¹‹åä¼šresumeåˆ°collecté‡Œé¢ç»§ç»­æ‰§è¡Œã€‚</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">I</span><span class="cm-string">'m not blocked 1</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">I'</span><span class="cm-variable">m</span> <span class="cm-variable">not</span> <span class="cm-variable">blocked</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">I</span><span class="cm-string">'m not blocked 3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">3</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><span>é€šè¿‡ä¸Šè¿°ä»£ç ï¼Œéœ€è¦æ³¨æ„ä¸€ä¸‹å‡ ç‚¹ï¼šğŸ™†â€â™€ï¸</span></p><ul><li><span>ä½¿ç”¨</span><code>flow</code><span>ä»£ç å—æ„å»ºå‡ºæ¥çš„ç±»å‹ä¸º</span><code>Flow</code></li><li><code>flow</code><span>ä»£ç å—é‡Œé¢å…è®¸å†™æŒ‚èµ·å‡½æ•°ã€‚æ¯”å¦‚ä¸Šé¢çš„ï¼Œ</span><code>delay</code><span> </span><code>emit</code><span>ã€‚</span></li><li><span>ä½¿ç”¨</span><code>emit</code><span>è¿›è¡Œå€¼çš„å‘å°„ï¼Œä½¿ç”¨</span><code>collect</code><span>è¿›è¡Œå€¼çš„æ”¶é›†</span></li></ul><h3><a name="flow-æ„å»º" class="md-header-anchor"></a><span>Flow æ„å»º</span></h3><p><span>é™¤äº†ä¸Šé¢ä½¿ç”¨çš„</span><code>flow{}</code><span>è¿›è¡Œæ„å»ºä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–çš„æ–¹å¼è¿›è¡Œæ„å»ºã€‚</span></p><ol start='' ><li><p><span>ä½¿ç”¨</span><code>flowOf</code><span>å¯ä»¥å®šä¹‰ä¸€ç»„å›ºå®šçš„å€¼</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">simple</span>(): <span class="cm-variable">Flow</span><span class="cm-operator">&lt;</span><span class="cm-variable">Int</span><span class="cm-operator">&gt;</span> <span class="cm-operator">=</span> <span class="cm-variable">flowOf</span>(<span class="cm-number">1</span>, <span class="cm-number">2</span>, <span class="cm-number">3</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre></li><li><p><span>å¯ä»¥ä½¿ç”¨ </span><code>asFlow()</code><span> æ‰©å±•å‡½æ•°å°†å„ç§é›†åˆå’Œåºåˆ—è½¬æ¢ä¸ºæµã€‚</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// å°†listè½¬æ¢ä¸ºflow</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">listOf</span>(<span class="cm-number">1</span>,<span class="cm-number">2</span>,<span class="cm-number">3</span>).<span class="cm-variable">asFlow</span>().<span class="cm-variable">collect</span> { <span class="cm-variable">value</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">println</span>(<span class="cm-variable">value</span>) }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre></li></ol><h3><a name="flow-å†·æµ" class="md-header-anchor"></a><span>Flow å†·æµ</span></h3><p><span>Flowæ˜¯å†·æµï¼Œæ„å»ºå™¨ä»£ç åœ¨è°ƒç”¨collectä¹‹å‰æ˜¯ä¸ä¼šè¿›è¡Œè°ƒç”¨çš„ï¼Œå¯¹äºå¤šä¸ªè°ƒç”¨è€…ï¼Œéƒ½ä¼šé‡æ–°èµ°ä¸€éæ„å»ºå™¨çš„ä»£ç ã€‚</span></p><p><span>åºŸè¯ä¸å¤šè¯´ï¼Œä¸ŠğŸŒ°</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">simple</span>(): <span class="cm-variable">Flow</span><span class="cm-operator">&lt;</span><span class="cm-variable">Int</span><span class="cm-operator">&gt;</span> <span class="cm-operator">=</span> <span class="cm-variable">flow</span> { </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"Flow started"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-number">1.</span>.<span class="cm-number">3</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">100</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-variable">i</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>() <span class="cm-operator">=</span> <span class="cm-variable">runBlocking</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"Calling simple function..."</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">flow</span> <span class="cm-operator">=</span> <span class="cm-variable">simple</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"Calling collect..."</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">flow</span>.<span class="cm-variable">collect</span> { <span class="cm-variable">value</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">println</span>(<span class="cm-variable">value</span>) } </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"Calling collect again..."</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">flow</span>.<span class="cm-variable">collect</span> { <span class="cm-variable">value</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">println</span>(<span class="cm-variable">value</span>) } </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 352px;"></div><div class="CodeMirror-gutters" style="display: none; height: 352px;"></div></div></div></pre><p><span>ç»“æœ</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Calling</span> <span class="cm-variable">simple</span> <span class="cm-variable">function</span>...</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Calling</span> <span class="cm-variable">collect</span>...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Flow</span> <span class="cm-variable">started</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Calling</span> <span class="cm-variable">collect</span> <span class="cm-variable">again</span>...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Flow</span> <span class="cm-variable">started</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 264px;"></div><div class="CodeMirror-gutters" style="display: none; height: 264px;"></div></div></div></pre><p><span>æ¯æ¬¡æ”¶é›†æµæ—¶éƒ½ä¼šå¼€å§‹ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å†æ¬¡è°ƒç”¨ collect æ—¶ä¼šçœ‹åˆ°â€œFlow startedâ€çš„åŸå› ã€‚</span></p><h3><a name="flow-å–æ¶ˆ" class="md-header-anchor"></a><span>Flow å–æ¶ˆ</span></h3><p><span>å¦‚ä½•å–æ¶ˆä¸€ä¸ªFlowå‘¢ï¼Ÿ</span></p><p><span>Kotlinå®˜æ–¹å¹¶æ²¡æœ‰æä¾›flowå–æ¶ˆçš„å‡½æ•°ã€‚å•Š è¿™ï¼Ÿï¼Ÿï¼ŸğŸ˜•å¬åˆ°è¿™ä¸ªæ˜¯ä¸æ˜¯è¿˜æ»¡ç–‘æƒ‘ã€‚ä¸”å¬æˆ‘ç»†ç»†é“æ¥ã€‚</span></p><p><span>Flowéœ€è¦åœ¨åç¨‹é‡Œé¢ä½¿ç”¨ï¼Œå› ä¸º</span><code>collect</code><span>æ˜¯æŒ‚èµ·å‡½æ•°ï¼Œå¦å¤–åŸºäºå†·æµçš„ç‰¹æ€§ï¼Œä¸è°ƒç”¨</span><code>collect</code><span>æ„å»ºå™¨çš„ä»£ç å‹æ ¹ä¸ä¼šèµ°ã€‚æ‰€ä»¥åªèƒ½æ˜¯åç¨‹ã€‚é‚£ æˆ‘å–æ¶ˆåç¨‹ä¸å°±è¡Œäº†å—ï¼ŸğŸ˜®ã€‚å¥½åƒä¹‹å‰æœ‰çœ‹åˆ°è¿‡æœ‰å¼€å‘è€…æå‡ºè¿‡ï¼Œæ˜¯å¦è¦ç»™flowå•ç‹¬åŠ ä¸€ä¸ªå–æ¶ˆçš„å‡½æ•°ï¼Œè¢«Jetbrainsæ— æƒ…çš„æ‹’ç»äº†ï¼Œå“ˆå“ˆå“ˆå“ˆå¾ˆæç¬‘ã€‚ä¸‹é¢å¼•ç”¨Kotlinå®˜æ–¹çš„ä¸€æ®µè¯ã€‚</span></p><blockquote><p><span>Flow adheres to the general cooperative cancellation of coroutines. As usual, flow collection can be cancelled when the flow is suspended in a cancellable suspending function (like delay). </span></p><p><span>adheres åšæŒ</span></p><p><span>Flow åšæŒåç¨‹çš„ä¸€èˆ¬åä½œå–æ¶ˆã€‚ åƒå¾€å¸¸ä¸€æ ·ï¼Œå½“æµåœ¨å¯å–æ¶ˆçš„æŒ‚èµ·å‡½æ•°ï¼ˆå¦‚å»¶è¿Ÿï¼‰ä¸­è¢«æŒ‚èµ·æ—¶ï¼Œå¯ä»¥å–æ¶ˆæµæ”¶é›†ã€‚</span></p></blockquote><p><span>è¿™ä¸ª</span><code>adheres</code><span>å¥½åƒå°±åƒæ˜¯åœ¨å›å¤å¹¿å¤§çš„å¼€å‘è€…ï¼Œä½ å–æ¶ˆåç¨‹å°±è¡Œäº†ğŸ˜‚ğŸ˜‚ğŸ˜‚ã€‚</span></p><p><span>å¥½äº†ï¼Œä¸‹é¢çœ‹å–æ¶ˆçš„ğŸŒ°</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">simple</span>(): <span class="cm-variable">Flow</span><span class="cm-operator">&lt;</span><span class="cm-variable">Int</span><span class="cm-operator">&gt;</span> <span class="cm-operator">=</span> <span class="cm-variable">flow</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-number">1.</span>.<span class="cm-number">3</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">100</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"emit $i"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-variable">i</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>() <span class="cm-operator">=</span> <span class="cm-variable">runBlocking</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">job</span> <span class="cm-operator">=</span> <span class="cm-variable">launch</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">simple</span>().<span class="cm-variable">collect</span> { <span class="cm-variable">println</span>(<span class="cm-variable">it</span>) }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">250</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">job</span>.<span class="cm-variable">cancel</span>(<span class="cm-variable">CancellationException</span>(<span class="cm-string">"timeout 250"</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"done"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 352px;"></div><div class="CodeMirror-gutters" style="display: none; height: 352px;"></div></div></div></pre><p><span>ç»“æœï¼šçœ‹æˆ‘ä»¬åªéœ€è¦å–æ¶ˆå¯¹åº”çš„åç¨‹å³å¯ï¼Œå¯¹åº”çš„flowä¹Ÿä¼šè¢«å–æ¶ˆæ”¶é›†ã€‚</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">emit</span> <span class="cm-number">1</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">emit</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">done</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><span>è¿™é‡Œå¼•ç”³ä¸€ç‚¹ï¼Œå¯¹äºtimeoutï¼Œå®˜æ–¹æœ‰æä¾›ä¸“ç”¨çš„æ“ä½œå‡½æ•°,withTimeoutç³»åˆ—ã€‚ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨delayç„¶åç»§ç»­è°ƒç”¨å–æ¶ˆï¼Œæ¯•ç«Ÿä¸æ˜¯å¾ˆä¼˜é›…ã€‚</span></p><p><span>ä¸Šè¿°ä»£ç ä¹Ÿå¯ä»¥å†™æˆå¦‚ä¸‹çš„å½¢å¼</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">simple</span>(): <span class="cm-variable">Flow</span><span class="cm-operator">&lt;</span><span class="cm-variable">Int</span><span class="cm-operator">&gt;</span> <span class="cm-operator">=</span> <span class="cm-variable">flow</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-number">1.</span>.<span class="cm-number">3</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">100</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"emit $i"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-variable">i</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>() <span class="cm-operator">=</span> <span class="cm-variable">runBlocking</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">withTimeoutOrNull</span>(<span class="cm-number">250</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">simple</span>().<span class="cm-variable">collect</span> { <span class="cm-variable">value</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">println</span>(<span class="cm-variable">value</span>) }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"done"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre><p><span>çœ‹åˆ°äº†å—ï¼Ÿç›´æ¥å°†launchæ›¿æ¢ä¸º</span><code>withTimeoutOrNull</code><span>å°±å¯ä»¥åšåˆ°å»¶æ—¶å–æ¶ˆæ•ˆæœäº†ï¼Œè¿™é‡Œç®€å•åšä¸€ä¸‹æºç åˆ†æã€‚</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">æºç </span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">suspend</span> <span class="cm-keyword">fun</span> <span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> <span class="cm-variable">withTimeoutOrNull</span>(<span class="cm-variable">timeMillis</span>: <span class="cm-variable-3">Long</span>, <span class="cm-variable">block</span>: <span class="cm-keyword">suspend</span> <span class="cm-variable">CoroutineScope</span>.() <span class="cm-operator">-&gt;</span> <span class="cm-variable">T</span>): <span class="cm-variable">T</span><span class="cm-operator">?</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">suspendCoroutineUninterceptedOrReturn</span> { <span class="cm-variable">uCont</span> <span class="cm-operator">-&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">timeoutCoroutine</span> <span class="cm-operator">=</span> <span class="cm-variable">TimeoutCoroutine</span>(<span class="cm-variable">timeMillis</span>, <span class="cm-variable">uCont</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">coroutine</span> <span class="cm-operator">=</span> <span class="cm-variable">timeoutCoroutine</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">setupTimeout</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">?</span>, <span class="cm-variable">T</span><span class="cm-operator">?&gt;</span>(<span class="cm-variable">timeoutCoroutine</span>, <span class="cm-variable">block</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">e</span>: <span class="cm-variable">TimeoutCancellationException</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span> <span class="cm-keyword">class</span> <span class="cm-def">TimeoutCoroutine</span><span class="cm-operator">&lt;</span><span class="cm-variable">U</span>, <span class="cm-keyword">in</span> <span class="cm-variable">T</span>: <span class="cm-variable">U</span><span class="cm-operator">&gt;</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">@JvmField</span> <span class="cm-keyword">val</span> <span class="cm-def">time</span>: <span class="cm-variable-3">Long</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">uCont</span>: <span class="cm-variable">Continuation</span><span class="cm-operator">&lt;</span><span class="cm-variable">U</span><span class="cm-operator">&gt;</span> <span class="cm-comment">// unintercepted continuation</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">) : <span class="cm-variable">ScopeCoroutine</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span>(<span class="cm-variable">uCont</span>.<span class="cm-variable">context</span>, <span class="cm-variable">uCont</span>), <span class="cm-variable-3">Runnable</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">override</span> <span class="cm-keyword">fun</span> <span class="cm-def">run</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cancelCoroutine</span>(<span class="cm-variable">TimeoutCancellationException</span>(<span class="cm-variable">time</span>, <span class="cm-keyword">this</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span>...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span> <span class="cm-keyword">fun</span> <span class="cm-operator">&lt;</span><span class="cm-variable">U</span>, <span class="cm-variable">T</span>: <span class="cm-variable">U</span><span class="cm-operator">&gt;</span> <span class="cm-variable">setupTimeout</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">coroutine</span>: <span class="cm-variable">TimeoutCoroutine</span><span class="cm-operator">&lt;</span><span class="cm-variable">U</span>, <span class="cm-variable">T</span><span class="cm-operator">&gt;</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">block</span>: <span class="cm-keyword">suspend</span> <span class="cm-variable">CoroutineScope</span>.() <span class="cm-operator">-&gt;</span> <span class="cm-variable">T</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">): <span class="cm-variable">Any</span><span class="cm-operator">?</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// schedule cancellation of this coroutine on time</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">coroutine</span>.<span class="cm-variable">disposeOnCompletion</span>(<span class="cm-variable">context</span>.<span class="cm-variable">delay</span>.<span class="cm-variable">invokeOnTimeout</span>(<span class="cm-variable">coroutine</span>.<span class="cm-variable">time</span>, <span class="cm-variable">coroutine</span>, <span class="cm-variable">coroutine</span>.<span class="cm-variable">context</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">fun</span> <span class="cm-def">invokeOnTimeout</span>(<span class="cm-variable">timeMillis</span>: <span class="cm-variable-3">Long</span>, <span class="cm-variable">block</span>: <span class="cm-variable-3">Runnable</span>, <span class="cm-variable">context</span>: <span class="cm-variable">CoroutineContext</span>): <span class="cm-variable">DisposableHandle</span> <span class="cm-operator">=</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">DefaultDelay</span>.<span class="cm-variable">invokeOnTimeout</span>(<span class="cm-variable">timeMillis</span>, <span class="cm-variable">block</span>, <span class="cm-variable">context</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 748px;"></div><div class="CodeMirror-gutters" style="display: none; height: 748px;"></div></div></div></pre><p><span>çœç•¥äº†ä¸€å¤§å †éæ ¸å¿ƒçš„ä»£ç ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹å»¶æ—¶å–æ¶ˆçš„æ“ä½œï¼Œè¿™é‡Œç®€å•åˆ†æä¸€ä¸‹ï¼š</span></p><ul><li><span>åˆ›å»ºTimeoutCoroutineå¯¹è±¡ï¼Œå®ƒåŒæ—¶å®ç°äº†Runnableï¼Œåœ¨runé‡Œé¢è°ƒç”¨äº†å–æ¶ˆå‡½æ•°ï¼ŒæŠ›å‡ºTimeoutCancellationExceptionã€‚</span></li><li><span>è°ƒç”¨å½“å‰contextçš„invokeOnTimeoutå‡½æ•°ï¼Œè¯¥å‡½æ•°éœ€è¦ä¸€ä¸ªRunnableï¼Œä¼ å…¥äº†timeoutCoroutineã€‚æ­¤å®ç°ä½¿ç”¨å†…ç½®çš„å•çº¿ç¨‹è°ƒåº¦æ‰§è¡Œå™¨æœåŠ¡ã€‚ä¼šåœ¨å»¶æ—¶å¯¹åº”çš„äº‹ä»¶åè°ƒç”¨Runnableçš„runå‡½æ•°ï¼Œç„¶åå°±ä¼šå–æ¶ˆå½“å‰çš„åç¨‹ã€‚</span></li><li><span>åœ¨å–æ¶ˆåç¨‹ä¹‹åï¼Œä¼šå–æ¶ˆæ‰å½“å‰ä¸Šä¸‹æ–‡çš„æ‰€æœ‰å°†åœ¨å®Œæˆæ—¶è°ƒç”¨çš„å›è°ƒï¼ŒdisposeOnCompletionå‡½æ•°è¢«è°ƒç”¨ã€‚</span></li></ul><h3><a name="flow-ç›¸å…³æ“ä½œç¬¦" class="md-header-anchor"></a><span>Flow ç›¸å…³æ“ä½œç¬¦</span></h3><p><span>è¿™ä¸€å—çš„æ“ä½œç¬¦ï¼Œå…¶å®æ˜¯æ¯”è¾ƒå¤šçš„ã€‚ä½†æ˜¯å¦‚æœæ‚¨ç†Ÿæ‚‰RxJavaçš„è¯ï¼Œå…¶å®éƒ½æ˜¯å·®ä¸å¤šçš„ã€‚è¿™ä¸€å—è¿™é‡Œå°±ä¸åšæºç åˆ†æäº†ï¼Œåªæ˜¯çœ‹ä¸€ä¸‹æ€ä¹ˆä½¿ç”¨å³å¯ã€‚å†…éƒ¨å…¶å®æ˜¯åˆ›å»ºäº†æ–°çš„æµè¿”å›å‡ºæ¥äº†ï¼Œæœ‰å…´è¶£çš„è¯å¯ä»¥è‡ªè¡ŒæŸ¥çœ‹ä¸€ä¸‹æºç ã€‚</span></p><h4><a name="ä¸­é—´æµæ“ä½œç¬¦" class="md-header-anchor"></a><span>ä¸­é—´æµæ“ä½œç¬¦</span></h4><h5><a name="map" class="md-header-anchor"></a><span>map</span></h5><p><span>æ˜ å°„ã€‚çœ‹ğŸŒ°(ä¼ å…¥è¯·æ±‚æµå¯ä»¥ä½¿ç”¨ map æ“ä½œç¬¦æ˜ å°„åˆ°ç»“æœï¼Œå³ä½¿æ‰§è¡Œè¯·æ±‚æ˜¯ç”±æŒ‚èµ·å‡½æ•°å®ç°çš„é•¿æ—¶é—´è¿è¡Œçš„æ“ä½œ)</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">suspend</span> <span class="cm-keyword">fun</span> <span class="cm-def">performRequest</span>(<span class="cm-variable">request</span>: <span class="cm-variable">Int</span>): <span class="cm-variable-3">String</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">1000</span>) <span class="cm-comment">// æ¨¡æ‹Ÿé•¿æ—¶é—´çš„å¼‚æ­¥å·¥ä½œ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-string">"response $request"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>() <span class="cm-operator">=</span> <span class="cm-variable">runBlocking</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  (<span class="cm-number">1.</span>.<span class="cm-number">3</span>).<span class="cm-variable">asFlow</span>() <span class="cm-comment">// è½¬æ¢ä¸ºflow</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">map</span> { <span class="cm-variable">request</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">performRequest</span>(<span class="cm-variable">request</span>) }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">collect</span> { <span class="cm-variable">response</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">println</span>(<span class="cm-variable">response</span>) }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 242px;"></div><div class="CodeMirror-gutters" style="display: none; height: 242px;"></div></div></div></pre><p><span>ç»“æœ</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span> <span class="cm-number">1</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span> <span class="cm-number">3</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><h5><a name="filter" class="md-header-anchor"></a><span>filter</span></h5><p><span>è¿‡æ»¤æ“ä½œ,çœ‹ğŸŒ°</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">suspend</span> <span class="cm-keyword">fun</span> <span class="cm-def">performRequest</span>(<span class="cm-variable">request</span>: <span class="cm-variable">Int</span>): <span class="cm-variable-3">String</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">1000</span>) <span class="cm-comment">// æ¨¡æ‹Ÿé•¿æ—¶é—´çš„å¼‚æ­¥å·¥ä½œ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-string">"response $request"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>() <span class="cm-operator">=</span> <span class="cm-variable">runBlocking</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  (<span class="cm-number">1.</span>.<span class="cm-number">3</span>).<span class="cm-variable">asFlow</span>() <span class="cm-comment">// è½¬æ¢ä¸ºflow</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">map</span> { <span class="cm-variable">request</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">performRequest</span>(<span class="cm-variable">request</span>) }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">filter</span> { <span class="cm-variable">it</span> <span class="cm-operator">==</span> <span class="cm-string">"response 1"</span> }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">collect</span> { <span class="cm-variable">response</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">println</span>(<span class="cm-variable">response</span>) }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 242px;"></div><div class="CodeMirror-gutters" style="display: none; height: 242px;"></div></div></div></pre><p><span>ç»“æœï¼šä»…è¿”å›åŒ¹é…åˆ°çš„å€¼</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">response 1</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><h4><a name="å˜æ¢æ“ä½œç¬¦" class="md-header-anchor"></a><span>å˜æ¢æ“ä½œç¬¦</span></h4><p><span>åœ¨æµå˜æ¢ç®—å­ä¸­ï¼Œæœ€é€šç”¨çš„ä¸€ç§å«åšå˜æ¢ã€‚ å®ƒå¯ä»¥ç”¨æ¥æ¨¡ä»¿ç®€å•çš„è½¬æ¢ï¼Œæ¯”å¦‚ map å’Œ filterï¼Œä¹Ÿå¯ä»¥å®ç°æ›´å¤æ‚çš„è½¬æ¢ã€‚ ä½¿ç”¨</span><code>transform</code><span>ï¼Œæˆ‘ä»¬å¯ä»¥å‘å‡ºä»»æ„æ¬¡æ•°çš„ä»»æ„å€¼ã€‚</span></p><p><span>ä¾‹å¦‚ğŸŒ°ï¼Œä½¿ç”¨</span><code>transform</code><span>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ‰§è¡Œé•¿æ—¶é—´è¿è¡Œçš„å¼‚æ­¥è¯·æ±‚ä¹‹å‰å‘å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶åœ¨å…¶åå“åº”ï¼š</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">(<span class="cm-number">1.</span>.<span class="cm-number">3</span>).<span class="cm-variable">asFlow</span>() <span class="cm-comment">// a flow of requests</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">transform</span> { <span class="cm-variable">request</span> <span class="cm-operator">-&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-string">"Making request $request"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-variable">performRequest</span>(<span class="cm-variable">request</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">collect</span> { <span class="cm-variable">response</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">println</span>(<span class="cm-variable">response</span>) }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><span>ç»“æœ</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Making</span> <span class="cm-variable">request</span> <span class="cm-number">1</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span> <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Making</span> <span class="cm-variable">request</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Making</span> <span class="cm-variable">request</span> <span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span> <span class="cm-number">3</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><h4><a name="sizeé™åˆ¶æ“ä½œç¬¦" class="md-header-anchor"></a><span>sizeé™åˆ¶æ“ä½œç¬¦</span></h4><p><span>é¡¾åæ€ä¹‰ï¼Œé™åˆ¶æ”¶é›†çš„æ•°é‡ã€‚ä½¿ç”¨è¿ç®—ç¬¦</span><code>take</code></p><p><span>å®ƒä¼šåœ¨åˆ¤æ–­å½“å‘å°„çš„å€¼åœ¨è¾¾åˆ°ç›¸åº”é™åˆ¶æ—¶å–æ¶ˆæµç¨‹çš„æ‰§è¡Œã€‚ </span><strong><span>å› ä¸ºåç¨‹ä¸­çš„å–æ¶ˆæ€»æ˜¯é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ¥æ‰§è¡Œã€‚æ‰€ä»¥éœ€è¦è€ƒè™‘è¿›è¡Œç›¸åº”çš„å¼‚å¸¸æ•è·æ¥ä¿è¯åç»­çš„æµç•…æ­£å¸¸è¿›è¡Œä¸è¢«å–æ¶ˆæ‰</span></strong><span>ã€‚</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">numbers</span>(): <span class="cm-variable">Flow</span><span class="cm-operator">&lt;</span><span class="cm-variable">Int</span><span class="cm-operator">&gt;</span> <span class="cm-operator">=</span> <span class="cm-variable">flow</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">try</span> { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-number">2</span>) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"not execute"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-number">3</span>) &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  } <span class="cm-keyword">finally</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"finally in numbers"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>() <span class="cm-operator">=</span> <span class="cm-variable">runBlocking</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">numbers</span>() </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">take</span>(<span class="cm-number">2</span>) <span class="cm-comment">// take ä¸¤ä¸ªå€¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">collect</span> { <span class="cm-variable">value</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">println</span>(<span class="cm-variable">value</span>) }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 352px;"></div><div class="CodeMirror-gutters" style="display: none; height: 352px;"></div></div></div></pre><p><span>ç»“æœ</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">finally in numbers</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><h4><a name="ç»ˆç«¯æ“ä½œç¬¦" class="md-header-anchor"></a><span>ç»ˆç«¯æ“ä½œç¬¦</span></h4><p><span>ç»ˆç«¯æ“ä½œç¬¦å¯ä»¥å¯åŠ¨ä¸€ä¸ªæµï¼Œæœ€åŸºç¡€çš„å°±æ˜¯ä¸Šè¿°å¸¸æåˆ°çš„</span><code>collect</code><span>ã€‚ä½†æ˜¯è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ç»ˆç«¯æ“ä½œç¬¦ï¼Œå®ƒå¯èƒ½ä¼šè®©ä¸€äº›æ“ä½œå˜å¾—æ›´ç®€å•ï¼š</span></p><h5><a name="è½¬æ¢ä¸ºå„ç§é›†åˆ-tolist-å’Œ-toset" class="md-header-anchor"></a><span>è½¬æ¢ä¸ºå„ç§é›†åˆï¼Œ toList å’Œ toSetã€‚</span></h5><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">flowOf</span>(<span class="cm-number">1</span>,<span class="cm-number">2</span>).<span class="cm-variable">toList</span>().<span class="cm-variable">forEach</span> { </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-variable">it</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">flowOf</span>(<span class="cm-number">1</span>,<span class="cm-number">2</span>).<span class="cm-variable">toSet</span>().<span class="cm-variable">forEach</span>(::<span class="cm-variable">println</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><h5><a name="first--ç¡®ä¿è·å–ä¸”è¿›è·å–ç¬¬ä¸€ä¸ªå€¼" class="md-header-anchor"></a><span>first , ç¡®ä¿è·å–ä¸”è¿›è·å–ç¬¬ä¸€ä¸ªå€¼</span></h5><p><span>è¿”å›æµå‘å‡ºçš„ç¬¬ä¸€ä¸ªå…ƒç´ ç„¶åå–æ¶ˆæµçš„é›†åˆçš„ç»ˆç«¯è¿ç®—ç¬¦ã€‚ å¦‚æœæµä¸ºç©ºï¼Œåˆ™æŠ›å‡º NoSuchElementExceptionã€‚</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">value</span> : <span class="cm-variable">Int</span> <span class="cm-operator">=</span> <span class="cm-variable">flowOf</span>(<span class="cm-number">1</span>, <span class="cm-number">2</span>).<span class="cm-variable">first</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-variable">value</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><h5><a name="ä½¿ç”¨-reduce-å’Œ-fold-å°†æµåˆå¹¶åˆ°ä¸€ä¸ªå€¼" class="md-header-anchor"></a><span>ä½¿ç”¨ reduce å’Œ fold å°†æµåˆå¹¶åˆ°ä¸€ä¸ªå€¼ã€‚</span></h5><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">sum</span> <span class="cm-operator">=</span> (<span class="cm-number">1.</span>.<span class="cm-number">5</span>).<span class="cm-variable">asFlow</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">map</span> { <span class="cm-variable">it</span> <span class="cm-operator">*</span> <span class="cm-variable">it</span> } <span class="cm-comment">//å¹³æ–¹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">reduce</span> { <span class="cm-variable">a</span>, <span class="cm-variable">b</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">a</span> <span class="cm-operator">+</span> <span class="cm-variable">b</span> } <span class="cm-comment">// è¿›è¡Œç´¯åŠ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-variable">sum</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//ç»“æœ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">55</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><span>foldå’Œreduceä½¿ç”¨èµ·æ¥å·®ä¸å¤šï¼ŒåŒºåˆ«å°±æ˜¯foldå¯ä»¥å®šä¹‰åˆå§‹åŒ–ï¼Œå…¶å®å¾ˆç®€å•ï¼Œreduceä¼ å…¥çš„lambdaå‰ä¸€ä¸ªå‚æ•°æ˜¯æ¯æ¬¡è®¡ç®—çš„ç»“æœç´¯è®¡ï¼Œåä¸€ä¸ªå‚æ•°æ˜¯å½“å‰éœ€è¦ä¼ å…¥çš„å€¼ï¼Œä¸æ˜ç™½å¯ä»¥å»ç…ä¸€çœ¼æºç ï¼Œè¿™é‡Œä¸åœ¨å¼•ç”³ã€‚</span></p><h5><a name="oneach" class="md-header-anchor"></a><span>onEach</span></h5><p><span>è¿™ä¸ªæ“ä½œç¬¦ä¹Ÿè¾ƒä¸ºå¸¸ç”¨ï¼Œè¿™é‡Œä¹Ÿä»‹ç»ä¸€ä¸‹ï¼Œè¿”å›åœ¨ä¸Šæ¸¸æµçš„æ¯ä¸ªå€¼å‘ä¸‹æ¸¸å‘å‡ºä¹‹å‰è°ƒç”¨ç»™å®šæ“ä½œçš„æµã€‚</span></p><p><span>ğŸŒ°</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">(<span class="cm-number">1.</span>.<span class="cm-number">5</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">.<span class="cm-variable">asFlow</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">.<span class="cm-variable">onEach</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">println</span>(<span class="cm-string">"onEach$it"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}.<span class="cm-variable">collect</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//ç»“æœ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">onEach1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">onEach2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">onEach3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">onEach4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">onEach5</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 242px;"></div><div class="CodeMirror-gutters" style="display: none; height: 242px;"></div></div></div></pre><h4><a name="æ“ä½œç¬¦çš„é¡ºåº" class="md-header-anchor"></a><span>æ“ä½œç¬¦çš„é¡ºåº</span></h4><p><span>é™¤éä½¿ç”¨å¯¹å¤šä¸ªæµè¿›è¡Œæ“ä½œçš„ç‰¹æ®Šè¿ç®—ç¬¦ï¼Œå¦åˆ™æµçš„æ¯ä¸ªå•ç‹¬é›†åˆéƒ½æŒ‰é¡ºåºæ‰§è¡Œã€‚ è¯¥é›†åˆç›´æ¥åœ¨è°ƒç”¨ç»ˆç«¯è¿ç®—ç¬¦çš„åç¨‹ä¸­å·¥ä½œã€‚ é»˜è®¤æƒ…å†µä¸‹ä¸ä¼šå¯åŠ¨æ–°çš„åç¨‹ã€‚ æ¯ä¸ªå‘å‡ºçš„å€¼éƒ½ç”±ä»ä¸Šæ¸¸åˆ°ä¸‹æ¸¸çš„æ‰€æœ‰ä¸­é—´æ“ä½œç¬¦å¤„ç†ï¼Œç„¶åäº¤ä»˜ç»™ç»ˆç«¯æ“ä½œç¬¦ã€‚</span></p><p><span>ğŸŒ°</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">(<span class="cm-number">1.</span>.<span class="cm-number">5</span>).<span class="cm-variable">asFlow</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">filter</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"Filter $it"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">it</span> <span class="cm-operator">%</span> <span class="cm-number">2</span> <span class="cm-operator">==</span> <span class="cm-number">0</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  } &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">map</span> { </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"Map $it"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"string $it"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }.<span class="cm-variable">collect</span> { </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"Collect $it"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  } &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//ç»“æœ  æŒ‰ç…§é¡ºåºæ²¡æœ‰å€¼ä¾æ¬¡å‘ä¸‹å‘å°„</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Filter</span> <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Filter</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Map</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Collect</span> <span class="cm-variable">string</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Filter</span> <span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Filter</span> <span class="cm-number">4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Map</span> <span class="cm-number">4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Collect</span> <span class="cm-variable">string</span> <span class="cm-number">4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Filter</span> <span class="cm-number">5</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 462px;"></div><div class="CodeMirror-gutters" style="display: none; height: 462px;"></div></div></div></pre><h3><a name="flow-è°ƒåº¦å™¨åˆ‡æ¢" class="md-header-anchor"></a><span>Flow è°ƒåº¦å™¨åˆ‡æ¢</span></h3><p><span>å¯¹äºUIé©±åŠ¨å‹çš„ç¨‹åºæ¥è¯´ï¼Œéœ€è¦å°†é•¿æ—¶é—´è®¡ç®—çš„ä»»åŠ¡æ”¾åœ¨å¼‚æ­¥çº¿ç¨‹å¤„ç†ï¼ŒUIå±•ç¤ºå·¥ä½œéœ€è¦æ”¾åœ¨ä¸»çº¿ç¨‹å¤„ç†ã€‚ä¹Ÿå°±æ˜¯è¯´éœ€è¦å°†æ„å»ºå™¨çš„ä»£ç æ”¾åˆ°å¼‚æ­¥çº¿ç¨‹æ‰§è¡Œï¼Œä½†æ˜¯ç»ˆç«¯æ“ä½œç¬¦ï¼Œæ¯”å¦‚</span><code>collect</code><span>éœ€è¦åœ¨ä¸»çº¿ç¨‹è·å–ï¼Œé‚£ä¹ˆæ€ä¹ˆåšå‘¢ï¼Ÿ</span></p><p><span>ä½¿ç”¨</span><code>flowOn</code><span>æ“ä½œç¬¦</span></p><p><span>åœ¨è¿™ä¹‹å‰æ‚¨å¯èƒ½çš„äº†è§£ä¸€ä¸‹ï¼Œåç¨‹çš„è°ƒåº¦å™¨ã€‚å¯ä»¥ç®€å•å‚è€ƒä¹‹å‰å†™çš„ä¸€ç¯‡æ–‡ç« ï¼Œæœ‰å¯¹è°ƒåº¦å™¨åšç®€å•ä»‹ç»ï¼š</span><a href='https://blog.csdn.net/weixin_44235109/article/details/119981210' target='_blank' class='url'>https://blog.csdn.net/weixin_44235109/article/details/119981210</a></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>() <span class="cm-operator">=</span> <span class="cm-variable">runBlocking</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">flow</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-number">1.</span>.<span class="cm-number">3</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//æ¨¡æ‹Ÿå¼‚æ­¥å¤„ç†</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">100</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"Emitting $i"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-variable">i</span>) <span class="cm-comment">// emit next value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }.<span class="cm-variable">flowOn</span>(<span class="cm-variable">Dispatchers</span>.<span class="cm-variable">Default</span>)<span class="cm-comment">//ä½¿ç”¨flowOnä¼ å…¥Defaultçš„è°ƒåº¦å™¨</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">collect</span> { <span class="cm-variable">value</span> <span class="cm-operator">-&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"Collected $value"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre><p><span>ç»“æœ</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">16</span>:<span class="cm-number">39</span>:<span class="cm-number">21</span>:<span class="cm-number">954</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-variable">Emitting</span> <span class="cm-number">1</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">16</span>:<span class="cm-number">39</span>:<span class="cm-number">21</span>:<span class="cm-number">969</span> [<span class="cm-variable">main</span>] <span class="cm-variable">Collected</span> <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">16</span>:<span class="cm-number">39</span>:<span class="cm-number">22</span>:<span class="cm-number">071</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-variable">Emitting</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">16</span>:<span class="cm-number">39</span>:<span class="cm-number">22</span>:<span class="cm-number">071</span> [<span class="cm-variable">main</span>] <span class="cm-variable">Collected</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">16</span>:<span class="cm-number">39</span>:<span class="cm-number">22</span>:<span class="cm-number">178</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-variable">Emitting</span> <span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">16</span>:<span class="cm-number">39</span>:<span class="cm-number">22</span>:<span class="cm-number">178</span> [<span class="cm-variable">main</span>] <span class="cm-variable">Collected</span> <span class="cm-number">3</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><span>å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºï¼Œæ„å»ºæ¨¡å—è¢«è°ƒåº¦åˆ°å¼‚æ­¥çº¿ç¨‹å¤„ç†äº†ã€‚è€Œæ”¶é›†çš„å·¥ä½œè¿˜åœ¨ä¸»çº¿ç¨‹è¿›è¡Œã€‚</span></p><p><code>flowOn</code><span>è´Ÿè´£æ„å»ºçš„æ¨¡å—è°ƒåº¦ï¼Œé‚£ä¹ˆæ”¶é›†çš„è°è´Ÿè´£å‘¢ï¼Ÿ</span></p><p><span>å…¶å®å’Œå¼‚å¸¸å¤„ç†ç±»ä¼¼ï¼Œcollectå—è°ƒç”¨å®ƒçš„åç¨‹ä¸Šä¸‹æ–‡é™åˆ¶ï¼Œæ‰€ä»¥æœ€åçš„æ‰§è¡Œçº¿ç¨‹å’Œå½“å‰åç¨‹ä¸Šä¸‹æ–‡çš„è°ƒåº¦å™¨æœ‰å…³ï¼Œç›®å‰æˆ‘ä½¿ç”¨çš„æ˜¯</span><code>idea</code><span>æµ‹è¯•çš„ï¼Œé»˜è®¤</span><code>runBlocking</code><span>çš„è°ƒåº¦å™¨å°±æ˜¯ä¸»çº¿ç¨‹ã€‚å¦‚æœæ˜¯androidä¸Šé¢çš„è¯ï¼Œ</span><code>runBlocking</code><span>å¯èƒ½å°±éœ€è¦ä¼ å…¥</span><code>Dispatchers.Main</code><span>äº†ã€‚</span></p><p><span>å…¶å®å’ŒRxJavaè¿˜æ˜¯éå¸¸ç›¸ä¼¼çš„ğŸ˜‚ã€‚</span></p><p><strong><span>æ³¨æ„ä¸€ç‚¹ï¼Œæ­¤æ—¶å…¶å®å·²ç»æ”¹å˜æµæ‰§è¡Œçš„é¡ºåºäº†</span></strong><span>ã€‚</span></p><p><span>å®˜æ–¹çš„è§£é‡Šå¦‚ä¸‹ï¼š</span></p><blockquote><p><span>Another thing to observe here is that the flowOn operator has changed the default sequential nature of the flow. Now collection happens in one coroutine (&quot;coroutine#1&quot;) and emission happens in another coroutine (&quot;coroutine#2&quot;) that is running in another thread concurrently with the collecting coroutine. The flowOn operator creates another coroutine for an upstream flow when it has to change the CoroutineDispatcher in its context.</span></p><p><span>è¿™é‡Œè¦æ³¨æ„çš„å¦ä¸€ä»¶äº‹æ˜¯ flowOn è¿ç®—ç¬¦æ›´æ”¹äº†æµçš„é»˜è®¤é¡ºåºæ€§è´¨ã€‚ ç°åœ¨æ”¶é›†å‘ç”Ÿåœ¨ä¸€ä¸ªåç¨‹ï¼ˆâ€œcoroutine#1â€ï¼‰ä¸­ï¼Œå‘å°„å‘ç”Ÿåœ¨å¦ä¸€ä¸ªåç¨‹ï¼ˆâ€œcoroutine#2â€ï¼‰ä¸­ï¼Œè¯¥åç¨‹ä¸æ”¶é›†åç¨‹åŒæ—¶è¿è¡Œåœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­ã€‚ å½“å¿…é¡»åœ¨å…¶ä¸Šä¸‹æ–‡ä¸­æ›´æ”¹ CoroutineDispatcher æ—¶ï¼Œ flowOn è¿ç®—ç¬¦ä¸ºä¸Šæ¸¸æµåˆ›å»ºå¦ä¸€ä¸ªåç¨‹ã€‚</span></p></blockquote><p><span>è¿™ä¸€å—æˆ‘ç®€å•çœ‹äº†ä¸€ä¸‹æºç ï¼Œè¿™é‡Œé¢ä¸åŒçš„è°ƒåº¦å™¨ä¼šé‡åˆ°å¤šçº¿ç¨‹çš„é—®é¢˜ï¼Œæœ€é‡Œé¢ä½¿ç”¨äº†channelè¿›è¡Œäº†è°ƒåº¦å¤„ç†ã€‚å…·ä½“çš„æ ¸å¿ƒç±»æ˜¯</span><code>ChannelFlow</code><span>ã€‚åé¢ä¼šå¯¹</span><code>flow</code><span>è¿›è¡Œç®€å•æºç åˆ†æï¼Œä½†ç¯‡å¹…æœ‰é™ä¸å¯¹è¿™ä¸€å—è¿‡æ·±å…¥åˆ†æï¼Œæ„Ÿå…´è¶£å¯ä»¥è‡ªè¡ŒæŸ¥çœ‹ï¼Œæˆ–æ‰¾åšä¸»ç§ä¸‹æ¢è®¨ã€‚</span></p><p><span>å…¶å®ä¸Šé¢çš„çœ‹ä¸å‡ºæ¥ä¼šæ”¹å˜æµæ‰§è¡Œçš„é¡ºåºï¼Œä¸‹é¢æ”¹å˜ä¸€ä¸‹ä»£ç ï¼ŒéªŒè¯ä¸€ä¸‹çœ‹çœ‹ğŸŒ°</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>() <span class="cm-operator">=</span> <span class="cm-variable">runBlocking</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">flow</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-number">1.</span>.<span class="cm-number">3</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//æ¨¡æ‹Ÿå¼‚æ­¥å¤„ç†</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">100</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"Emitting $i"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-variable">i</span>) <span class="cm-comment">// emit next value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }.<span class="cm-variable">flowOn</span>(<span class="cm-variable">Dispatchers</span>.<span class="cm-variable">Default</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">collect</span> { <span class="cm-variable">value</span> <span class="cm-operator">-&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">200</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"Collected $value"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 308px;"></div><div class="CodeMirror-gutters" style="display: none; height: 308px;"></div></div></div></pre><p><span>ç»“æœ</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">16</span>:<span class="cm-number">52</span>:<span class="cm-number">33</span>:<span class="cm-number">258</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-variable">Emitting</span> <span class="cm-number">1</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">16</span>:<span class="cm-number">52</span>:<span class="cm-number">33</span>:<span class="cm-number">386</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-variable">Emitting</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">16</span>:<span class="cm-number">52</span>:<span class="cm-number">33</span>:<span class="cm-number">482</span> [<span class="cm-variable">main</span>] <span class="cm-variable">Collected</span> <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">16</span>:<span class="cm-number">52</span>:<span class="cm-number">33</span>:<span class="cm-number">493</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-variable">Emitting</span> <span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">16</span>:<span class="cm-number">52</span>:<span class="cm-number">33</span>:<span class="cm-number">684</span> [<span class="cm-variable">main</span>] <span class="cm-variable">Collected</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">16</span>:<span class="cm-number">52</span>:<span class="cm-number">33</span>:<span class="cm-number">887</span> [<span class="cm-variable">main</span>] <span class="cm-variable">Collected</span> <span class="cm-number">3</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><span>æˆ‘ä»¬åªéœ€è¦å°†ï¼Œcollecté‡Œé¢å¢åŠ ä¸€ä¸ªdelayå³å¯ï¼Œå‘ç°å…¶å®è¿™æ—¶å€™å°±æ˜¯å‘å°„å½’å‘å°„ï¼Œæ”¶é›†å½’æ”¶é›†äº†ã€‚ä¸ä¼¼ä¸Šé¢æˆ‘ä»¬å†™çš„ç¨‹åºï¼Œå‘å°„ä¸€ä¸ªå€¼åªæœ‰åˆ°ç»ˆç«¯æ“ä½œç¬¦ä¹‹åæ‰ä¼šå‘å°„ç¬¬äºŒä¸ªã€‚è¿™é‡Œé¢è‚¯å®šå°±ä¼šå¯¹å€¼è¿›è¡Œç¼“å­˜ã€‚</span><strong><span>é‚£ä¹ˆå°±ä¼šç‰µæ‰¯åˆ°ä¸€ä¸ªé—®é¢˜ã€‚è€ç”Ÿå¸¸è°ˆğŸ™†â€â™€ï¸ï¼ŒèƒŒå‹å¤„ç†</span></strong><span>ï¼</span></p><h3><a name="flow-èƒŒå‹å¤„ç†" class="md-header-anchor"></a><span>Flow èƒŒå‹å¤„ç†</span></h3><p><span>å¯¹äºèƒŒå‹å¤„ç†ï¼ŒKotlin æä¾›ä¸‰ç§è§£å†³æ–¹æ¡ˆï¼š</span></p><figure><table><thead><tr><th><span>æ“ä½œç¬¦</span></th><th><span>å«ä¹‰</span></th></tr></thead><tbody><tr><td><span>buffer</span></td><td><span>æŒ‡å®šå›ºå®šå®¹é‡ç¼“å­˜</span></td></tr><tr><td><span>conflate</span></td><td><span>ä¿ç•™æœ€æ–°çš„å€¼</span></td></tr><tr><td><span>collectLatest</span></td><td><span>æ–°å€¼å‘é€æ—¶å–æ¶ˆä¹‹å‰çš„</span></td></tr></tbody></table></figure><h4><a name="buffer" class="md-header-anchor"></a><span>buffer</span></h4><p><span>è¿™é‡Œæœ‰å¿…è¦çœ‹ä¸€ä¸‹bufferå‡½æ•°çš„æºç å®šä¹‰</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">fun</span> <span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> <span class="cm-variable">Flow</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span>.<span class="cm-variable">buffer</span>(<span class="cm-variable">capacity</span>: <span class="cm-variable">Int</span> <span class="cm-operator">=</span> <span class="cm-variable">BUFFERED</span>, <span class="cm-variable">onBufferOverflow</span>: <span class="cm-variable">BufferOverflow</span> <span class="cm-operator">=</span> <span class="cm-variable">BufferOverflow</span>.<span class="cm-variable">SUSPEND</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p><span>å¯ä»¥çœ‹å‡ºéœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œéƒ½æœ‰é»˜è®¤å€¼ã€‚</span></p><ul><li><span>ç¬¬ä¸€ä¸ªå¥½ç†è§£å®¹é‡ï¼Œé»˜è®¤ç­‰äºBUFFEREDï¼Œè¿™ä¸ªå€¼å…¶å®æ—¶64ï¼Œå¯ä»¥æŒ‰ç…§ä½¿ç”¨æ—¶éœ€è¦è‡ªå·±æŒ‡å®šå…·ä½“çš„æ•°å­—ã€‚</span></li><li><span>ç¬¬äºŒä¸ªæ˜¯æŒ‡å®šï¼Œå½“bufferæº¢å‡ºæ—¶çš„æ“ä½œï¼Œé»˜è®¤çš„æ“ä½œæ˜¯æŒ‚èµ·ã€‚è¿˜è¦ä¸¤ä¸ªæ“ä½œåˆ†åˆ«æ˜¯åˆ é™¤æœ€æ—§çš„å€¼ä¸è¦æŒ‚èµ·æˆ–è€…åˆ é™¤å½“å‰æœ€æ–°çš„å€¼ä¸è¦æŒ‚èµ·ï¼Œå¯ä»¥è‡ªè¡ŒæŸ¥çœ‹æºç ï¼Œè¿™é‡Œä¸å†å¼•ç”³ã€‚</span></li></ul><p><span>ä½¿ç”¨ğŸŒ°</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">flow</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-number">1.</span>.<span class="cm-number">3</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//æ¨¡æ‹Ÿå¼‚æ­¥å¤„ç†</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">100</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"Emitting $i"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-variable">i</span>) <span class="cm-comment">// emit next value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }.<span class="cm-variable">flowOn</span>(<span class="cm-variable">Dispatchers</span>.<span class="cm-variable">Default</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">buffer</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">collect</span> { <span class="cm-variable">value</span> <span class="cm-operator">-&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">200</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"Collected $value"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//ç»“æœ &nbsp; &nbsp; &nbsp; </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">17</span>:<span class="cm-number">17</span>:<span class="cm-number">28</span>:<span class="cm-number">420</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-variable">Emitting</span> <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">17</span>:<span class="cm-number">17</span>:<span class="cm-number">28</span>:<span class="cm-number">536</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-variable">Emitting</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">17</span>:<span class="cm-number">17</span>:<span class="cm-number">28</span>:<span class="cm-number">646</span> [<span class="cm-variable">main</span>] <span class="cm-variable">Collected</span> <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">17</span>:<span class="cm-number">17</span>:<span class="cm-number">28</span>:<span class="cm-number">646</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-variable">Emitting</span> <span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">17</span>:<span class="cm-number">17</span>:<span class="cm-number">28</span>:<span class="cm-number">846</span> [<span class="cm-variable">main</span>] <span class="cm-variable">Collected</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">17</span>:<span class="cm-number">17</span>:<span class="cm-number">29</span>:<span class="cm-number">049</span> [<span class="cm-variable">main</span>] <span class="cm-variable">Collected</span> <span class="cm-number">3</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 440px;"></div><div class="CodeMirror-gutters" style="display: none; height: 440px;"></div></div></div></pre><h4><a name="conflate" class="md-header-anchor"></a><span>conflate</span></h4><p><span>è¿™ä¸ªåªè·å–æœ€æ–°å€¼ä¹Ÿæ¯”è¾ƒå¥½ç†è§£ï¼Œåº”ç”¨åœºæ™¯ï¼Œæ¯”å¦‚è¯´è·å–ä¸‹è½½è¿›åº¦ï¼Œå¯¹äºç”¨æˆ·æ¥è¯´å…¶å®æ¯æ¬¡åªéœ€è¦è·å–å½“å‰æœ€æ–°çš„è¿›åº¦å°±å¥½äº†ï¼Œä¸éœ€è¦æŠŠä¹‹å‰çš„å€¼å†å»è·å–ä¸€éï¼Œä¸‹é¢ä¹Ÿä¸¾ä¸€ä¸ªä¾‹å­ğŸŒ°</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>() <span class="cm-operator">=</span> <span class="cm-variable">runBlocking</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">flow</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-number">1.</span>.<span class="cm-number">3</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//æ¨¡æ‹Ÿå¼‚æ­¥å¤„ç†</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">100</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"Emitting $i"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-variable">i</span>) <span class="cm-comment">// emit next value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }.<span class="cm-variable">flowOn</span>(<span class="cm-variable">Dispatchers</span>.<span class="cm-variable">Default</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">conflate</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">collect</span> { <span class="cm-variable">value</span> <span class="cm-operator">-&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">300</span>)<span class="cm-comment">//æ¨¡æ‹Ÿä¸‹æ¸¸å¤„ç†æ¯”è¾ƒæ…¢</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"Collected $value"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//ç»“æœ &nbsp; ç¬¬ä¸€ä¸ªå€¼è‚¯å®šå¯ä»¥æ‹¿åˆ° å½“åœ°ä¸€ä¸ªå€¼å¤„ç†å®Œæˆä¹‹å  æœ€æ–°çš„å€¼å°±æ˜¯3äº† æ‰€ä»¥ä¸¢å¼ƒäº†2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">17</span>:<span class="cm-number">21</span>:<span class="cm-number">42</span>:<span class="cm-number">916</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-variable">Emitting</span> <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">17</span>:<span class="cm-number">21</span>:<span class="cm-number">43</span>:<span class="cm-number">034</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-variable">Emitting</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">17</span>:<span class="cm-number">21</span>:<span class="cm-number">43</span>:<span class="cm-number">140</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-variable">Emitting</span> <span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">17</span>:<span class="cm-number">21</span>:<span class="cm-number">43</span>:<span class="cm-number">236</span> [<span class="cm-variable">main</span>] <span class="cm-variable">Collected</span> <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">17</span>:<span class="cm-number">21</span>:<span class="cm-number">43</span>:<span class="cm-number">546</span> [<span class="cm-variable">main</span>] <span class="cm-variable">Collected</span> <span class="cm-number">3</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 462px;"></div><div class="CodeMirror-gutters" style="display: none; height: 462px;"></div></div></div></pre><h4><a name="collectlatest" class="md-header-anchor"></a><span>collectLatest</span></h4><p><span>è¯´æ˜ä¸€ç‚¹ï¼š</span><strong><span>è¿™ç©æ„å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªç»ˆç«¯æ“ä½œç¬¦</span></strong></p><p><span>å‰ä¸¤ä¸ªå¯èƒ½éƒ½æ¯”è¾ƒå¥½ç†è§£ï¼Œé‚£</span><code>æ–°å€¼å‘é€æ—¶å–æ¶ˆä¹‹å‰çš„</code><span>æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿä¸ºäº†ä¾¿äºç†è§£ï¼Œç›´æ¥ä¸Šä¾‹å­ï¼ŒæŒ‰ç…§ç»“æœè¯´æ˜ï¼š</span></p><p><span>ğŸŒ°</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>() <span class="cm-operator">=</span> <span class="cm-variable">runBlocking</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">flow</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-number">1.</span>.<span class="cm-number">3</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//æ¨¡æ‹Ÿå¼‚æ­¥å¤„ç†</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">100</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"Emitting $i"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-variable">i</span>) <span class="cm-comment">// emit next value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }.<span class="cm-variable">flowOn</span>(<span class="cm-variable">Dispatchers</span>.<span class="cm-variable">Default</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">collectLatest</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">300</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"Collected $it"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//ç»“æœ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">17</span>:<span class="cm-number">25</span>:<span class="cm-number">33</span>:<span class="cm-number">916</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-variable">Emitting</span> <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">17</span>:<span class="cm-number">25</span>:<span class="cm-number">34</span>:<span class="cm-number">038</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-variable">Emitting</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">17</span>:<span class="cm-number">25</span>:<span class="cm-number">34</span>:<span class="cm-number">150</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-variable">Emitting</span> <span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">17</span>:<span class="cm-number">25</span>:<span class="cm-number">34</span>:<span class="cm-number">453</span> [<span class="cm-variable">main</span>] <span class="cm-variable">Collected</span> <span class="cm-number">3</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 418px;"></div><div class="CodeMirror-gutters" style="display: none; height: 418px;"></div></div></div></pre><p><span>å¯¹æ¯”ä¸Šé¢çš„ä¾‹å­ï¼Œè¿™é‡Œåªæ˜¯å°†</span><code>collect</code><span>æ›¿æ¢æˆäº†</span><code>collectLatest</code><span>è€Œå·²ã€‚ä¸ºä»€ä¹ˆ</span><code>1</code><span>æ²¡æœ‰äº†å‘¢ï¼Ÿ</span></p><p><span>æ˜¾è€Œæ˜“è§äº†ï¼Œ</span><strong><span>è¿™ç©æ„ä¼šåœ¨æœ€æ–°çš„åˆ°æ¥ä¼šç›´æ¥å–æ¶ˆä¸‹æ¸¸ä¸Šä¸€ä¸ªæ¶ˆè´¹çš„å¤„ç†ï¼Œå› ä¸ºæœ‰delayæ‰€ä»¥</span><code>1</code><span>è¿˜æ²¡æœ‰æ¥å¾—åŠæ‰“å°ï¼Œå°±å› ä¸ºä¸‹ä¸€ä¸ªå€¼å‘å°„äº†ï¼Œç„¶åå°±è¢«å–æ¶ˆäº†ï¼ï¼ï¼æ‚¨å¯çœŸéœ¸é“å‘¢</span></strong><span>?ğŸ™†â€â™€ï¸</span></p><h3><a name="flow-å¼‚å¸¸å¤„ç†" class="md-header-anchor"></a><strong><span>Flow å¼‚å¸¸å¤„ç†</span></strong></h3><p><span>å½“æ“ä½œç¬¦å†…çš„å‘å°„å™¨æˆ–ä»£ç æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œæµæ”¶é›†å¯ä»¥ä»¥å¼‚å¸¸ç»“æŸã€‚ æœ‰å‡ ç§æ–¹æ³•å¯ä»¥å¤„ç†è¿™äº›å¼‚å¸¸ã€‚</span></p><h4><a name="trycatch" class="md-header-anchor"></a><span>try...catch</span></h4><p><span>è¾ƒä¸ºç®€å•ï¼Œä¸ŠğŸŒ°</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">simple</span>(): <span class="cm-variable">Flow</span><span class="cm-operator">&lt;</span><span class="cm-variable">Int</span><span class="cm-operator">&gt;</span> <span class="cm-operator">=</span> <span class="cm-variable">flow</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-number">1.</span>.<span class="cm-number">3</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"Emitting $i"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-variable">i</span>) <span class="cm-comment">// emit next value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>() <span class="cm-operator">=</span> <span class="cm-variable">runBlocking</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">simple</span>().<span class="cm-variable">collect</span> { <span class="cm-variable">value</span> <span class="cm-operator">-&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-variable">value</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">check</span>(<span class="cm-variable">value</span> <span class="cm-operator">&lt;=</span> <span class="cm-number">1</span>) { <span class="cm-string">"Collected $value"</span> }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">e</span>: <span class="cm-variable-3">Throwable</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"Caught $e"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  } </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//ç»“æœ &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">simple</span>(): <span class="cm-variable">Flow</span><span class="cm-operator">&lt;</span><span class="cm-variable">Int</span><span class="cm-operator">&gt;</span> <span class="cm-operator">=</span> <span class="cm-variable">flow</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-number">1.</span>.<span class="cm-number">3</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"Emitting $i"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-variable">i</span>) <span class="cm-comment">// emit next value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>() <span class="cm-operator">=</span> <span class="cm-variable">runBlocking</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">simple</span>().<span class="cm-variable">collect</span> { <span class="cm-variable">value</span> <span class="cm-operator">-&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-variable">value</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">value</span><span class="cm-operator">&gt;</span><span class="cm-number">1</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-variable">IllegalStateException</span>(<span class="cm-string">"exception value is $value"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">e</span>: <span class="cm-variable-3">Throwable</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"Caught $e"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 814px;"></div><div class="CodeMirror-gutters" style="display: none; height: 814px;"></div></div></div></pre><p><span>æ˜¾è€Œæ˜“è§ï¼ŒæŠ›å‡ºå¼‚å¸¸ä¹‹åï¼Œæ”¶é›†ç»“æŸï¼Œå¦‚æœæ˜¯UIé©±åŠ¨ç¨‹åºæ¯”å¦‚ï¼šAndroidè¿˜æ˜¯æ¨èä¸»ä»ä½œç”¨åŸŸï¼Œå¼‚å¸¸ä¸ä¼šå‘ä¸Šä¼ æ’­ã€‚</span></p><p><span>æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œåˆšåˆšå¼‚å¸¸æ˜¯å‘ç”Ÿåœ¨æ”¶é›†ç«¯ï¼Œå¦‚æœåœ¨æ„å»ºçš„æ—¶å€™å‘ç”Ÿå¼‚å¸¸å‘¢ï¼Ÿ</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">simple</span>(): <span class="cm-variable">Flow</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> <span class="cm-operator">=</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">flow</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-number">1.</span>.<span class="cm-number">3</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"Emitting $i"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-variable">i</span>) <span class="cm-comment">// emit next value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">map</span> { <span class="cm-variable">value</span> <span class="cm-operator">-&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">value</span><span class="cm-operator">&gt;</span><span class="cm-number">1</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-variable">IllegalStateException</span>(<span class="cm-string">"exception value is $value"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"string $value"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>() <span class="cm-operator">=</span> <span class="cm-variable">runBlocking</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">simple</span>().<span class="cm-variable">collect</span> { <span class="cm-variable">value</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">println</span>(<span class="cm-variable">value</span>) }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">e</span>: <span class="cm-variable-3">Throwable</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"Caught $e"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//ç»“æœ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Emitting</span> <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">string</span> <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Emitting</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Caught</span> <span class="cm-variable">java</span>.<span class="cm-variable">lang</span>.<span class="cm-variable">IllegalStateException</span>: <span class="cm-variable">exception</span> <span class="cm-variable">value</span> <span class="cm-keyword">is</span> <span class="cm-number">2</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 572px;"></div><div class="CodeMirror-gutters" style="display: none; height: 572px;"></div></div></div></pre><p><span>å®Œç¾ï¼šå¼‚å¸¸ä»è¢«æ•è·å¹¶åœæ­¢æ”¶é›†</span></p><p><span>ä¸Šè¿°ä»£ç çš„é—®é¢˜å°±æ˜¯ä¸å¤Ÿä¼˜é›…ï¼Œè¿˜æœ‰å¼‚å¸¸å¯¹äºæµæ¥è¯´å¿…é¡»æ˜¯é€æ˜çš„ï¼Œä½¿ç”¨try .. catch æ˜¾ç„¶è¿åäº†é€æ˜æ€§,æ‰€ä»¥Kotlin å°è£…äº†try catch.</span></p><h4><a name="catch-ç›¸å…³è¿ç®—ç¬¦" class="md-header-anchor"></a><span>catch ç›¸å…³è¿ç®—ç¬¦</span></h4><p><span>catch è¿ç®—ç¬¦çš„ä¸»ä½“å¯ä»¥åˆ†æå¼‚å¸¸å¹¶æ ¹æ®æ•è·çš„å¼‚å¸¸ä»¥ä¸åŒçš„æ–¹å¼å¯¹å…¶åšå‡ºååº”ï¼š</span></p><ul><li><span>å¯ä»¥ä½¿ç”¨ throw é‡æ–°æŠ›å‡ºå¼‚å¸¸ã€‚</span></li><li><span>å¯ä»¥ä½¿ç”¨ catch ä¸»ä½“ä¸­çš„å‘å°„å°†å¼‚å¸¸è½¬æ¢ä¸ºå€¼çš„å‘å°„ã€‚</span></li><li><span>å¼‚å¸¸å¯ä»¥è¢«å…¶ä»–ä»£ç å¿½ç•¥ã€è®°å½•æˆ–å¤„ç†ã€‚</span></li></ul><p><span>çœ‹ğŸŒ°</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">simple</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-keyword">catch</span> { <span class="cm-variable">e</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">emit</span>(<span class="cm-string">"Caught $e"</span>) } <span class="cm-comment">// æˆ‘ä¸ä»…æ•è·åˆ°äº†å¼‚å¸¸ï¼Œæˆ‘è¿˜èƒ½ç»§ç»­å‘å°„ï¼ï¼ï¼ï¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">collect</span> { <span class="cm-variable">value</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">println</span>(<span class="cm-variable">value</span>) }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p><span>ç»“æœ</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Emitting</span> <span class="cm-number">1</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">string</span> <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Emitting</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Caught</span> <span class="cm-variable">java</span>.<span class="cm-variable">lang</span>.<span class="cm-variable">IllegalStateException</span>: <span class="cm-variable">exception</span> <span class="cm-variable">value</span> <span class="cm-keyword">is</span> <span class="cm-number">2</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><p><span>å½“ç„¶å› ä¸ºæŠ›å‡ºäº†å¼‚å¸¸ï¼Œåç¨‹è¿˜æ˜¯ä¼šç»ˆæ­¢ï¼Œä½†æ˜¯æ­¤æ—¶å¼‚å¸¸æ˜¯ä»¥å‘ç”Ÿçš„å½¢å¼ä¼ é€’ä¸‹å»çš„ã€‚</span></p><p><strong><span>æ³¨æ„</span></strong><span>ï¼šcatch ä¸­é—´è¿ç®—ç¬¦ï¼Œå°Šé‡å¼‚å¸¸é€æ˜æ€§ï¼Œ</span><strong><span>åªæ•è·ä¸Šæ¸¸å¼‚å¸¸ï¼ˆå³æ¥è‡ª catch ä¹‹ä¸Šçš„æ‰€æœ‰è¿ç®—ç¬¦çš„å¼‚å¸¸ï¼Œä½†ä¸åœ¨å…¶ä¹‹ä¸‹ï¼‰ã€‚ å¦‚æœ collect { ... } ä¸­çš„å—ï¼ˆä½äº catch ä¸‹æ–¹ï¼‰æŠ›å‡ºå¼‚å¸¸</span></strong><span>ï¼Œåˆ™å®ƒä¸ä¼šæ•è·ï¼š</span></p><p><span>ğŸŒ°</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">simple</span>(): <span class="cm-variable">Flow</span><span class="cm-operator">&lt;</span><span class="cm-variable">Int</span><span class="cm-operator">&gt;</span> <span class="cm-operator">=</span> <span class="cm-variable">flow</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-number">1.</span>.<span class="cm-number">3</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"Emitting $i"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-variable">i</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>() <span class="cm-operator">=</span> <span class="cm-variable">runBlocking</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">simple</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-keyword">catch</span> { <span class="cm-variable">e</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">println</span>(<span class="cm-string">"Caught $e"</span>) } <span class="cm-comment">// ä¸ä¼šæ•è·åˆ°ä¸‹æ¸¸çš„å¼‚å¸¸</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">collect</span> { <span class="cm-variable">value</span> <span class="cm-operator">-&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">value</span> <span class="cm-operator">&lt;=</span> <span class="cm-number">1</span>) <span class="cm-keyword">throw</span> <span class="cm-variable">IllegalStateException</span>(<span class="cm-string">"Collected $value"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-variable">value</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Emitting</span> <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Emitting</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">Exception</span> <span class="cm-keyword">in</span> <span class="cm-variable">thread</span> <span class="cm-string">"main"</span> <span class="cm-variable">java</span>.<span class="cm-variable">lang</span>.<span class="cm-variable">IllegalStateException</span>: <span class="cm-variable">Collected</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">at</span> <span class="cm-variable">org</span>.<span class="cm-variable">example</span>.<span class="cm-variable">zxf</span>.<span class="cm-variable">kotlin11</span>.<span class="cm-variable">flow</span>.<span class="cm-variable">TestFlowKt$main$1$invokeSuspend$$inlined$collect$1</span>.<span class="cm-variable">emit</span>(<span class="cm-variable">Collect</span>.<span class="cm-variable">kt</span>:<span class="cm-number">133</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 462px;"></div><div class="CodeMirror-gutters" style="display: none; height: 462px;"></div></div></div></pre><p><span>è¿™ä¸ªæ—¶å€™å¯ä»¥åˆ©ç”¨onEachå°†éœ€è¦å¯èƒ½æ•è·å¼‚å¸¸çš„åœ°æ–¹å‰ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">simple</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">onEach</span> { <span class="cm-variable">value</span> <span class="cm-operator">-&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">check</span>(<span class="cm-variable">value</span> <span class="cm-operator">&lt;=</span> <span class="cm-number">1</span>) { <span class="cm-string">"Collected $value"</span> } &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-variable">value</span>) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-keyword">catch</span> { <span class="cm-variable">e</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">println</span>(<span class="cm-string">"Caught $e"</span>) }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">collect</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p><span>onCompletion ç›¸å…³æ“ä½œ</span></p><p><span>æˆ‘ä»¬çŸ¥é“å’Œtry ... catch æ­é…çš„ è¿˜æœ‰ä¸€ä¸ªfinallyã€‚æ‰€ä»¥ flowå½“ç„¶ä¹Ÿæœ‰ä¸€ä¸ªå·®ä¸å¤šçš„äº†ï¼Œå«</span><code>onCompletion</code></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">simple</span>(): <span class="cm-variable">Flow</span><span class="cm-operator">&lt;</span><span class="cm-variable">Int</span><span class="cm-operator">&gt;</span> <span class="cm-operator">=</span> <span class="cm-variable">flow</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-number">1.</span>.<span class="cm-number">3</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"Emitting $i"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-variable">i</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>() <span class="cm-operator">=</span> <span class="cm-variable">runBlocking</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">simple</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">onCompletion</span> { <span class="cm-variable">println</span>(<span class="cm-string">"Done"</span>) }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">collect</span> { <span class="cm-variable">value</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">println</span>(<span class="cm-variable">value</span>) }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//ç»“æœ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Emitting</span> <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Emitting</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Emitting</span> <span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Done</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 440px;"></div><div class="CodeMirror-gutters" style="display: none; height: 440px;"></div></div></div></pre><p><span>æŠ›ä¸ªå¼‚å¸¸è¯•è¯•,onCompletionå¯ä»¥é€šè¿‡causeè¿›è¡Œåˆ¤æ–­æ˜¯å¦æ˜¯æ­£å¸¸ç»“æŸ.</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">simple</span>(): <span class="cm-variable">Flow</span><span class="cm-operator">&lt;</span><span class="cm-variable">Int</span><span class="cm-operator">&gt;</span> <span class="cm-operator">=</span> <span class="cm-variable">flow</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-variable">RuntimeException</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-number">2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>() <span class="cm-operator">=</span> <span class="cm-variable">runBlocking</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">simple</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">onCompletion</span> { <span class="cm-variable">cause</span> <span class="cm-operator">-&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">cause</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"Flow completed exceptionally"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-keyword">catch</span> { <span class="cm-variable">cause</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">println</span>(<span class="cm-string">"Caught exception"</span>) }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">collect</span> { <span class="cm-variable">value</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">println</span>(<span class="cm-variable">value</span>) }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//ç»“æœ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Flow</span> <span class="cm-variable">completed</span> <span class="cm-variable">exceptionally</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Caught</span> <span class="cm-variable">exception</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 440px;"></div><div class="CodeMirror-gutters" style="display: none; height: 440px;"></div></div></div></pre><p><span>ä¸ catch è¿ç®—ç¬¦çš„å¦ä¸€ä¸ªåŒºåˆ«æ˜¯ onCompletion ä¼šçœ‹åˆ°æ‰€æœ‰å¼‚å¸¸ï¼Œå¹¶ä¸”ä»…åœ¨æˆåŠŸå®Œæˆä¸Šæ¸¸æµï¼ˆæ²¡æœ‰å–æ¶ˆæˆ–å¤±è´¥ï¼‰æ—¶æ‰ä¼šæ”¶åˆ°ç©ºå¼‚å¸¸ã€‚</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">simple</span>(): <span class="cm-variable">Flow</span><span class="cm-operator">&lt;</span><span class="cm-variable">Int</span><span class="cm-operator">&gt;</span> <span class="cm-operator">=</span> (<span class="cm-number">1.</span>.<span class="cm-number">3</span>).<span class="cm-variable">asFlow</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>() <span class="cm-operator">=</span> <span class="cm-variable">runBlocking</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">simple</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">onCompletion</span> { <span class="cm-variable">cause</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">println</span>(<span class="cm-string">"Flow completed with $cause"</span>) }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">collect</span> { <span class="cm-variable">value</span> <span class="cm-operator">-&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">value</span><span class="cm-operator">&gt;</span><span class="cm-number">1</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-variable">IllegalStateException</span>(<span class="cm-string">"exception value is $value"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-variable">value</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//ç»“æœ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Flow</span> <span class="cm-variable">completed</span> <span class="cm-variable">with</span> <span class="cm-variable">java</span>.<span class="cm-variable">lang</span>.<span class="cm-variable">IllegalStateException</span>: <span class="cm-variable">exception</span> <span class="cm-variable">value</span> <span class="cm-keyword">is</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">Exception</span> <span class="cm-keyword">in</span> <span class="cm-variable">thread</span> <span class="cm-string">"main"</span> <span class="cm-variable">java</span>.<span class="cm-variable">lang</span>.<span class="cm-variable">IllegalStateException</span>: <span class="cm-variable">exception</span> <span class="cm-variable">value</span> <span class="cm-keyword">is</span> <span class="cm-number">2</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 352px;"></div><div class="CodeMirror-gutters" style="display: none; height: 352px;"></div></div></div></pre><p><span>æ³¨æ„ä¸€ç‚¹ï¼š</span><strong><span>è™½ç„¶çœ‹åˆ°äº†ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¿›è¡Œæ•è·ã€‚å¼‚å¸¸è¿˜æ˜¯æŠ›å‡ºäº†</span></strong><span>ã€‚</span></p><h3><a name="flow-å¯åŠ¨" class="md-header-anchor"></a><span>Flow å¯åŠ¨</span></h3><p><span>æœ€åæä¸€ç‚¹å’Œå¯åŠ¨ç›¸å…³çš„ï¼Œå…ˆçœ‹ä¸‹é¢ä¸¤ä¸ªä¾‹å­ï¼š</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">events</span>(): <span class="cm-variable">Flow</span><span class="cm-operator">&lt;</span><span class="cm-variable">Int</span><span class="cm-operator">&gt;</span> <span class="cm-operator">=</span> (<span class="cm-number">1.</span>.<span class="cm-number">3</span>).<span class="cm-variable">asFlow</span>().<span class="cm-variable">onEach</span> { <span class="cm-variable">delay</span>(<span class="cm-number">100</span>) }</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>() <span class="cm-operator">=</span> <span class="cm-variable">runBlocking</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">events</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">onEach</span> { <span class="cm-variable">event</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">println</span>(<span class="cm-string">"Event: $event"</span>) }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">collect</span>() <span class="cm-comment">// &lt;--- collect æŒ‚èµ·å‡½æ•°é˜»å¡</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"Done"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//ç»“æœ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Event</span>: <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Event</span>: <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Event</span>: <span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Done</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre><p><span>å¯¹äºä¸Šè¿°ï¼Œæ²¡æœ‰å¼‚è®®å§ï¼Œ</span><code>Done</code><span>çš„æ‰“å°éœ€è¦ç­‰å¾…</span><code>collect</code><span>æ¢å¤ï¼Œå› ä¸ºåœ¨ä¸€ä¸ªåç¨‹å†…ã€‚å¦‚æœéœ€è¦ä¸ç­‰å¾…å‘¢ï¼Ÿé‚£å°±éœ€è¦å¦èµ·ä¸€ä¸ªåç¨‹äº†</span></p><p><span>ğŸŒ°</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>() <span class="cm-operator">=</span> <span class="cm-variable">runBlocking</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">launch</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">events</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">onEach</span> { <span class="cm-variable">event</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">println</span>(<span class="cm-string">"Event: $event"</span>) }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">collect</span>() <span class="cm-comment">// &lt;--- collect æŒ‚èµ·å‡½æ•°é˜»å¡</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"Done"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//ç»“æœ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Done</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Event</span>: <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Event</span>: <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Event</span>: <span class="cm-number">3</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre><p><span>ä½†æ˜¯ä¸Šè¿°å†™æ³•å¯ä»¥ç­‰ä»·äºï¼Œä¸‹é¢çš„å†™æ³•ï¼Œflowè¿™ç©æ„å°è£…äº†å¦ä¸€ç§å¯åŠ¨æ–¹å¼</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>() <span class="cm-operator">=</span> <span class="cm-variable">runBlocking</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">events</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">onEach</span> { <span class="cm-variable">event</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">println</span>(<span class="cm-string">"Event: $event"</span>) }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">launchIn</span>(<span class="cm-keyword">this</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-string">"Done"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//ç»“æœ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Done</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Event</span>: <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Event</span>: <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Event</span>: <span class="cm-number">3</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 242px;"></div><div class="CodeMirror-gutters" style="display: none; height: 242px;"></div></div></div></pre><p><span>çœ‹ä¸€ä¸‹launchInæºç ï¼</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">fun</span> <span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> <span class="cm-variable">Flow</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span>.<span class="cm-variable">launchIn</span>(<span class="cm-variable">scope</span>: <span class="cm-variable">CoroutineScope</span>): <span class="cm-variable">Job</span> <span class="cm-operator">=</span> <span class="cm-variable">scope</span>.<span class="cm-variable">launch</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">collect</span>() <span class="cm-comment">// tail-call</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p><span>å¥½å§ï¼Œå…¶å®ä¸å°±æ˜¯å°è£…äº†ä¸€ä¸‹å˜›ã€‚ä¸»è¦æ˜¯æºç å¥½å¤šåœ°æ–¹ä½¿ç”¨</span><code>launchIn</code><span>æ¥ç€ï¼Œæ‰€ä»¥è¿™é‡Œæä¸€ä¸‹ğŸ™†â€â™€ï¸ã€‚</span></p><h2><a name="flowåŸç†è§£æ" class="md-header-anchor"></a><strong><span>FlowåŸç†è§£æ</span></strong></h2><p><span>å¥½å§ï¼Œæ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»ç»ˆäºæ¥äº†ï¼Œåšä¸€äº›æºç åˆ†æã€‚</span></p><p><span>å…ˆå†™ä¸€ä¸ªå°ğŸŒ°</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">fun</span> <span class="cm-def">main</span>() <span class="cm-operator">=</span> <span class="cm-variable">runBlocking</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">flow</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-number">2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-number">3</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }.<span class="cm-variable">collect</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-variable">it</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 198px;"></div><div class="CodeMirror-gutters" style="display: none; height: 198px;"></div></div></div></pre><p><span>å¥½äº†ï¼Œæˆ‘ä»¬å°±åˆ†æè¿™ç©æ„æ€ä¹ˆå®ç°çš„ï¼å¾€æ·±ç¯‡å¹…æœ‰é™å†™ä¸ä¸‹äº†ğŸ™„ã€‚å¦‚æœæ‚¨æƒ³æ·±å…¥äº¤æµï¼Œæ¬¢è¿ç§ä¿¡äº¤æµã€‚</span></p><p><span>æ‰€ä»¥ï¼Œæˆ‘å…ˆåˆ—å‡ºæ¥</span><code>flow</code><span>å‡½æ•°æ„å»ºçš„æºç ï¼Œåªè´´å‡ºæ ¸å¿ƒä»£ç ï¼š</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">fun</span> <span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> <span class="cm-variable">flow</span>(<span class="cm-variable">@BuilderInference</span> <span class="cm-variable">block</span>: <span class="cm-keyword">suspend</span> <span class="cm-variable">FlowCollector</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span>.() <span class="cm-operator">-&gt;</span> <span class="cm-variable">Unit</span>): <span class="cm-variable">Flow</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> <span class="cm-operator">=</span> <span class="cm-variable">SafeFlow</span>(<span class="cm-variable">block</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// Named anonymous object</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span> <span class="cm-keyword">class</span> <span class="cm-def">SafeFlow</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span>(<span class="cm-keyword">private</span> <span class="cm-keyword">val</span> <span class="cm-def">block</span>: <span class="cm-keyword">suspend</span> <span class="cm-variable">FlowCollector</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span>.() <span class="cm-operator">-&gt;</span> <span class="cm-variable">Unit</span>) : <span class="cm-variable">AbstractFlow</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">override</span> <span class="cm-keyword">suspend</span> <span class="cm-keyword">fun</span> <span class="cm-def">collectSafely</span>(<span class="cm-variable">collector</span>: <span class="cm-variable">FlowCollector</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">collector</span>.<span class="cm-variable">block</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p><span>å¯ä»¥çœ‹å‡º</span><code>flow</code><span>æ„å»ºäº†ä¸€ä¸ª</span><code>SafeFlow</code><span>å°†</span><code>block</code><span>ä¼ å…¥ã€‚å¹¶ä¸”é‡å†™äº†</span><code>collectSafely</code><span>æ–¹æ³•ï¼Œè°ƒç”¨äº†</span><code>block()</code><span>ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹</span><code>SafeFlow</code><span>ç»§æ‰¿è‡ª</span><code>AbstractFlow</code><span>.</span></p><p><span>å¥½ï¼Œæˆ‘ä»¬åœ¨çœ‹ä¸€è°ƒç”¨</span><code>collect</code><span>ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆã€‚</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">suspend</span> <span class="cm-keyword">inline</span> <span class="cm-keyword">fun</span> <span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> <span class="cm-variable">Flow</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span>.<span class="cm-variable">collect</span>(<span class="cm-keyword">crossinline</span> <span class="cm-variable">action</span>: <span class="cm-keyword">suspend</span> (<span class="cm-variable">value</span>: <span class="cm-variable">T</span>) <span class="cm-operator">-&gt;</span> <span class="cm-variable">Unit</span>): <span class="cm-variable">Unit</span> <span class="cm-operator">=</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">collect</span>(<span class="cm-keyword">object</span> : <span class="cm-variable">FlowCollector</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">override</span> <span class="cm-keyword">suspend</span> <span class="cm-keyword">fun</span> <span class="cm-def">emit</span>(<span class="cm-variable">value</span>: <span class="cm-variable">T</span>) <span class="cm-operator">=</span> <span class="cm-variable">action</span>(<span class="cm-variable">value</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  })</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">abstract</span> <span class="cm-keyword">class</span> <span class="cm-def">AbstractFlow</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> : <span class="cm-variable">Flow</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span>, <span class="cm-variable">CancellableFlow</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">final</span> <span class="cm-keyword">override</span> <span class="cm-keyword">suspend</span> <span class="cm-keyword">fun</span> <span class="cm-def">collect</span>(<span class="cm-variable">collector</span>: <span class="cm-variable">FlowCollector</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">safeCollector</span> <span class="cm-operator">=</span> <span class="cm-variable">SafeCollector</span>(<span class="cm-variable">collector</span>, <span class="cm-variable">coroutineContext</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//è°ƒç”¨äº†collectSafely å…·ä½“åœ¨SafeFlowé‡Œé¢å®ç°ï¼ˆä¸Šæ–¹æºç ï¼‰ å°†safeCollectorä¼ é€’è¿›å» è°ƒç”¨äº†flowæ„å»ºå™¨block</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">collectSafely</span>(<span class="cm-variable">safeCollector</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">finally</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">safeCollector</span>.<span class="cm-variable">releaseIntercepted</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }<span class="cm-tab" role="presentation" cm-text="	"> </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">abstract</span> <span class="cm-keyword">suspend</span> <span class="cm-keyword">fun</span> <span class="cm-def">collectSafely</span>(<span class="cm-variable">collector</span>: <span class="cm-variable">FlowCollector</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 374px;"></div><div class="CodeMirror-gutters" style="display: none; height: 374px;"></div></div></div></pre><p><span>çœ‹çš„å‡ºï¼Œè¿™æ—¶å°†collectçš„</span><code>block</code><span>å°è£…æˆäº†</span><code>FlowCollector</code><span>ç±»å‹ï¼ˆé‡å†™emitæ–¹æ³•ç”¨äºæ‰§è¡Œ</span><code>block</code><span>ï¼‰ï¼Œæ­¤æ—¶ä¼šè°ƒç”¨åˆ°</span><code>SafeFlow</code><span>çš„</span><code>collect</code><span>æ–¹æ³•ï¼Œå…·ä½“åœ¨</span><code>AbstractFlow</code><span>é‡Œé¢å®ç°ã€‚è¿™é‡Œé¢å¹²äº†ä»€ä¹ˆå‘¢ï¼Ÿçœ‹çš„å‡ºï¼Œåˆ›å»ºäº†</span><code>SafeCollector</code><span>ç±»å‹çš„ä¸œè¥¿ï¼Œç„¶åå°†</span><code>SafeCollector</code><span>ä¼ é€’ç»™äº†</span><code>collectSafely</code><span>ã€‚è€Œåœ¨ä¸Šé¢çš„åˆ†æä¸­ï¼Œæˆ‘ä»¬çŸ¥é“</span><code>collectSafely</code><span>åœ¨æ„å»º</span><code>flow</code><span>æ—¶è¿›è¡Œäº†å®ç°ï¼Œ</span><code>SafeCollector</code><span>ä½œä¸ºreceiverä»¥æ‰©å±•å‡½æ•°çš„å½¢å¼è°ƒç”¨äº†ï¼Œflowæ„å»ºå™¨çš„</span><code>block</code><span>(è¿™é‡Œé¢æ‰§è¡Œäº†ï¼Œæˆ‘ä»¬æ‰‹åŠ¨çš„emitæ“ä½œ)ã€‚è¿™ä¹ˆä¸€çœ‹æ˜¯ä¸æ˜¯æœ‰ç‚¹è”ç³»èµ·æ¥äº†ğŸ˜</span></p><p><span>å¥½çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­åˆ†æä¸€ä¸‹ï¼Œ</span><code>SafeCollector</code><span>ï¼Œé‚£è¿™ç©æ„çš„æºç å…¶å®ä¹Ÿæ˜¯æœ‰ç‚¹å¤šçš„ï¼Œæˆ‘ä»¬åº”è¯¥çœ‹å“ªä¸€ä¸ªå‡½æ•°å‘¢ï¼Ÿé€šè¿‡ä¸Šé¢çš„åˆ†æå¯çŸ¥ï¼Œè°ƒç”¨</span><code>collect</code><span>ä¹‹åï¼Œä¼šè°ƒç”¨åˆ°</span><code>SafeFlow</code><span>çš„</span><code>collect</code><span>æ–¹æ³•ï¼Œè¿›è€Œä¼šä»¥æ‰©å±•å‡½æ•°çš„å½¢å¼è°ƒç”¨åˆ°</span><code>flow</code><span>çš„blockï¼Œè€Œåœ¨blocké‡Œé¢å°±æ˜¯æˆ‘ä»¬è‡ªå·±å†™çš„emitäº†ï¼Œæ‰€ä»¥receiveræ—¢ç„¶æ˜¯</span><code>SafeCollector</code><span>,é‚£è‚¯å®šå°±æ˜¯è°ƒç”¨</span><code>SafeCollector</code><span>çš„emitäº†ï¼Œæˆ‘ä»¬å»ç…ä¸€ç…</span><code>SafeCollector</code><span>çš„emitå‡½æ•°ç›¸å…³çš„è°ƒç”¨é“¾:ğŸ‘€</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-keyword">override</span> <span class="cm-keyword">suspend</span> <span class="cm-keyword">fun</span> <span class="cm-def">emit</span>(<span class="cm-variable">value</span>: <span class="cm-variable">T</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span>...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emit</span>(<span class="cm-variable">uCont</span>, <span class="cm-variable">value</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">e</span>: <span class="cm-variable-3">Throwable</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">fun</span> <span class="cm-def">emit</span>(<span class="cm-variable">uCont</span>: <span class="cm-variable">Continuation</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;</span>, <span class="cm-variable">value</span>: <span class="cm-variable">T</span>): <span class="cm-variable">Any</span><span class="cm-operator">?</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">emitFun</span>(<span class="cm-variable">collector</span> <span class="cm-keyword">as</span> <span class="cm-variable">FlowCollector</span><span class="cm-operator">&lt;</span><span class="cm-variable">Any</span><span class="cm-operator">?&gt;</span>, <span class="cm-variable">value</span>, <span class="cm-keyword">this</span> <span class="cm-keyword">as</span> <span class="cm-variable">Continuation</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">val</span> <span class="cm-def">emitFun</span> <span class="cm-operator">=</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">FlowCollector</span><span class="cm-operator">&lt;</span><span class="cm-variable">Any</span><span class="cm-operator">?&gt;</span>::<span class="cm-variable">emit</span> <span class="cm-keyword">as</span> <span class="cm-variable">Function3</span><span class="cm-operator">&lt;</span><span class="cm-variable">FlowCollector</span><span class="cm-operator">&lt;</span><span class="cm-variable">Any</span><span class="cm-operator">?&gt;</span>, <span class="cm-variable">Any</span><span class="cm-operator">?</span>, <span class="cm-variable">Continuation</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;</span>, <span class="cm-variable">Any</span><span class="cm-operator">?&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 330px;"></div><div class="CodeMirror-gutters" style="display: none; height: 330px;"></div></div></div></pre><p><span>å¥½äº†ï¼Œç»è¿‡ç®€åŒ–ä¹‹åï¼Œå°±æ˜¯ä¸Šé¢è¿™äº›ç©æ„å„¿äº†ã€‚</span></p><p><span>é¦–å…ˆï¼Œéœ€è¦åˆ†æ¸…å‡ ä¸ªä¸œè¥¿ã€‚</span></p><p><code>collector</code><span>å’Œ</span><code>this</code><span>çš„åŒºåˆ«</span></p><ul><li><span>collectorï¼šè¿˜è®°å¾—ä¸Šé¢çš„æºç å—ï¼Ÿæˆ‘ä»¬è°ƒç”¨</span><code>collect</code><span>çš„blockå°è£…åˆ°äº†ä¸€ä¸ª</span><code>FlowCollector</code><span>ï¼Œç„¶åä¼ é€’ç»™äº†</span><code>SafeCollector</code><span>ï¼Œcollectorå°±æŒ‡</span><code>FlowCollector</code><span>ã€‚è¿™é‡Œé¢é‡å†™äº†emitï¼Œemité‡Œé¢è°ƒç”¨äº†</span><code>block</code><span>ï¼Œè¿™ä¸ª</span><code>block</code><span>å°±æ˜¯æˆ‘ä»¬è‡ªå·±å†™çš„äº†ï¼Œè¿™ä¸ªæ—¶é—´ç®€å•ç†è§£è°ƒç”¨collectorçš„emitå°±å¯ä»¥è°ƒç”¨åˆ°collectçš„</span><code>block</code><span>äº†ã€‚</span></li><li><span>thisï¼šç†è§£äº†collectorï¼Œthiså°±æŒ‡ä»£å½“å‰çš„</span><code>SafeCollector</code><span>äº†ã€‚</span></li></ul><p><span>ç°åœ¨æˆ‘ä»¬ç»§ç»­çœ‹ä¸Šé¢çš„ä»£ç ï¼šé¢ æ­¤æ—¶å¥½åƒè¿˜éœ€è¦ç†è§£ä¸€ä¸ªä¸œè¥¿emitFun</span></p><p><span>æˆ‘ä»¬æŠŠå®ƒç¿»è¯‘æˆjavaçœ‹ä¸€ä¸‹</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">private</span> <span class="cm-keyword">static</span> <span class="cm-keyword">final</span> <span class="cm-variable">Function3</span> <span class="cm-variable">emitFun</span> <span class="cm-operator">=</span> (<span class="cm-variable">Function3</span>)<span class="cm-variable">TypeIntrinsics</span>.<span class="cm-variable">beforeCheckcastToFunctionOfArity</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Function3</span>() {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-comment">// $FF: synthetic method</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-comment">// $FF: bridge method</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">Object</span> <span class="cm-variable">invoke</span>(<span class="cm-variable-3">Object</span> <span class="cm-variable">var1</span>, <span class="cm-variable-3">Object</span> <span class="cm-variable">var2</span>, <span class="cm-variable-3">Object</span> <span class="cm-variable">var3</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">return</span> <span class="cm-keyword">this</span>.<span class="cm-variable">invoke</span>((<span class="cm-variable">FlowCollector</span>)<span class="cm-variable">var1</span>, <span class="cm-variable">var2</span>, (<span class="cm-variable">Continuation</span>)<span class="cm-variable">var3</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-meta">@Nullable</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">Object</span> <span class="cm-variable">invoke</span>(<span class="cm-meta">@NotNull</span> <span class="cm-variable">FlowCollector</span> <span class="cm-variable">p1</span>, <span class="cm-meta">@Nullable</span> <span class="cm-variable-3">Object</span> <span class="cm-variable">p2</span>, <span class="cm-meta">@NotNull</span> <span class="cm-variable">Continuation</span> <span class="cm-variable">continuation</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">return</span> <span class="cm-variable">p1</span>.<span class="cm-variable">emit</span>(<span class="cm-variable">p2</span>, <span class="cm-variable">continuation</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; }, <span class="cm-number">3</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 308px;"></div><div class="CodeMirror-gutters" style="display: none; height: 308px;"></div></div></div></pre><p><span>ç®€å•æ˜äº†ï¼Œå°±æ˜¯è°ƒç”¨äº†collectorçš„emitå‡½æ•°ï¼Œä½†æ˜¯ä½ å¯èƒ½ä¼šè¯´ï¼Œemitä¸æ˜¯æ”¯æŒä¸€ä¸ªå‚æ•°å—ï¼Ÿä¸Šé¢ä¼ è¿›å»ä¿©å•Šï¼Œä½†æ˜¯ä½ åˆ«å¿˜äº†ï¼Œemitæ˜¯æŒ‚èµ·å‡½æ•°ï¼Œé»˜è®¤æœ‰ä¸€ä¸ªå‚æ•°çš„ä¼ é€’å°±æ˜¯continuationï¼Œè¿™ä¸€å—Kotlinæ›¿æˆ‘ä»¬åšäº†ï¼Œä½†æ˜¯å¯¹äºJavaæ¥è¯´å¿…é¡»è¦ä¼ é€’continuationè¿›å»ã€‚é€šè¿‡è¿™ç§æ–¹å¼ä¼ å…¥ä¸€æ ·çš„continuationã€‚ä¿è¯äº†continuationçš„ç»Ÿä¸€ã€‚</span></p><p><strong><span>å¥½äº†ï¼Œæ€»ç»“ä¸€ä¸‹ï¼š</span></strong></p><p><span>åˆ†æä¸‹æ¥ï¼Œç®€å•å°±æ˜¯ï¼Œåˆ©ç”¨æ‰©å±•å‡½æ•°çš„æ€§è´¨ï¼Œè°ƒç”¨åˆ°</span><code>flow</code><span>çš„blockè¿›è€Œè°ƒç”¨äº†</span><code>SafeCollector</code><span>çš„emitï¼Œè€Œè¿™é‡Œçš„emitä¼šè°ƒç”¨åˆ°ä¼ è¿›æ¥çš„FlowCollectorçš„emitï¼Œè€Œä¼ è¿›æ¥çš„emitå‡½æ•°è¢«é‡å†™è°ƒç”¨blockï¼Œæ‰€ä»¥å°±ä¼šè°ƒç”¨åˆ°collectçš„blockäº†ã€‚</span></p><p><span>å¦å¤–å› ä¸ºï¼Œåªæœ‰è°ƒç”¨collectä¹‹åï¼Œè¿›è€Œæ‰ä¼šè°ƒç”¨åˆ°</span><code>SafeFlow</code><span>çš„collectå‡½æ•°ï¼Œè¿›è€Œæ‰ä¼šè°ƒç”¨åˆ°</span><code>collectSafely</code><span>å‡½æ•°å»æ‰§è¡Œflowçš„ä»£ç ã€‚</span><strong><span>æ‰€ä»¥ä¸è°ƒç”¨collectçš„è¯ï¼Œflowçš„ä»£ç æ„å»ºå—çš„ä»£ç æ˜¯ä¸ä¼šæ‰§è¡Œçš„ï¼Œæœ€å¤šå°±æ˜¯è¿”å›ä¸€ä¸ª</span><code>SafeFlow</code><span>çš„å¯¹è±¡è€Œå·²</span></strong><span>ã€‚</span></p><p><span>å¯¹äºå„ç§æ“ä½œç¬¦çš„æºç ï¼Œè¿™é‡Œä¸å¸¦ç€å¤§å®¶çœ‹äº†ï¼Œä¸æ˜¯å¾ˆéš¾ï¼Œé‡Œé¢å°±æ˜¯é¥¶äº†ä¸€åœˆï¼Œåˆè¿”å›äº†æµè€Œå·²ã€‚å¯ä»¥è‡ªå·±æŸ¥çœ‹ã€‚</span></p><p><span>å¦å¤–å¯¹äºflowOnæˆ–è€…å…¶ä»–æ“ä½œç¬¦ï¼Œå¯¼è‡´è°ƒåº¦å™¨ä¸ä¸€è‡´æ—¶ï¼Œæ­¤æ—¶åº•å±‚å°†ä¸å†ä¸Šä¸Šé¢è¿™ä¸€å¥—çš„é€»è¾‘ï¼Œå†…éƒ¨æ˜¯ä½¿ç”¨</span><code>ChannelFlow</code><span>å®ç°ã€‚è¿™ä¸€å—æ„Ÿå…´è¶£çš„ä¹Ÿå¯ä»¥ç…ç…æºç ï¼Œä¹Ÿå¯ä»¥ä¸åšä¸»ç§ä¿¡äº¤æµï¼Œé‡Œé¢è¿˜æ˜¯æ¯”è¾ƒç»•ã€‚ã€‚ã€‚</span></p><h1><a name="stateflowsharedflow" class="md-header-anchor"></a><span>StateFlowã€SharedFlow</span></h1><p><span>å…ˆçœ‹ä¸€ä¸‹Googleå¯¹äºStateFlowå’ŒSharedFlowçš„ä»‹ç»ğŸ™†â€â™€ï¸:</span></p><blockquote><p><code>StateFlow</code><span> and </span><code>SharedFlow</code><span> are Flow APIs that enable flows to optimally emit state updates and emit values to multiple consumers.</span></p><p><span>StateFlow å’Œ SharedFlow æ˜¯ Flow APIï¼Œå®ƒä»¬ä½¿æµèƒ½å¤Ÿä»¥æœ€ä½³æ–¹å¼å‘å‡ºçŠ¶æ€æ›´æ–°å¹¶å‘å¤šä¸ªæ¶ˆè´¹è€…å‘å‡ºå€¼</span></p></blockquote><p><span>StateFlowå’ŒSharedFlowæ˜¯ä¸€ç§å¾ˆç‰¹æ®Šçš„Flowï¼Œå®ƒä»¬æ˜¯</span><strong><span>çƒ­æµ</span></strong><span>ã€‚ä»‹ç»Flowçš„æ—¶å€™æœ‰è¯´è¿‡ï¼Œå®ƒæ˜¯å†·æµï¼Œå†ä¸è°ƒç”¨ç»ˆç«¯æ“ä½œç¬¦çš„æƒ…å†µä¸‹ï¼ŒFlowæ„å»ºå—çš„ä»£ç æ˜¯ä¸ä¼šæ‰§è¡Œçš„ï¼Œæ¯ä¸€ä¸ªæ¶ˆè´¹è€…è°ƒç”¨ä¸€æ¬¡Flowï¼Œåˆ™æ„å»ºå—çš„ä»£ç ä¼šä»å¤´åˆ°å°¾æ‰§è¡Œä¸€æ¬¡ã€‚è€Œ</span><strong><span>çƒ­æµå¯ä»¥ä¸ä¾èµ–æ¶ˆè´¹è€…è€Œå­˜æ´»ï¼Œå¯ä»¥åœ¨æµä¹‹å¤–ç”Ÿæˆæ•°æ®ï¼Œç„¶åä¼ é€’ç»™æµ</span></strong><span>ã€‚</span></p><p><span>çœŸæ‰€è°“ï¼Œç”±ç®€å…¥ç¹ï¼Œç¹å°½è‡³ç®€ğŸ˜®ã€‚</span></p><p><span>æˆ‘ä»¬å…ˆä»StateFlowå’ŒSharedFlowçš„ä½¿ç”¨è®²èµ·ï¼ˆä¼šç¨å¸¦æ¶‰åŠåˆ°StateFlowå’ŒLiveDataçš„åŒºåˆ«ï¼‰ï¼Œè€Œåå¯¹å…¶æ ¸å¿ƒå®ç°è¿›è¡Œæºç åˆ†æã€‚</span></p><h2><a name="stateflowä½¿ç”¨" class="md-header-anchor"></a><span>StateFlowä½¿ç”¨</span></h2><h3><a name="stateflowç®€ä»‹" class="md-header-anchor"></a><span>StateFlowç®€ä»‹</span></h3><p><span>StateFlow æ˜¯ä¸€ä¸ªçŠ¶æ€æŒæœ‰è€…å¯è§‚å¯Ÿæµï¼Œå®ƒå‘å…¶æ”¶é›†å™¨å‘å‡ºå½“å‰å’Œæ–°çŠ¶æ€æ›´æ–°ã€‚ å½“å‰çŠ¶æ€å€¼ä¹Ÿå¯ä»¥é€šè¿‡å…¶ value å±æ€§è¯»å–ã€‚ è¦æ›´æ–°çŠ¶æ€å¹¶å°†å…¶å‘é€åˆ°æµã€‚</span></p><p><span>StateFlowæä¾›</span><code>å¯è¯»å¯å†™</code><span>å’Œ</span><code>ä»…å¯è¯»</code><span>ä¸¤ä¸ªç‰ˆæœ¬ï¼Œè¿™ä¸€ç‚¹å’Œ</span><code>LiveData</code><span>ç›¸ä¼¼ï¼Œå¦‚ä¸‹è¡¨æ ¼ğŸ™†â€â™€ï¸ã€‚</span></p><figure><table><thead><tr><th style='text-align:center;' >&nbsp;</th><th style='text-align:center;' ><span>ä»…å¯è¯»</span></th><th style='text-align:center;' ><span>å¯è¯»å¯å†™</span></th></tr></thead><tbody><tr><td style='text-align:center;' ><span>LiveData</span></td><td style='text-align:center;' ><span>LiveData</span></td><td style='text-align:center;' ><span>MutableLiveData</span></td></tr><tr><td style='text-align:center;' ><span>StateFlow</span></td><td style='text-align:center;' ><span>StateFlow</span></td><td style='text-align:center;' ><span>SharedFlow</span></td></tr></tbody></table></figure><h3><a name="stateflowçš„ç”¨æ³•" class="md-header-anchor"></a><span>StateFlowçš„ç”¨æ³•</span></h3><p><span>StateFlow éå¸¸é€‚åˆéœ€è¦ç»´æŠ¤å¯è§‚å¯Ÿçš„å¯å˜çŠ¶æ€çš„ç±»ã€‚</span></p><p><span>ç®€å•ä½¿ç”¨ä¸¾ä¾‹ğŸŒ°</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">value</span> <span class="cm-operator">=</span> <span class="cm-variable">AtomicInteger</span>(<span class="cm-number">0</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">stateFlow</span> <span class="cm-operator">=</span> <span class="cm-variable">MutableStateFlow</span>(<span class="cm-variable">value</span>.<span class="cm-variable">incrementAndGet</span>()) <span class="cm-comment">//+1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">stateFlow</span>.<span class="cm-variable">value</span> <span class="cm-operator">=</span> <span class="cm-variable">value</span>.<span class="cm-variable">incrementAndGet</span>()<span class="cm-comment">// +1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">runBlocking</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">GlobalScope</span>.<span class="cm-variable">launch</span> (<span class="cm-variable">Dispatchers</span>.<span class="cm-variable">Default</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">stateFlow</span>.<span class="cm-variable">collect</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"receiver value $it"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">GlobalScope</span>.<span class="cm-variable">launch</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">2000</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">stateFlow</span>.<span class="cm-variable">collect</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"receiver2 value $it"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-atom">true</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">1000</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">sendValue</span> <span class="cm-operator">=</span> <span class="cm-variable">value</span>.<span class="cm-variable">incrementAndGet</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"sendValue$sendValue"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">stateFlow</span>.<span class="cm-variable">emit</span>(<span class="cm-variable">sendValue</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//è¾“å‡º</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">21</span>:<span class="cm-number">42</span>:<span class="cm-number">34</span>:<span class="cm-number">789</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-keyword">receiver</span> <span class="cm-variable">value</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">21</span>:<span class="cm-number">42</span>:<span class="cm-number">35</span>:<span class="cm-number">781</span> [<span class="cm-variable">main</span>] <span class="cm-variable">sendValue3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">21</span>:<span class="cm-number">42</span>:<span class="cm-number">35</span>:<span class="cm-number">781</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-keyword">receiver</span> <span class="cm-variable">value</span> <span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">21</span>:<span class="cm-number">42</span>:<span class="cm-number">36</span>:<span class="cm-number">784</span> [<span class="cm-variable">main</span>] <span class="cm-variable">sendValue4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">21</span>:<span class="cm-number">42</span>:<span class="cm-number">36</span>:<span class="cm-number">784</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-keyword">receiver</span> <span class="cm-variable">value</span> <span class="cm-number">4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">21</span>:<span class="cm-number">42</span>:<span class="cm-number">36</span>:<span class="cm-number">784</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-variable">receiver2</span> <span class="cm-variable">value</span> <span class="cm-number">4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">21</span>:<span class="cm-number">42</span>:<span class="cm-number">37</span>:<span class="cm-number">786</span> [<span class="cm-variable">main</span>] <span class="cm-variable">sendValue5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">21</span>:<span class="cm-number">42</span>:<span class="cm-number">37</span>:<span class="cm-number">786</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-keyword">receiver</span> <span class="cm-variable">value</span> <span class="cm-number">5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">21</span>:<span class="cm-number">42</span>:<span class="cm-number">37</span>:<span class="cm-number">786</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">2</span>] <span class="cm-variable">receiver2</span> <span class="cm-variable">value</span> <span class="cm-number">5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 726px;"></div><div class="CodeMirror-gutters" style="display: none; height: 726px;"></div></div></div></pre><p><span>ä¸‹é¢æ¥è§£é‡Šä¸€ä¸‹ğŸ™†â€â™€ï¸ï¼š</span></p><ul><li><span>æˆ‘ä»¬åˆ›å»ºäº†AtomicIntegeråˆå§‹å€¼ä¸º0ï¼Œæˆ‘ä»¬è°ƒç”¨incrementAndGetè·å–å€¼ï¼Œç„¶åä¼ å…¥MutableStateFlowæ„é€ æ–¹æ³•ï¼Œæ„å»ºStateFlowã€‚ä¹‹åè®¾ç½®StateFlowçš„å±æ€§</span><code>value = incrementAndGet</code><span>ã€‚æ³¨æ„ï¼šä¸Šé¢è¯´çš„ä¸€ç³»åˆ—æ“ä½œéƒ½æ˜¯æ²¡æœ‰æ¶ˆè´¹è€…è®¢é˜…çš„æƒ…å†µä¸‹è¿›è¡Œçš„ï¼Œä¹‹åå¯åŠ¨ç¬¬ä¸€ä¸ªåç¨‹è¿›è¡Œcollectï¼Œæ‰“å°å‡ºæ¥çš„ç¬¬ä¸€ä¸ªå€¼æ˜¯2ã€‚è¯´æ˜ï¼šåœ¨æ²¡æœ‰è®¢é˜…è€…çš„æƒ…å†µä¸‹ï¼Œæµä¾æ—§è¿›è¡Œäº†æ‰§è¡Œã€‚</span></li><li><span>å†çœ‹ä»£ç æœ€ä¸‹é¢å†™äº†æ­»å¾ªç¯ï¼Œæ¯éš”1ç§’é’Ÿemitä¸€ä¸ªå€¼ç»™åˆ°StateFlowï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªåç¨‹æ‰‹æœºæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä¹Ÿæ˜¯æ¯éš”ä¸€ç§’é’Ÿæ‰“å°ä¸€æ¬¡ã€‚çœ‹ç¬¬äºŒä¸ªåç¨‹ï¼Œå®åœ¨å»¶è¿Ÿä¸¤ç§’ä¸­ä¹‹åï¼Œæ‰è¿›è¡Œæ”¶é›†ï¼Œæˆ‘ä»¬çœ‹åˆ°ç¬¬äºŒä¸ªæ”¶é›†å™¨ï¼Œæ˜¯ä»4å¼€å§‹æ‰“å°çš„ï¼Œä¸”å’Œç¬¬ä¸€ä¸ªåŒæ­¥ã€‚è¯´æ˜ï¼šStateFlowåªä¿ç•™ä¸€ä¸ªå€¼ä¸”æ˜¯æœ€æ–°å€¼ï¼›å¯ä»¥å…è®¸æœ‰å¤šä¸ªè®¢é˜…è€…ï¼Œä¼šå°†æ­¤æ—¶æœ€æ–°çš„å€¼ï¼Œå‘é€ç»™æ­¤æ—¶è®¢é˜…çš„æ‰€æœ‰å­˜æ´»çš„è®¢é˜…è€…ã€‚</span></li></ul><h3><a name="livedataä¸stateflowå·®å¼‚å¯¹æ¯”" class="md-header-anchor"></a><span>LiveDataä¸StateFlowå·®å¼‚å¯¹æ¯”</span></h3><p><span>å¯ä»¥å‘ç°åŸºæœ¬å’ŒLiveDataåŸºæœ¬ä¸€æ ·ğŸ¤¦â€â™€ï¸ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ä¸åŒçš„ï¼Œä¸‹é¢</span><strong><span>æ€»ç»“ä¸€ä¸‹StateFlowå’ŒLiveDataçš„å·®å¼‚æ€§</span></strong><span>ã€‚</span></p><p><strong><span>ç›¸åŒç‚¹</span></strong><span>ï¼šğŸ˜®</span></p><ol start='' ><li><span>æä¾›</span><code>å¯è¯»å¯å†™</code><span>å’Œ</span><code>ä»…å¯è¯»</code><span>ä¸¤ä¸ªç‰ˆæœ¬</span></li><li><span>å€¼æ˜¯å”¯ä¸€çš„</span></li><li><span>å…è®¸è¢«å¤šä¸ªè§‚å¯Ÿè€…è§‚å¯Ÿ</span></li><li><span>æ°¸è¿œä¼šæŠŠæœ€æ–°çš„å€¼ç»™åˆ°è§‚å¯Ÿè€…ï¼Œå³ä½¿æ²¡æœ‰è§‚å¯Ÿè€…ï¼Œä¹Ÿä¼šæ›´æ–°è‡ªå·±çš„å€¼</span></li><li><strong><span>éƒ½ä¼šäº§ç”Ÿç²˜æ€§äº‹ä»¶é—®é¢˜</span></strong></li><li><strong><span>éƒ½å¯èƒ½äº§ç”Ÿä¸¢å¤±å€¼çš„é—®é¢˜</span></strong></li></ol><p><strong><span>ä¸åŒç‚¹</span></strong><span>ï¼šğŸ˜®</span></p><ol start='' ><li><span>StateFlowå¿…é¡»åœ¨æ„å»ºçš„æ—¶å€™ä¼ å…¥åˆå§‹å€¼ï¼ŒLiveDataä¸éœ€è¦</span></li><li><span>StateFlowé»˜è®¤æ˜¯é˜²æŠ–çš„ï¼ŒLiveDataé»˜è®¤ä¸é˜²æŠ–</span></li><li><span>å¯¹äºAndroidæ¥è¯´StateFlowé»˜è®¤æ²¡æœ‰å’Œç”Ÿå‘½å‘¨æœŸç»‘å®šï¼Œç›´æ¥ä½¿ç”¨ä¼šæœ‰é—®é¢˜ï¼Œè¯·ç»§ç»­å‘ä¸‹çœ‹ğŸ™†â€â™€ï¸</span></li></ol><h3><a name="stateflowç‰¹åˆ«è¯´æ˜" class="md-header-anchor"></a><span>StateFlowç‰¹åˆ«è¯´æ˜</span></h3><p><strong><span>ä¸‹é¢å°±ä¸Šæ–¹çš„å‡ ç‚¹ç‰¹åˆ«çš„åšä¸€ä¸‹è¯´æ˜</span></strong><span>ï¼šğŸ˜</span></p><p><strong><span>StateFlowä¼šäº§ç”Ÿç²˜æ€§äº‹ä»¶</span></strong><span>ï¼šè¿™ä¸ªå…¶å®åœ¨ä¸Šé¢çš„ä¾‹å­å°±å¯ä»¥è¯´æ˜äº†ï¼ŒStateFlowæ˜¯å¿…æœ‰å€¼çš„ï¼Œåªè¦æœ‰è®¢é˜…è€…è®¢é˜…ï¼Œè¿™ä¸ªå€¼ç«‹é©¬å°±ä¼šå‘é€è¿‡å»ã€‚å…·ä½“å¯ä»¥ç†è§£ä¸ºï¼Œåœ¨ViewModelä¸­æ”¾äº†ä¸€ä¸ªStateFlowä¹‹ååœ¨Activityä¸­å¯¹å€¼è¿›è¡Œäº†è°ƒç”¨å¼¹å‡ºä¸€ä¸ªSnackBarï¼Œåœ¨å±å¹•æ—‹è½¬ä¹‹åä¼šå†æ¬¡å¼¹å‡ºSnackBarã€‚</span></p><p><strong><span>StateFlowä¸¢å¤±å€¼é—®é¢˜</span></strong><span>ï¼šå½“ä¸Šæ¸¸å‘å°„çš„é€Ÿåº¦ï¼Œå¤§äºè®¢é˜…è€…å¤„ç†çš„é€Ÿåº¦çš„æ—¶å€™ï¼Œä¸­é—´å€¼å°±ä¼šä¸¢å¤±äº†ï¼Œä¸‹é¢å…·ä½“çœ‹ä¸€ä¸ªä¾‹å­ğŸ‘€ï¼š</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">stateFlow</span> <span class="cm-operator">=</span> <span class="cm-variable">MutableStateFlow</span>(<span class="cm-variable">value</span>.<span class="cm-keyword">get</span>())</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">runBlocking</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">stateFlow</span>.<span class="cm-variable">onEach</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//æ¨¡æ‹Ÿå¤„ç†è€—æ—¶</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">3000</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"receiver:$it"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }.<span class="cm-variable">launchIn</span>(<span class="cm-keyword">this</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-atom">true</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">1000</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">v</span> <span class="cm-operator">=</span> <span class="cm-variable">value</span>.<span class="cm-variable">incrementAndGet</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"send:$v"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">stateFlow</span>.<span class="cm-variable">emit</span>(<span class="cm-variable">v</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//ç»“æœ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">10</span>:<span class="cm-number">58</span>:<span class="cm-number">26</span>:<span class="cm-number">004</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send</span>:<span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">10</span>:<span class="cm-number">58</span>:<span class="cm-number">27</span>:<span class="cm-number">031</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send</span>:<span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">10</span>:<span class="cm-number">58</span>:<span class="cm-number">27</span>:<span class="cm-number">990</span> [<span class="cm-variable">main</span>] <span class="cm-keyword">receiver</span>:<span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">10</span>:<span class="cm-number">58</span>:<span class="cm-number">28</span>:<span class="cm-number">038</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send</span>:<span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">10</span>:<span class="cm-number">58</span>:<span class="cm-number">29</span>:<span class="cm-number">054</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send</span>:<span class="cm-number">4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">10</span>:<span class="cm-number">58</span>:<span class="cm-number">30</span>:<span class="cm-number">057</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send</span>:<span class="cm-number">5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">10</span>:<span class="cm-number">58</span>:<span class="cm-number">30</span>:<span class="cm-number">996</span> [<span class="cm-variable">main</span>] <span class="cm-keyword">receiver</span>:<span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">10</span>:<span class="cm-number">58</span>:<span class="cm-number">31</span>:<span class="cm-number">070</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send</span>:<span class="cm-number">6</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">10</span>:<span class="cm-number">58</span>:<span class="cm-number">32</span>:<span class="cm-number">073</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send</span>:<span class="cm-number">7</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">10</span>:<span class="cm-number">58</span>:<span class="cm-number">33</span>:<span class="cm-number">076</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send</span>:<span class="cm-number">8</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">10</span>:<span class="cm-number">58</span>:<span class="cm-number">34</span>:<span class="cm-number">004</span> [<span class="cm-variable">main</span>] <span class="cm-keyword">receiver</span>:<span class="cm-number">5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 594px;"></div><div class="CodeMirror-gutters" style="display: none; height: 594px;"></div></div></div></pre><p><span>ä¸Šæ–¹æ¨¡æ‹Ÿå¤„ç†è€—æ—¶æ˜¯3ç§’ï¼Œå‘é€åˆ™æ˜¯æ¯éš”ä¸€ç§’é’Ÿå‘ä¸€æ¬¡ã€‚å¤„ç†è€—æ—¶æ˜¯å‘é€çš„ä¸‰å€ï¼Œé‚£ä¹ˆä¸­é—´çš„å€¼å°±ä¸¢å¤±äº†ã€‚</span></p><p><span>è‡³äºä¹‹å‰è®²Flowæ—¶è¯´åˆ°çš„ä¸‰ç§èƒŒå‹å¤„ç†ç­–ç•¥ï¼Œè¿™é‡Œåªèƒ½ä½¿ç”¨collectLatestï¼Œå‘é€æ–°å€¼æ—¶å–æ¶ˆä¹‹å‰çš„æ“ä½œï¼Œå¯ä»¥å‚è€ƒä¹‹å‰Flowé‡Œé¢çš„è¯¦ç»†ä»‹ç»ã€‚</span></p><p><strong><span>StateFlowé»˜è®¤æ˜¯é˜²æŠ–çš„</span></strong></p><p><span>è¿™ä¸€ç‚¹å¯ä»¥çœ‹ä¸€ä¸‹æºç ï¼šğŸ™†â€â™€ï¸</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">emit</span>()<span class="cm-variable">è°ƒç”¨äº†setValue</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">setValue</span> <span class="cm-variable">è°ƒç”¨äº†</span> <span class="cm-variable">updateState</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">çœ‹ä¸€ä¸‹</span> <span class="cm-variable">updateState</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">fun</span> <span class="cm-def">updateState</span>(<span class="cm-variable">expectedState</span>: <span class="cm-variable">Any</span><span class="cm-operator">?</span>, <span class="cm-variable">newState</span>: <span class="cm-variable">Any</span>): <span class="cm-variable-3">Boolean</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">curSequence</span> <span class="cm-operator">=</span> <span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">curSlots</span>: <span class="cm-variable">Array</span><span class="cm-operator">&lt;</span><span class="cm-variable">StateFlowSlot</span><span class="cm-operator">?&gt;?</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">slots</span> <span class="cm-comment">// benign race, we will not use it</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">synchronized</span>(<span class="cm-keyword">this</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">oldState</span> <span class="cm-operator">=</span> <span class="cm-variable">_state</span>.<span class="cm-variable">value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">expectedState</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">oldState</span> <span class="cm-operator">!=</span> <span class="cm-variable">expectedState</span>) <span class="cm-keyword">return</span> <span class="cm-atom">false</span> <span class="cm-comment">// CAS support</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">oldState</span> <span class="cm-operator">==</span> <span class="cm-variable">newState</span>) <span class="cm-keyword">return</span> <span class="cm-atom">true</span> <span class="cm-comment">// Don't do anything if value is not changing, but CAS -&gt; true</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">_state</span>.<span class="cm-variable">value</span> <span class="cm-operator">=</span> <span class="cm-variable">newState</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">curSequence</span> <span class="cm-operator">=</span> <span class="cm-variable">sequence</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">curSequence</span> <span class="cm-variable">and</span> <span class="cm-number">1</span> <span class="cm-operator">==</span> <span class="cm-number">0</span>) { <span class="cm-comment">// even sequence means quiescent state flow (no ongoing update)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">curSequence</span><span class="cm-operator">++</span> <span class="cm-comment">// make it odd</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sequence</span> <span class="cm-operator">=</span> <span class="cm-variable">curSequence</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// update is already in process, notify it, and return</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sequence</span> <span class="cm-operator">=</span> <span class="cm-variable">curSequence</span> <span class="cm-operator">+</span> <span class="cm-number">2</span> <span class="cm-comment">// change sequence to notify, keep it odd</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-atom">true</span> <span class="cm-comment">// updated</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">curSlots</span> <span class="cm-operator">=</span> <span class="cm-variable">slots</span> <span class="cm-comment">// read current reference to collectors under lock</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 484px;"></div><div class="CodeMirror-gutters" style="display: none; height: 484px;"></div></div></div></pre><p><span>å…³æ³¨ä¸€ä¸‹è¿™ä¸€è¡Œä»£ç </span><code>if (oldState == newState) return true</code><span>ï¼Œæ›´æ–°æ•°æ®æ—¶ï¼Œä¼šåˆ¤æ–­å½“å‰å€¼ä¸æ–°å€¼æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒåˆ™ä¸æ›´æ–°æ•°æ®ã€‚</span></p><p><strong><span>å…³äº</span><code>å¯è¯»å¯å†™</code><span>å’Œ</span><code>ä»…å¯è¯»</code><span>çš„ä½¿ç”¨å®˜æ–¹ç»™å‡ºä¸€ä¸‹çš„ä¾‹å­ï¼Œå¯ä»¥å‚è€ƒ</span></strong><span>ï¼šğŸ™†â€â™€ï¸</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">CounterModel</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">val</span> <span class="cm-def">_counter</span> <span class="cm-operator">=</span> <span class="cm-variable">MutableStateFlow</span>(<span class="cm-number">0</span>) <span class="cm-comment">// private mutable state flow</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">counter</span> <span class="cm-operator">=</span> <span class="cm-variable">_counter</span>.<span class="cm-variable">asStateFlow</span>() <span class="cm-comment">// publicly exposed as read-only state flow</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">fun</span> <span class="cm-def">inc</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">_counter</span>.<span class="cm-variable">value</span><span class="cm-operator">++</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><p><strong><span>å¦å¤–æ³¨æ„ä¸€ç‚¹</span></strong><span>ï¼šStateFlow æ˜¯ä¸€ä¸ªçƒ­æµã€‚æ‰€ä»¥åªè¦æµè¢«æ”¶é›†æˆ–ä»åƒåœ¾æ”¶é›†æ ¹å­˜åœ¨å¯¹å®ƒçš„ä»»ä½•å…¶ä»–å¼•ç”¨ï¼Œå®ƒå°±ä¼šä¿ç•™åœ¨å†…å­˜ä¸­ã€‚</span></p><h3><a name="androidä¸­ä½¿ç”¨stateflowå®è·µ" class="md-header-anchor"></a><span>Androidä¸­ä½¿ç”¨StateFlowå®è·µ</span></h3><p><span>æˆ‘ä»¬çŸ¥é“ç›´æ¥åœ¨UIä¸­å¯¹æ”¶é›†æµæ—¶ä¸å®‰å…¨çš„ï¼Œæ‰€ä»¥éœ€è¦åˆ¤æ–­åˆ¤æ–­UIçš„ç”Ÿå‘½å‘¨æœŸï¼Œæ¥å†³å®šæ˜¯å¦å¼€å¯æˆ–è€…å–æ¶ˆæµçš„æ”¶é›†ï¼Œå¯¹åº”äºFlowå°±æ˜¯æ˜¯å¦å¯åŠ¨æˆ–è€…å–æ¶ˆæ”¶é›†çš„åç¨‹ã€‚æˆ‘ä»¬çŸ¥é“LiveDataè‡ªèº«æœ‰ä¸€ä¸ª</span><code>LifecycleBoundObserver</code><span>éœ€è¦ä¼ å…¥å½“å‰çš„LifecycleOwnerç”¨äºç»‘å®šå£°æ˜å‘¨æœŸï¼Œåœ¨onStopä¹‹åå°±ä¼šåœæ­¢æ”¶é›†ï¼Œé‚£ä¹ˆStateFlowæœ‰æ²¡æœ‰å‘¢ï¼Ÿæ²¡æœ‰ï¼ğŸ˜‚</span></p><p><span>ä½†æ˜¯Googleå®˜æ–¹åœ¨æœ‰ä¸€ä¸ªæ‰©å±•å‡½æ•°ï¼Œå¯¹ç”Ÿå‘½å‘¨æœŸè¿›è¡Œäº†ç®¡ç†ï¼Œæ–¹ä¾¿ä½¿ç”¨ã€‚å°±æ˜¯</span><code>repeatOnLifecycle</code><span>ï¼Œå®ƒä¼šåœ¨ä¼ å…¥çš„ç”Ÿå‘½å‘¨æœŸå¼€å§‹å¯åŠ¨ä¸€ä¸ªåç¨‹ï¼Œç„¶ååœ¨ä¸ä¹‹å¯¹åº”çš„å¦ä¸€ä¸ªçŠ¶æ€å–æ¶ˆæºç¨‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŒ‚èµ·å‡½æ•°ï¼Œåœ¨onDestroyä¹‹åæ‰ä¼šæ¢å¤ä¸‹æ–¹çš„æ‰§è¡Œï¼Œä¸¾ä¸ªä¾‹å­å¦‚ä¸‹æ‰€ç¤ºğŸ‘€</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-keyword">override</span> <span class="cm-keyword">fun</span> <span class="cm-def">onCreate</span>(<span class="cm-variable">savedInstanceState</span>: <span class="cm-variable">Bundle</span><span class="cm-operator">?</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// ä½¿ç”¨lifecycleScopeå¯åŠ¨åç¨‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">lifecycleScope</span>.<span class="cm-variable">launch</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// æ¯æ¬¡ç”Ÿå‘½å‘¨æœŸå¤„äº STARTED çŠ¶æ€ï¼ˆæˆ–æ›´é«˜çŠ¶æ€ï¼‰æ—¶ï¼ŒrepeatOnLifecycle åœ¨æ–°çš„åç¨‹ä¸­å¯åŠ¨å—ï¼Œå¹¶åœ¨å®ƒåœæ­¢æ—¶å–æ¶ˆå®ƒã€‚</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">lifecycle</span>.<span class="cm-variable">repeatOnLifecycle</span>(<span class="cm-variable">Lifecycle</span>.<span class="cm-variable">State</span>.<span class="cm-variable">STARTED</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ViewModel</span>.<span class="cm-variable">uiState</span>.<span class="cm-variable">collect</span> { <span class="cm-variable">uiState</span> <span class="cm-operator">-&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// todo</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//å¦‚æœè¿™é‡Œè¢«æ‰§è¡Œï¼Œåˆ™ä»£è¡¨ç”Ÿå‘½å‘¨æœŸå·²ç»èµ°åˆ°äº†onDestroyï¼Œå› ä¸ºrepeatOnLifecycleæ˜¯æŒ‚èµ·å‡½æ•°ï¼Œåœ¨ç”Ÿå‘½å‘¨æœŸä¸ºonDestroyçš„æ—¶å€™è¿›è¡Œäº†æ¢å¤ã€‚</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 330px;"></div><div class="CodeMirror-gutters" style="display: none; height: 330px;"></div></div></div></pre><p><strong><span>æ³¨æ„</span></strong><span>ï¼šrepeatOnLifecycle API ä»…åœ¨ androidx.lifecycle:lifecycle-runtime-ktx:2.4.0-alpha01 åº“åŠæ›´é«˜ç‰ˆæœ¬ä¸­å¯ç”¨ã€‚ä¸‹ä¸€ç¯‡æ–‡ç« ä¼šå¯¹</span><code>repeatOnLifecycle</code><span>åšæºç åˆ†æï¼Œæ•¬è¯·æœŸå¾…ï¼</span></p><p>&nbsp;</p><h2><a name="sharedflowä½¿ç”¨" class="md-header-anchor"></a><span>SharedFlowä½¿ç”¨</span></h2><h3><a name="sharedflowç®€ä»‹" class="md-header-anchor"></a><span>SharedFlowç®€ä»‹</span></h3><p><span>SharedFlowä¹Ÿæ˜¯ä¸€ä¸ªçƒ­æµã€‚å®ƒæ˜¯StateFlow çš„é«˜åº¦å¯é…ç½®çš„æ³›åŒ–ï¼Œæä¾›äº†æ›´å¤šçš„èƒ½åŠ›ã€‚æ¢å¥è¯è¯´ï¼ŒStateFlowæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„SharedFlowã€‚</span></p><p><span>SharedFlowåŒæ ·æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œ</span><code>SharedFlow</code><span>å’Œ</span><code>MutableSharedFlow</code><span>ã€‚</span></p><p><span>é‚£ä¸ºä»€ä¹ˆè¯´StateFlowæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„SharedFlowå‘¢ğŸ˜®ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç»§æ‰¿å…³ç³»å°±çŸ¥é“äº†</span></p><p><code>StateFlow ç»§æ‰¿è‡ª SharedFlow   MutableStateFlow ç»§æ‰¿è‡ª  MutableSharedFlow</code></p><h3><a name="sharedflowçš„ä½¿ç”¨" class="md-header-anchor"></a><span>SharedFlowçš„ä½¿ç”¨</span></h3><p><span>åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹StateFlowä¸SharedFlowæœ‰ä»€ä¹ˆä¸åŒ</span></p><ul><li><span>SharedFlowæ²¡æœ‰é»˜è®¤å€¼</span></li><li><span>SharedFlowå¯ä»¥ä¿å­˜æ—§çš„æ•°æ®ï¼Œæ ¹æ®é…ç½®å¯ä»¥å°†æ—§çš„æ•°æ®å›æ’­ç»™æ–°çš„è®¢é˜…è€…</span></li><li><span>SharedFlowä½¿ç”¨</span><code>emit/tryEmit</code><span>å‘å°„æ•°æ®ï¼ŒStateFlowå†…éƒ¨å…¶å®éƒ½æ˜¯è°ƒç”¨çš„</span><code>setValue</code><span>ã€‚</span></li><li><span>SharedFlowä¼šæŒ‚èµ·ç›´åˆ°æ‰€æœ‰çš„è®¢é˜…è€…å¤„ç†å®Œæˆã€‚</span></li></ul><p><span>çœ‹ä¸€ä¸‹MutableSharedFlowçš„æ„å»ºå‡½æ•°</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">fun</span> <span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> <span class="cm-variable">MutableSharedFlow</span>(</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">replay</span>: <span class="cm-variable">Int</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">extraBufferCapacity</span>: <span class="cm-variable">Int</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">onBufferOverflow</span>: <span class="cm-variable">BufferOverflow</span> <span class="cm-operator">=</span> <span class="cm-variable">BufferOverflow</span>.<span class="cm-variable">SUSPEND</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><span>å¯ä»¥çœ‹å¾—å‡ºï¼ŒMutableSharedFlowä¸éœ€è¦ä¼ å…¥é»˜è®¤å€¼ã€‚</span></p><p><span>è§£æä¸€ä¸‹æ„å»ºMutableSharedFlowçš„ä¸‰ä¸ªå‚æ•°çš„å«ä¹‰</span></p><ul><li><span>replayï¼šé‡æ’­ç»™æ–°è®¢é˜…è€…çš„å€¼çš„æ•°é‡ï¼ˆä¸èƒ½ä¸ºè´Ÿï¼Œé»˜è®¤ä¸ºé›¶ï¼‰</span></li><li><span>extraBufferCapacityï¼šé™¤é‡æ’­å¤–ç¼“å†²çš„å€¼çš„æ•°é‡ã€‚ å½“æœ‰å‰©ä½™ç¼“å†²åŒºç©ºé—´æ—¶ï¼Œemit ä¸ä¼šæŒ‚èµ·ï¼ˆå¯é€‰ï¼Œä¸èƒ½ä¸ºè´Ÿï¼Œé»˜è®¤ä¸ºé›¶ï¼‰ã€‚</span></li><li><span>onBufferOverflowï¼šé…ç½®ç¼“å†²åŒºæº¢å‡ºçš„æ“ä½œï¼ˆå¯é€‰ï¼Œé»˜è®¤BufferOverflow.SUSPENDï¼Œç¼“å­˜æº¢å‡ºæ—¶æŒ‚èµ·ï¼›å¦å¤–è¿˜æœ‰DROP_OLDESTä¸DROP_LATESTï¼Œåˆ†åˆ«æ˜¯æº¢å‡ºæ—¶åˆ é™¤ç¼“å†²åŒºä¸­æœ€æ—§çš„å€¼ï¼Œå°†æ–°å€¼æ·»åŠ åˆ°ç¼“å†²åŒºï¼Œä¸è¦æŒ‚èµ·ã€‚ä¸åœ¨ç¼“å†²åŒºæº¢å‡ºæ—¶åˆ é™¤å½“å‰æ·»åŠ åˆ°ç¼“å†²åŒºçš„æœ€æ–°å€¼ï¼ˆä»¥ä¾¿ç¼“å†²åŒºå†…å®¹ä¿æŒä¸å˜ï¼‰ï¼Œä¸è¦æŒ‚èµ·ã€‚ï¼‰</span></li></ul><p><span>ä¸‹é¢çœ‹å‡ ä¸ªä½¿ç”¨çš„ä¾‹å­ğŸ™†â€â™€ï¸</span></p><ul><li><p><strong><span>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSharedFlowæ²¡æœ‰ç²˜æ€§äº‹ä»¶</span></strong><span>ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼šğŸ™†â€â™€ï¸</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  var v = 0</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  val sharedFlow = MutableSharedFlow&lt;Int&gt;()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  runBlocking {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  sharedFlow.emit(++v)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  val job = sharedFlow.onEach {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  log("receiver$it")</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }.launchIn(this)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  delay(5000)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  job.cancel()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  log("end")</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  //è¾“å‡º</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  20:38:19:818 [main] end</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre><p><span>å› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼Œreplayçš„å€¼ä¸º0ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è®¢é˜…çš„æ—¶å€™ï¼Œå°†ä¼šæœ‰0ä¸ªå€¼å›æ’­ç»™è®¢é˜…è€…ï¼Œæ‰€ä»¥å°±æ²¡æœ‰ç²˜æ€§äº‹ä»¶äº†ï¼</span></p></li><li><p><strong><span>å†çœ‹ä¸€ä¸‹æ­£å¸¸ä½¿ç”¨çš„æƒ…å†µ</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">sharedFlow</span> <span class="cm-operator">=</span> <span class="cm-variable">MutableSharedFlow</span><span class="cm-operator">&lt;</span><span class="cm-variable">Int</span><span class="cm-operator">&gt;</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">value</span> <span class="cm-operator">=</span> <span class="cm-variable">AtomicInteger</span>(<span class="cm-number">0</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">runBlocking</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">GlobalScope</span>.<span class="cm-variable">launch</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sharedFlow</span>.<span class="cm-variable">collect</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"receiver value $it"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">GlobalScope</span>.<span class="cm-variable">launch</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">3000</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sharedFlow</span>.<span class="cm-variable">collect</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"receiver2 value $it"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-atom">true</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">1000</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sharedFlow</span>.<span class="cm-variable">emit</span>(<span class="cm-variable">value</span>.<span class="cm-variable">incrementAndGet</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//ç»“æœ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">20</span>:<span class="cm-number">55</span>:<span class="cm-number">34</span>:<span class="cm-number">565</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">2</span>] <span class="cm-keyword">receiver</span> <span class="cm-variable">value</span> <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">20</span>:<span class="cm-number">55</span>:<span class="cm-number">35</span>:<span class="cm-number">552</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">2</span>] <span class="cm-keyword">receiver</span> <span class="cm-variable">value</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">20</span>:<span class="cm-number">55</span>:<span class="cm-number">36</span>:<span class="cm-number">560</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">2</span>] <span class="cm-keyword">receiver</span> <span class="cm-variable">value</span> <span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">20</span>:<span class="cm-number">55</span>:<span class="cm-number">36</span>:<span class="cm-number">560</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-variable">receiver2</span> <span class="cm-variable">value</span> <span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">20</span>:<span class="cm-number">55</span>:<span class="cm-number">37</span>:<span class="cm-number">570</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-keyword">receiver</span> <span class="cm-variable">value</span> <span class="cm-number">4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">20</span>:<span class="cm-number">55</span>:<span class="cm-number">37</span>:<span class="cm-number">570</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">2</span>] <span class="cm-variable">receiver2</span> <span class="cm-variable">value</span> <span class="cm-number">4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 594px;"></div><div class="CodeMirror-gutters" style="display: none; height: 594px;"></div></div></div></pre><p><span>é»˜è®¤çš„ä½¿ç”¨é™¤äº†ç²˜æ€§äº‹ä»¶ä¹‹å¤–ï¼Œå…¶ä»–çš„å’ŒStateFlowå°±æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«äº†ã€‚æ‰€ä»¥å¦‚æœä¸ºäº†è§£å†³ç²˜æ€§äº‹ä»¶çš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨SharedFlowã€‚ä½†æ˜¯æ³¨æ„ä¸€ç‚¹ï¼š</span><strong><span>SharedFlowæ˜¯ä¸é˜²æŠ–çš„</span></strong><span>ã€‚</span></p></li><li><p><strong><span>SharedFlowé»˜è®¤æ˜¯è¦ç­‰åˆ°è®¢é˜…è€…å…¨éƒ¨æ¥æ”¶åˆ°å¹¶ä¸”å¤„ç†å®Œæˆä¹‹åï¼Œæ‰ä¼šè¿›è¡Œä¸‹ä¸€æ¬¡å‘é€ï¼Œå¦åˆ™å°±æ˜¯æŒ‚èµ·</span></strong><span>ã€‚</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">value</span> <span class="cm-operator">=</span> <span class="cm-number">0</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">sharedFlow</span> <span class="cm-operator">=</span> <span class="cm-variable">MutableSharedFlow</span><span class="cm-operator">&lt;</span><span class="cm-variable">Int</span><span class="cm-operator">&gt;</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">runBlocking</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sharedFlow</span>.<span class="cm-variable">onEach</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">3000</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"receiver1:$it"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }.<span class="cm-variable">launchIn</span>(<span class="cm-variable">GlobalScope</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sharedFlow</span>.<span class="cm-variable">onEach</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">1000</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"receiver2:$it"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }.<span class="cm-variable">launchIn</span>(<span class="cm-variable">GlobalScope</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-atom">true</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">v</span> <span class="cm-operator">=</span> <span class="cm-operator">++</span><span class="cm-variable">value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"send:$v"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sharedFlow</span>.<span class="cm-variable">emit</span>(<span class="cm-variable">v</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">1000</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//è¾“å‡º</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">22</span>:<span class="cm-number">35</span>:<span class="cm-number">45</span>:<span class="cm-number">787</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send</span>:<span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">22</span>:<span class="cm-number">35</span>:<span class="cm-number">46</span>:<span class="cm-number">822</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send</span>:<span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">22</span>:<span class="cm-number">35</span>:<span class="cm-number">46</span>:<span class="cm-number">822</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">2</span>] <span class="cm-variable">receiver2</span>:<span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">22</span>:<span class="cm-number">35</span>:<span class="cm-number">47</span>:<span class="cm-number">833</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">2</span>] <span class="cm-variable">receiver2</span>:<span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">22</span>:<span class="cm-number">35</span>:<span class="cm-number">48</span>:<span class="cm-number">823</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">2</span>] <span class="cm-variable">receiver1</span>:<span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">22</span>:<span class="cm-number">35</span>:<span class="cm-number">49</span>:<span class="cm-number">829</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send</span>:<span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">22</span>:<span class="cm-number">35</span>:<span class="cm-number">50</span>:<span class="cm-number">834</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">2</span>] <span class="cm-variable">receiver2</span>:<span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">22</span>:<span class="cm-number">35</span>:<span class="cm-number">51</span>:<span class="cm-number">825</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">2</span>] <span class="cm-variable">receiver1</span>:<span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">22</span>:<span class="cm-number">35</span>:<span class="cm-number">52</span>:<span class="cm-number">837</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send</span>:<span class="cm-number">4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">22</span>:<span class="cm-number">35</span>:<span class="cm-number">53</span>:<span class="cm-number">843</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">2</span>] <span class="cm-variable">receiver2</span>:<span class="cm-number">4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">22</span>:<span class="cm-number">35</span>:<span class="cm-number">54</span>:<span class="cm-number">832</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">2</span>] <span class="cm-variable">receiver1</span>:<span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">22</span>:<span class="cm-number">35</span>:<span class="cm-number">55</span>:<span class="cm-number">838</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send</span>:<span class="cm-number">5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 704px;"></div><div class="CodeMirror-gutters" style="display: none; height: 704px;"></div></div></div></pre><p><span>å¯ä»¥çœ‹å¾—å‡ºï¼Œæˆ‘ä»¬ä»…ä»…è®¾ç½®sendçš„å»¶è¿Ÿä¸º1ç§’é’Ÿï¼Œä½†æ˜¯å› ä¸ºç¬¬äºŒä¸ªè®¢é˜…è€…æ¨¡æ‹Ÿå¤„ç†æ—¶é—´ä¸º3ç§’é’Ÿï¼Œæ‰€ä»¥emitä¼šç­‰æœ€åä¸€ä¸ªå¤„ç†å®Œæˆæ‰ä¼šè¿›è¡Œä¸‹ä¸€æ¬¡çš„å‘å°„ï¼Œå¯ä»¥çœ‹åˆ°ä»</span><code>sendï¼š2</code><span>ä»¥åï¼Œæ¯æ¬¡å‘å°„éƒ½é—´éš”ä¸‰ç§’é’Ÿäº†ï¼Œä¿è¯æ‰€æœ‰çš„è®¢é˜…è€…å…¨éƒ¨æ¥æ”¶åˆ°æ•°æ®ã€‚</span><strong><span>å¦‚æœæ˜¯StateFlowçš„è¯ï¼Œæ˜¯ä¸ç®¡è®¢é˜…è€…æ˜¯å¦å¤„ç†å®Œæˆçš„ï¼Œä¾æ—§ä¼šä¿æŒå€¼çš„æ›¿æ¢</span></strong><span>ã€‚</span></p></li><li><p><strong><span>å…¶ä¸­ä¸€ä¸ªè®¢é˜…è€…å‡ºç°å¼‚å¸¸æ€ä¹ˆåŠå‘¢</span></strong><span>ï¼Ÿ</span></p><p><span>è¿™ä¸ªå°±ä¸æ”¾ä»£ç äº†ï¼Œå¼‚å¸¸çš„ä¼ æ’­æœºåˆ¶å’Œåç¨‹çš„å¼‚å¸¸ä¼ æ’­æœºåˆ¶è¿˜æ˜¯ä¸€æ ·çš„ã€‚å¦‚æœè®¢é˜…è€…å’Œå‘é€çš„åœ¨åŒä¸€ä¸ªä½œç”¨åŸŸåˆ™å¼‚å¸¸ä¼ æ’­æœºåˆ¶åŒåç¨‹ä½œç”¨åŸŸã€‚å¦‚æœå’Œå‘é€è€…åˆ†åˆ«åœ¨ä¸åŒçš„ä½œç”¨åŸŸåˆ™è®¢é˜…è€…å‡ºç°å¼‚å¸¸ï¼Œå½±å“ä¸åˆ°åˆ«çš„è®¢é˜…è€…å’Œå‘é€çš„åç¨‹ã€‚</span></p></li><li><p><strong><span>SharedFlowåŒä¸€ä¸ªä½œç”¨åŸŸä¸‹ä¸¢å¤±å€¼çš„é—®é¢˜ï¼Œå’Œå¯åŠ¨åç¨‹æœ‰å…³</span></strong><span>ï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°å€¼ä¸¢å¤±çš„æƒ…å†µï¼Œ</span><strong><span>ä¸‹ä¸€ç¯‡ä¼šè¯¦ç»†åˆ†æåç¨‹çš„æ¢å¤ä¸æŒ‚èµ·å®ç°åŸç†ï¼Œä¼šè®²åˆ°å…·ä½“çš„åŸå› ï¼Œå¯ä»¥å…³æ³¨åšä¸»</span></strong><span>ã€‚</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">value</span> <span class="cm-operator">=</span> <span class="cm-number">0</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">sharedFlow</span> <span class="cm-operator">=</span> <span class="cm-variable">MutableSharedFlow</span><span class="cm-operator">&lt;</span><span class="cm-variable">Int</span><span class="cm-operator">&gt;</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">runBlocking</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sharedFlow</span>.<span class="cm-variable">onEach</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"receiver1:$it"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }.<span class="cm-variable">launchIn</span>(<span class="cm-keyword">this</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-atom">true</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">v</span> <span class="cm-operator">=</span> <span class="cm-operator">++</span><span class="cm-variable">value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"send:$v"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sharedFlow</span>.<span class="cm-variable">emit</span>(<span class="cm-variable">v</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">1000</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//ç»“æœ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">09</span>:<span class="cm-number">27</span>:<span class="cm-number">08</span>:<span class="cm-number">434</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send</span>:<span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">09</span>:<span class="cm-number">27</span>:<span class="cm-number">09</span>:<span class="cm-number">471</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send</span>:<span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">09</span>:<span class="cm-number">27</span>:<span class="cm-number">09</span>:<span class="cm-number">471</span> [<span class="cm-variable">main</span>] <span class="cm-variable">receiver1</span>:<span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">09</span>:<span class="cm-number">27</span>:<span class="cm-number">10</span>:<span class="cm-number">477</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send</span>:<span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">09</span>:<span class="cm-number">27</span>:<span class="cm-number">10</span>:<span class="cm-number">477</span> [<span class="cm-variable">main</span>] <span class="cm-variable">receiver1</span>:<span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">09</span>:<span class="cm-number">27</span>:<span class="cm-number">11</span>:<span class="cm-number">493</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send</span>:<span class="cm-number">4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">09</span>:<span class="cm-number">27</span>:<span class="cm-number">11</span>:<span class="cm-number">493</span> [<span class="cm-variable">main</span>] <span class="cm-variable">receiver1</span>:<span class="cm-number">4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 484px;"></div><div class="CodeMirror-gutters" style="display: none; height: 484px;"></div></div></div></pre><p><span>æ˜¾è€Œæ˜“è§ï¼Œç¬¬ä¸€ä¸ªå€¼æ²¡æœ‰è¢«æ¥å—åˆ°ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘æŸ¥çœ‹äº†ä¸€ä¸‹æºç ï¼ŒæŒ‰ç…§é¡ºåºæ‰§è¡Œä¸‹æ¥çš„è¯ï¼Œ</span><strong><span>åœ¨ç›¸åŒçš„ä½œç”¨åŸŸä¸‹å¯åŠ¨åç¨‹ï¼Œå¦‚æœä¸‹é¢ä¸æŒ‚èµ·çš„è¯ï¼Œä¸Šé¢çš„åç¨‹æ˜¯ä¸ä¼šå¯åŠ¨çš„</span></strong><span>ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªå€¼å°±æ²¡æœ‰è¢«å‘é€äº†ï¼ˆ</span><strong><span>SharedFlowåœ¨æ— è®¢é˜…è€…çš„æ—¶å€™ä¼šä¸¢å¤±å€¼</span></strong><span>ï¼‰ï¼›å¦‚æœlaunchInçš„ä½œç”¨åŸŸä¸æ˜¯å½“å‰çš„ä½œç”¨åŸŸçš„è¯ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å•ç‹¬è®¾ç½®ä¸€ä¸ªGlobalScopeçš„è¯ï¼Œæ­¤æ—¶å°±æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œæ‰€ä»¥ä¸Šé¢çš„æƒ…å†µéœ€è¦æ³¨æ„ä¸‹ä¸€ä¸‹ã€‚</span></p></li><li><p><strong><span>å¦‚æœéœ€è¦å›æ’­å°±å€¼ç»™æ–°çš„è®¢é˜…è€…ï¼Œå¯ä»¥è®¾ç½®replay</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">value</span> <span class="cm-operator">=</span> <span class="cm-number">0</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">sharedFlow</span> <span class="cm-operator">=</span> <span class="cm-variable">MutableSharedFlow</span><span class="cm-operator">&lt;</span><span class="cm-variable">Int</span><span class="cm-operator">&gt;</span>(<span class="cm-variable">replay</span> <span class="cm-operator">=</span> <span class="cm-number">4</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">runBlocking</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">launch</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sharedFlow</span>.<span class="cm-variable">collect</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"receiver1:$it"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">launch</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">2000</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sharedFlow</span>.<span class="cm-variable">collect</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"receiver2:$it"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">launch</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">4000</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sharedFlow</span>.<span class="cm-variable">collect</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"receiver3:$it"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-atom">true</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">v</span> <span class="cm-operator">=</span> <span class="cm-operator">++</span><span class="cm-variable">value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"send:$v"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sharedFlow</span>.<span class="cm-variable">emit</span>(<span class="cm-variable">v</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">1000</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//ç»“æœ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">11</span>:<span class="cm-number">17</span>:<span class="cm-number">13</span>:<span class="cm-number">977</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send</span>:<span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">11</span>:<span class="cm-number">17</span>:<span class="cm-number">14</span>:<span class="cm-number">002</span> [<span class="cm-variable">main</span>] <span class="cm-variable">receiver1</span>:<span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">11</span>:<span class="cm-number">17</span>:<span class="cm-number">15</span>:<span class="cm-number">009</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send</span>:<span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">11</span>:<span class="cm-number">17</span>:<span class="cm-number">15</span>:<span class="cm-number">009</span> [<span class="cm-variable">main</span>] <span class="cm-variable">receiver1</span>:<span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">11</span>:<span class="cm-number">17</span>:<span class="cm-number">16</span>:<span class="cm-number">019</span> [<span class="cm-variable">main</span>] <span class="cm-variable">receiver2</span>:<span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">11</span>:<span class="cm-number">17</span>:<span class="cm-number">16</span>:<span class="cm-number">019</span> [<span class="cm-variable">main</span>] <span class="cm-variable">receiver2</span>:<span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">11</span>:<span class="cm-number">17</span>:<span class="cm-number">16</span>:<span class="cm-number">019</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send</span>:<span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">11</span>:<span class="cm-number">17</span>:<span class="cm-number">16</span>:<span class="cm-number">019</span> [<span class="cm-variable">main</span>] <span class="cm-variable">receiver1</span>:<span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">11</span>:<span class="cm-number">17</span>:<span class="cm-number">16</span>:<span class="cm-number">019</span> [<span class="cm-variable">main</span>] <span class="cm-variable">receiver2</span>:<span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">11</span>:<span class="cm-number">17</span>:<span class="cm-number">17</span>:<span class="cm-number">024</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send</span>:<span class="cm-number">4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">11</span>:<span class="cm-number">17</span>:<span class="cm-number">17</span>:<span class="cm-number">024</span> [<span class="cm-variable">main</span>] <span class="cm-variable">receiver1</span>:<span class="cm-number">4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">11</span>:<span class="cm-number">17</span>:<span class="cm-number">17</span>:<span class="cm-number">024</span> [<span class="cm-variable">main</span>] <span class="cm-variable">receiver2</span>:<span class="cm-number">4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">11</span>:<span class="cm-number">17</span>:<span class="cm-number">18</span>:<span class="cm-number">017</span> [<span class="cm-variable">main</span>] <span class="cm-variable">receiver3</span>:<span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">11</span>:<span class="cm-number">17</span>:<span class="cm-number">18</span>:<span class="cm-number">017</span> [<span class="cm-variable">main</span>] <span class="cm-variable">receiver3</span>:<span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">11</span>:<span class="cm-number">17</span>:<span class="cm-number">18</span>:<span class="cm-number">017</span> [<span class="cm-variable">main</span>] <span class="cm-variable">receiver3</span>:<span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">11</span>:<span class="cm-number">17</span>:<span class="cm-number">18</span>:<span class="cm-number">017</span> [<span class="cm-variable">main</span>] <span class="cm-variable">receiver3</span>:<span class="cm-number">4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">11</span>:<span class="cm-number">17</span>:<span class="cm-number">18</span>:<span class="cm-number">033</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send</span>:<span class="cm-number">5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1012px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1012px;"></div></div></div></pre><p><span>çœ‹å¾—å‡ºï¼Œè®¾ç½®replayä¹‹åï¼Œå¦‚æœå½“å‰å‘å°„ç¼“å­˜çš„å€¼ä¸å¤Ÿçš„è¯ï¼Œä¼šå°†å½“å‰å·²å‘å°„çš„å€¼å…¨éƒ¨å›æ’­ç»™æ–°çš„è®¢é˜…è€…ã€‚å¦åˆ™ï¼Œå°±å›æ’­replayæ•°é‡çš„å€¼ã€‚</span></p></li><li><p><strong><span>extraBufferCapacity å¯ä»¥åœ¨å»é™¤é‡æ’­çš„æ•°é‡ä¹‹å¤–è¿›è¡Œé¢å¤–çš„ç¼“å­˜</span></strong><span>ã€‚ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬çœ‹åˆ°ï¼Œå¦‚æœæœ‰ä¸€ä¸ªè®¢é˜…è€…æ‰§è¡Œçš„å¾ˆæ…¢çš„è¯ï¼Œé‚£ä¹ˆemitå°±ä¼šæŒ‚èµ·ç­‰å¾…æœ€æ…¢çš„è®¢é˜…è€…æ‰§è¡Œå®Œï¼Œä½†æ˜¯å¦‚æœé…ç½®äº†é¢å¤–ç¼“å­˜ä¸”ç¼“å­˜æœ‰å‰©ä½™ç©ºé—´çš„è¯ï¼Œæ­¤æ—¶å°±ä¸ä¼šæŒ‚èµ·ã€‚çœ‹å¦‚ä¸‹ä¸€ä¸ªä¾‹å­ã€‚</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">value</span> <span class="cm-operator">=</span> <span class="cm-number">0</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">sharedFlow</span> <span class="cm-operator">=</span> <span class="cm-variable">MutableSharedFlow</span><span class="cm-operator">&lt;</span><span class="cm-variable">Int</span><span class="cm-operator">&gt;</span>(<span class="cm-variable">replay</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>, <span class="cm-variable">extraBufferCapacity</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">runBlocking</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sharedFlow</span>.<span class="cm-variable">onEach</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//æ¨¡æ‹Ÿå¤„ç†è€—æ—¶</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">5000</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"receiver$it"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }.<span class="cm-variable">launchIn</span>(<span class="cm-variable">GlobalScope</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-atom">true</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">1000</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">v</span> <span class="cm-operator">=</span> <span class="cm-operator">++</span><span class="cm-variable">value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sharedFlow</span>.<span class="cm-variable">emit</span>(<span class="cm-variable">v</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"send$v"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//ç»“æœ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">12</span>:<span class="cm-number">57</span>:<span class="cm-number">23</span>:<span class="cm-number">347</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">12</span>:<span class="cm-number">57</span>:<span class="cm-number">24</span>:<span class="cm-number">372</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">12</span>:<span class="cm-number">57</span>:<span class="cm-number">25</span>:<span class="cm-number">374</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">12</span>:<span class="cm-number">57</span>:<span class="cm-number">26</span>:<span class="cm-number">377</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">12</span>:<span class="cm-number">57</span>:<span class="cm-number">28</span>:<span class="cm-number">350</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-variable">receiver1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">12</span>:<span class="cm-number">57</span>:<span class="cm-number">28</span>:<span class="cm-number">350</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">12</span>:<span class="cm-number">57</span>:<span class="cm-number">33</span>:<span class="cm-number">353</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">1</span>] <span class="cm-variable">receiver2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">12</span>:<span class="cm-number">57</span>:<span class="cm-number">33</span>:<span class="cm-number">353</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send6</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 528px;"></div><div class="CodeMirror-gutters" style="display: none; height: 528px;"></div></div></div></pre><p><span>å¯ä»¥çœ‹å¾—åˆ°replayä¸º0ï¼Œæ¨¡æ‹Ÿè€—æ—¶æ˜¯3ç§’ï¼Œç†è®ºä¸Šæ¥è¯´sendéœ€è¦æŒ‚èµ·ç­‰åˆ°è®¢é˜…è€…å¤„ç†å®Œã€‚ä½†æ˜¯å› ä¸ºé¢å¤–çš„ç¼“å­˜é…ç½®äº†3ï¼Œæ‰€ä»¥åœ¨è®¢é˜…è€…æ²¡æœ‰å¤„ç†å®Œçš„æ—¶å€™ï¼Œåˆè¿ç»­å‘å°„äº†3ä¸ªå€¼ï¼Œç›´åˆ°ç¬¬å››ä¸ªæ‰æŒ‚èµ·ç­‰å¾…è®¢é˜…è€…å¤„ç†å®Œæˆã€‚</span></p><p><span>æ‰€ä»¥ï¼Œæ€»çš„ç¼“å­˜æ•°é‡åº”è¯¥ç­‰äºï¼šreplay+extraBufferCapacityï¼›</span></p></li><li><p><strong><span>å¦‚æœåœ¨replayå’ŒextraBufferCapacityéƒ½å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œæ–°çš„è®¢é˜…è€…å–å€¼çš„ç­–ç•¥æ˜¯ä»€ä¹ˆå‘¢</span></strong><span>ï¼Ÿçœ‹ä¸€ä¸‹å¦‚ä¸‹çš„é€»è¾‘ğŸ™†â€â™€ï¸</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">value</span> <span class="cm-operator">=</span> <span class="cm-number">0</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">sharedFlow</span> <span class="cm-operator">=</span> <span class="cm-variable">MutableSharedFlow</span><span class="cm-operator">&lt;</span><span class="cm-variable">Int</span><span class="cm-operator">&gt;</span>(<span class="cm-variable">replay</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>, <span class="cm-variable">extraBufferCapacity</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">runBlocking</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sharedFlow</span>.<span class="cm-variable">onEach</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//æ¨¡æ‹Ÿå¤„ç†è€—æ—¶</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">5000</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"receiver$it"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }.<span class="cm-variable">launchIn</span>(<span class="cm-variable">GlobalScope</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">GlobalScope</span>.<span class="cm-variable">launch</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">5000</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sharedFlow</span>.<span class="cm-variable">collect</span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"receiver2:$it"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-atom">true</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-number">1000</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">v</span> <span class="cm-operator">=</span> <span class="cm-operator">++</span><span class="cm-variable">value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sharedFlow</span>.<span class="cm-variable">emit</span>(<span class="cm-variable">v</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>(<span class="cm-string">"send$v"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//ç»“æœ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">13</span>:<span class="cm-number">12</span>:<span class="cm-number">06</span>:<span class="cm-number">167</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">13</span>:<span class="cm-number">12</span>:<span class="cm-number">07</span>:<span class="cm-number">192</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">13</span>:<span class="cm-number">12</span>:<span class="cm-number">08</span>:<span class="cm-number">195</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">13</span>:<span class="cm-number">12</span>:<span class="cm-number">09</span>:<span class="cm-number">197</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">13</span>:<span class="cm-number">12</span>:<span class="cm-number">10</span>:<span class="cm-number">157</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">2</span>] <span class="cm-variable">receiver2</span>:<span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">13</span>:<span class="cm-number">12</span>:<span class="cm-number">10</span>:<span class="cm-number">157</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">2</span>] <span class="cm-variable">receiver2</span>:<span class="cm-number">4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">13</span>:<span class="cm-number">12</span>:<span class="cm-number">10</span>:<span class="cm-number">200</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">13</span>:<span class="cm-number">12</span>:<span class="cm-number">10</span>:<span class="cm-number">200</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">2</span>] <span class="cm-variable">receiver2</span>:<span class="cm-number">5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">13</span>:<span class="cm-number">12</span>:<span class="cm-number">11</span>:<span class="cm-number">170</span> [<span class="cm-variable">DefaultDispatcher</span><span class="cm-operator">-</span><span class="cm-variable">worker</span><span class="cm-operator">-</span><span class="cm-number">2</span>] <span class="cm-variable">receiver1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">13</span>:<span class="cm-number">12</span>:<span class="cm-number">11</span>:<span class="cm-number">203</span> [<span class="cm-variable">main</span>] <span class="cm-variable">send6</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 726px;"></div><div class="CodeMirror-gutters" style="display: none; height: 726px;"></div></div></div></pre><p><span>çœ‹receiver2ï¼Œæ˜¾è€Œæ˜“è§ï¼Œä¼šæŒ‰ç…§å½“å‰</span><strong><span>å·²å‘é€çš„æœ€è¿‘çš„replayä¸ªè¿›è¡Œå›æ’­ç»™æ–°çš„è®¢é˜…è€…</span></strong><span>ã€‚</span></p></li></ul><h3><a name="sharedflowä½¿ç”¨å®æˆ˜ğŸ™†â™€ï¸" class="md-header-anchor"></a><span>SharedFlowä½¿ç”¨å®æˆ˜ğŸ™†â€â™€ï¸</span></h3><ul><li><p><span>å¯ä»¥å°è£…ä¸ºäº‹ä»¶æ€»çº¿</span></p><p><span>SharedFlow å¯ç”¨äºå°†åº”ç”¨ç¨‹åºå†…éƒ¨å‘ç”Ÿçš„äº‹ä»¶å¹¿æ’­ç»™å¯ä»¥æ¥æ¥å»å»çš„è®¢é˜…è€…ã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹ç±»å°è£…äº†ä¸€ä¸ªäº‹ä»¶æ€»çº¿ï¼Œè¯¥æ€»çº¿ä»¥é›†åˆæ–¹å¼å°†äº‹ä»¶åˆ†å‘ç»™æ‰€æœ‰è®¢é˜…è€…ï¼ŒæŒ‚èµ·ç›´åˆ°æ‰€æœ‰è®¢é˜…è€…å¤„ç†æ¯ä¸ªäº‹ä»¶ï¼š</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">EventBus</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">val</span> <span class="cm-def">_events</span> <span class="cm-operator">=</span> <span class="cm-variable">MutableSharedFlow</span><span class="cm-operator">&lt;</span><span class="cm-variable">Event</span><span class="cm-operator">&gt;</span>() <span class="cm-comment">// private mutable shared flow</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">events</span> <span class="cm-operator">=</span> <span class="cm-variable">_events</span>.<span class="cm-variable">asSharedFlow</span>() <span class="cm-comment">// publicly exposed as read-only shared flow</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">suspend</span> <span class="cm-keyword">fun</span> <span class="cm-def">produceEvent</span>(<span class="cm-variable">event</span>: <span class="cm-variable">Event</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">_events</span>.<span class="cm-variable">emit</span>(<span class="cm-variable">event</span>) <span class="cm-comment">// suspends until all subscribers receive it</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre></li><li><p><span>Androidä¸­ä½¿ç”¨ï¼Œæ¯”å¦‚å®šæ—¶åˆ·æ–°æ–°é—»ï¼š</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// å½“åº”ç”¨ç¨‹åºä¸­æ‰€æœ‰éœ€è¦é›†ä¸­åˆ·æ–°çš„ç±»ï¼Œéƒ½å¯ä»¥è®¢é˜…tickFlowæ¥è·å–åŒä¸€æ—¶é—´çš„åˆ·æ–°</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">TickHandler</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">val</span> <span class="cm-def">externalScope</span>: <span class="cm-variable">CoroutineScope</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">val</span> <span class="cm-def">tickIntervalMs</span>: <span class="cm-variable-3">Long</span> <span class="cm-operator">=</span> <span class="cm-number">5000</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">val</span> <span class="cm-def">_tickFlow</span> <span class="cm-operator">=</span> <span class="cm-variable">MutableSharedFlow</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;</span>(<span class="cm-variable">replay</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">tickFlow</span>: <span class="cm-variable">SharedFlow</span><span class="cm-operator">&lt;</span><span class="cm-variable">Event</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;&gt;</span> <span class="cm-operator">=</span> <span class="cm-variable">_tickFlow</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">init</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">externalScope</span>.<span class="cm-variable">launch</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span>(<span class="cm-atom">true</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">_tickFlow</span>.<span class="cm-variable">emit</span>(<span class="cm-variable">Unit</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">delay</span>(<span class="cm-variable">tickIntervalMs</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">NewsRepository</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">val</span> <span class="cm-def">tickHandler</span>: <span class="cm-variable">TickHandler</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">val</span> <span class="cm-def">externalScope</span>: <span class="cm-variable">CoroutineScope</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">init</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">externalScope</span>.<span class="cm-variable">launch</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// ç›‘å¬æ›´æ–° &nbsp; collectä¼šæŒ‚èµ·  æ‰€ä»¥è¯¥åç¨‹ä¸€ç›´ä¸ä¼šå–æ¶ˆ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tickHandler</span>.<span class="cm-variable">tickFlow</span>.<span class="cm-variable">collect</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//todo åˆ·æ–° æ–°é—»</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 704px;"></div><div class="CodeMirror-gutters" style="display: none; height: 704px;"></div></div></div></pre></li><li><p><span>MutableSharedFlow è¿˜æœ‰ä¸€ä¸ª subscriptionCount å±æ€§ï¼Œå…¶ä¸­åŒ…å«æ´»åŠ¨æ”¶é›†å™¨çš„æ•°é‡ï¼Œå¯ä»¥ç”¨æ¥ååŠ©å¤„ç†å¾ˆå¤šäº‹æƒ…ï¼Œæ¯”å¦‚åˆ¤æ–­å½“å‰SharedFlowæ˜¯å¦è¢«æ¿€æ´»</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sharedFlow</span>.<span class="cm-variable">subscriptionCount</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">map</span> { <span class="cm-variable">count</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">count</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span> } <span class="cm-comment">// map count into active/inactive flag</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">distinctUntilChanged</span>() <span class="cm-comment">// only react to true&lt;-&gt;false changes</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">onEach</span> { <span class="cm-variable">isActive</span> <span class="cm-operator">-&gt;</span> <span class="cm-comment">// configure an action</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">isActive</span>) <span class="cm-variable">onActive</span>() <span class="cm-keyword">else</span> <span class="cm-variable">onInactive</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">launchIn</span>(<span class="cm-variable">scope</span>) <span class="cm-comment">// launch it</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre></li></ul><p><span>å¦å¤–è¡¥å……ä¸€ç‚¹ï¼šMutableSharedFlow è¿˜åŒ…å«ä¸€ä¸ª resetReplayCache å‡½æ•°ï¼Œå¯ä»¥ç”¨æ¥é‡ç½®å›æ’­çš„æ•°é‡ã€‚å¯ä»¥è‡ªè¡Œäº†è§£ä¸€ä¸‹ï¼Œè¿™é‡Œä¸å†ä¸¾ä¾‹ã€‚</span></p><h2><a name="sharedflowstateflowçš„ä½¿ç”¨åŒºåˆ«æ¢å¥è¯è¯´äº‹ä»¶å’ŒçŠ¶æ€çš„åŒºåˆ«" class="md-header-anchor"></a><span>SharedFlowã€StateFlowçš„ä½¿ç”¨åŒºåˆ«ï¼Œæ¢å¥è¯è¯´ï¼Œäº‹ä»¶å’ŒçŠ¶æ€çš„åŒºåˆ«ï¼Ÿ</span></h2><ul><li><strong><span>äº‹ä»¶</span></strong><span>ï¼šå¹¶ä¸å…¨æ˜¯å¸Œæœ›å°†æœ€æ–°ä¸€æ¡ä¹‹å‰çš„äº‹ä»¶å…¨éƒ¨ä¸¢å¼ƒã€‚ç»å¤§éƒ¨åˆ†æƒ…å†µæ˜¯å¸Œæœ›</span><strong><span>æ¯æ¡äº‹ä»¶éƒ½èƒ½è¢«æ‰§è¡Œ</span></strong><span>ã€‚</span></li><li><strong><span>çŠ¶æ€</span></strong><span>ï¼šå¯ä»¥å…è®¸ä¸¢å¼ƒï¼Œå±•ç¤ºæœ€æ–°çš„çŠ¶æ€ç»™UIå±•ç¤ºå³å¯ï¼Œæ¯”å¦‚é€šçŸ¥æ›´æ–°è¿›åº¦ã€‚</span></li></ul><p><strong><span>StateFlow</span></strong><span>å¯ä»¥æ›´æ–°å€¼ï¼Œä¸ä¼šå…³å¿ƒå½“å‰æ¶ˆè´¹è€…æ˜¯å¦æ¶ˆè´¹å®Œæ¯•ä¸Šä¸€ä¸ªå€¼ï¼ˆä¸¢å¤±ä¸­é—´å€¼ï¼‰ã€‚é€‚ç”¨äºçŠ¶æ€ã€‚</span></p><p><strong><span>SharedFlow</span></strong><span>ä¼šæŒ‚èµ·ç›´åˆ°ï¼Œæœ€åä¸€ä¸ªè®¢é˜…è€…å¤„ç†å®Œæˆäº‹ä»¶ï¼Œæ‰ä¼šå‘å°„ä¸‹ä¸€ä¸ªå€¼ã€‚é€‚ç”¨äºäº‹ä»¶æ¶ˆè´¹ã€‚</span></p><h2><a name="stateflowsharedflowæºç è§£æ" class="md-header-anchor"></a><span>StateFlowã€SharedFlowæºç è§£æ</span></h2><p><span>åˆåˆ°äº†æ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»äº†ï¼Œæºç åˆ†æå®ƒæ¥äº†ï¼ï¼ï¼ğŸ™†â€â™€ï¸</span></p><p><span>StateFlowå®ç°å’ŒSharedFlowå®ç°ç›¸å¯¹æ¥è¯´å¤§å·®ä¸å¤§ï¼Œç›¸å¯¹æ¥è¯´SharedFlowä¼šæ›´å¤æ‚ä¸€ç‚¹ï¼Œç¯‡å¹…æœ‰é™ï¼Œæ‰€ä»¥è¿™é‡Œå°±åªå¯¹SharedFlowåšä¸€æ³¢å®ç°åˆ†æï¼ŒStateFlowå¤§å®¶å¯ä»¥æ ¹æ®SharedFlowçš„æºç è‡ªè¡Œè·Ÿä¸€æ³¢ğŸ˜®ã€‚</span></p><h3><a name="è®¤è¯†å‡ ä¸ªå˜é‡" class="md-header-anchor"></a><span>è®¤è¯†å‡ ä¸ªå˜é‡</span></h3><p><span>å…ˆçœ‹ä¸€ä¸‹</span><code>MutableSharedFlow</code><span>å‡½æ•°å§ï¼Œå¯ä»¥æ„å»ºä¸€ä¸ª</span><code>SharedFlow</code><span>ã€‚</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">fun</span> <span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> <span class="cm-variable">MutableSharedFlow</span>(</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">replay</span>: <span class="cm-variable">Int</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">extraBufferCapacity</span>: <span class="cm-variable">Int</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">onBufferOverflow</span>: <span class="cm-variable">BufferOverflow</span> <span class="cm-operator">=</span> <span class="cm-variable">BufferOverflow</span>.<span class="cm-variable">SUSPEND</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">): <span class="cm-variable">MutableSharedFlow</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">bufferCapacity0</span> <span class="cm-operator">=</span> <span class="cm-variable">replay</span> <span class="cm-operator">+</span> <span class="cm-variable">extraBufferCapacity</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">bufferCapacity</span> <span class="cm-operator">=</span> <span class="cm-keyword">if</span> (<span class="cm-variable">bufferCapacity0</span> <span class="cm-operator">&lt;</span> <span class="cm-number">0</span>) <span class="cm-variable">Int</span>.<span class="cm-variable">MAX_VALUE</span> <span class="cm-keyword">else</span> <span class="cm-variable">bufferCapacity0</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//ä¼ è¿›å» replay ï¼Œ bufferCapacity = replay + extraBufferCapacity  ï¼Œ onBufferOverflow</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">SharedFlowImpl</span>(<span class="cm-variable">replay</span>, <span class="cm-variable">bufferCapacity</span>, <span class="cm-variable">onBufferOverflow</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 242px;"></div><div class="CodeMirror-gutters" style="display: none; height: 242px;"></div></div></div></pre><p><span>æ­¤æ—¶ä¼šæœ‰å‡ ä¸ªå˜é‡ï¼Œä¼ åˆ°</span><code>SharedFlowImpl</code><span>æ„å»ºäº†SharedFlowï¼Œè¿™å‡ ä¸ªå˜é‡é€šè¿‡ä¸Šé¢çš„ä»‹ç»åº”è¯¥æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼Œä¸‹é¢ç®€å•åˆ—ä¸€ä¸‹ã€‚</span></p><ul><li><span>replay å›æ’­ç»™æ–°è®¢é˜…è€…æ•°é‡</span></li><li><span>bufferCapacity çœŸæ­£ç¼“å­˜å®¹é‡ = replay + extraBufferCapacity</span></li><li><span>onBufferOverflow å½“ç¼“å­˜æ± æ»¡äº†ä¹‹åçš„å¤„ç†ç­–ç•¥</span></li></ul><p><span>æ¥ä¸‹æ¥ï¼Œéœ€è¦çœ‹</span><code>SharedFlowImpl</code><span>é‡Œé¢æ¶‰åŠåˆ°çš„å˜é‡ï¼Œç”±äº</span><code>SharedFlowImpl</code><span>é‡Œé¢æ¶‰åŠåˆ°çš„ä»£ç é‡è¿‡å¤šï¼Œè¿™é‡Œå°±ä¸è´´ä»£ç ï¼Œåªåˆ—ä¸€ä¸‹å˜é‡çš„åå­—ä»¥åŠå«ä¹‰ã€‚</span></p><ul><li><span>buffer: Array&lt;Any?&gt;? ç¼“å­˜å‘å°„çš„å€¼ï¼ˆæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ç›´æ¥æ˜¯å‘å°„çš„å€¼ï¼Œå¦å¤–æ˜¯å€¼çš„åŒ…è£…ç±»Emittersï¼‰ï¼ŒæŒ‰éœ€åˆ†é…ï¼Œåˆ†é…çš„å¤§å°æ€»æ˜¯äºŒçš„å¹‚</span></li><li><span>replayIndex :Int å¯¹äºæ–°çš„æ”¶é›†å™¨æ¥è¯´ï¼Œæœ€å°çš„å›æ’­åºå·ã€‚é»˜è®¤å€¼ä¸º0</span></li><li><span>minCollectorIndex :Int å¯¹äºå·²ç»æ¿€æ´»çš„æ”¶é›†å™¨æ¥è¯´ï¼Œæœ€å°çš„ç´¢å¼•ã€‚å¦‚æœæ²¡æœ‰ç­‰äºreplayIndex</span></li><li><span>bufferSize :Int ç¼“å­˜çš„å€¼ çš„size</span></li><li><span>queueSize :Int æŒ‚èµ·æ’é˜Ÿå‘å°„ çš„size</span></li><li><span>head : Long = minOf(minCollectorIndex, replayIndex)  ç¼“å­˜é˜Ÿåˆ—çš„å¤´</span></li><li><span>replaySize :Int éœ€è¦å›æ’­çš„size</span></li><li><span>totalSize : Int ç¼“å­˜çš„å€¼æ•°é‡å’Œæ’é˜ŸæŒ‚èµ·å‘å°„å€¼æ•°é‡æ€»å’Œ</span></li><li><span>bufferEndIndex :Long ç¼“å­˜å€¼çš„æœ€åä¸€ä¸ªçš„åºå·ç´¢å¼•</span></li><li><span>queueEndIndex :Long æ’é˜Ÿå‘å°„å™¨é˜Ÿåˆ—æœ€åä¸€ä¸ªçš„åºå·ç´¢å¼•</span></li></ul><h3><a name="å®˜æ–¹bufferç¼“å­˜æ± é€»è¾‘ç»“æ„" class="md-header-anchor"></a><span>å®˜æ–¹</span><code>buffer</code><span>ç¼“å­˜æ± ï¼Œé€»è¾‘ç»“æ„</span></h3><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">buffered</span> <span class="cm-variable">values</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">/-----------------------</span><span class="cm-variable">\</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">replayCache</span> &nbsp; &nbsp; &nbsp;<span class="cm-variable">queued</span> <span class="cm-variable">emitters</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-operator">/----------</span><span class="cm-variable">\</span><span class="cm-operator">/----------------------</span><span class="cm-variable">\</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">|</span> &nbsp; <span class="cm-operator">|</span> <span class="cm-number">1</span> <span class="cm-operator">|</span> <span class="cm-number">2</span> <span class="cm-operator">|</span> <span class="cm-number">3</span> <span class="cm-operator">|</span> <span class="cm-number">4</span> <span class="cm-operator">|</span> <span class="cm-number">5</span> <span class="cm-operator">|</span> <span class="cm-number">6</span> <span class="cm-operator">|</span> <span class="cm-variable">E</span> <span class="cm-operator">|</span> <span class="cm-variable">E</span> <span class="cm-operator">|</span> <span class="cm-variable">E</span> <span class="cm-operator">|</span> <span class="cm-variable">E</span> <span class="cm-operator">|</span> <span class="cm-variable">E</span> <span class="cm-operator">|</span> <span class="cm-variable">E</span> <span class="cm-operator">|</span> &nbsp; <span class="cm-operator">|</span> &nbsp; <span class="cm-operator">|</span> &nbsp; <span class="cm-operator">|</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">^</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">^</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">^</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">^</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">|</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">|</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">|</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-operator">|</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">head</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">|</span> &nbsp; &nbsp; &nbsp;<span class="cm-variable">head</span> <span class="cm-operator">+</span> <span class="cm-variable">bufferSize</span> &nbsp; &nbsp; <span class="cm-variable">head</span> <span class="cm-operator">+</span> <span class="cm-variable">totalSize</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">|</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">|</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">|</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-variable">index</span> <span class="cm-variable">of</span> <span class="cm-variable">the</span> <span class="cm-variable">slowest</span> &nbsp;<span class="cm-operator">|</span> &nbsp; &nbsp;<span class="cm-variable">index</span> <span class="cm-variable">of</span> <span class="cm-variable">the</span> <span class="cm-variable">fastest</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable">possible</span> <span class="cm-variable">collector</span> &nbsp; <span class="cm-operator">|</span> &nbsp; &nbsp; <span class="cm-variable">possible</span> <span class="cm-variable">collector</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">|</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">|</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">|</span> &nbsp; &nbsp; <span class="cm-variable">replayIndex</span> <span class="cm-operator">==</span> <span class="cm-variable">new</span> <span class="cm-variable">collector</span><span class="cm-string">'s index</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">\---------------------- /</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">range of possible minCollectorIndex</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">head == minOf(minCollectorIndex, replayIndex) // by definition</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">totalSize == bufferSize + queueSize // by definition</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-string">INVARIANTS:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">minCollectorIndex = activeSlots.minOf { it.index } ?: (head + bufferSize)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">replayIndex &lt;= head + bufferSize</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 528px;"></div><div class="CodeMirror-gutters" style="display: none; height: 528px;"></div></div></div></pre><h3><a name="ç†Ÿæ‚‰ä¸€ä¸‹æ¶‰åŠåˆ°çš„å‡ ä¸ªå…¶ä»–ç±»" class="md-header-anchor"></a><span>ç†Ÿæ‚‰ä¸€ä¸‹æ¶‰åŠåˆ°çš„å‡ ä¸ªå…¶ä»–ç±»</span></h3><p><span>åœ¨é˜…è¯»ä¸»æµç¨‹ä»£ç ä¹‹å‰è¿˜è¦åˆ†æå‡ ä¸ª</span><code>ç±»</code><span>ä»¥åŠ</span><code>æ–¹æ³•</code><span>ï¼Œè¾…åŠ©ä¸»æµç¨‹ä»£ç çš„è¿›è¡Œã€‚ğŸ™†â€â™€ï¸</span></p><p><span>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“SharedFlowå…·ä½“å®ç°ç±»æ˜¯</span><code>SharedFlowImpl</code><span>ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆåˆ†æ</span><code>SharedFlowImpl</code><span>çš„çˆ¶ç±»å’Œæ¥å£ã€‚</span></p><p><strong><span>å…ˆçœ‹ä¸€ä¸‹</span><code>MutableSharedFlow</code><span>æ¥å£</span></strong><span>ğŸ‘€</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">interface</span> <span class="cm-def">MutableSharedFlow</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> : <span class="cm-variable">SharedFlow</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span>, <span class="cm-variable">FlowCollector</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">override</span> <span class="cm-keyword">suspend</span> <span class="cm-keyword">fun</span> <span class="cm-def">emit</span>(<span class="cm-variable">value</span>: <span class="cm-variable">T</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">fun</span> <span class="cm-def">tryEmit</span>(<span class="cm-variable">value</span>: <span class="cm-variable">T</span>): <span class="cm-variable-3">Boolean</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">val</span> <span class="cm-def">subscriptionCount</span>: <span class="cm-variable">StateFlow</span><span class="cm-operator">&lt;</span><span class="cm-variable">Int</span><span class="cm-operator">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">@ExperimentalCoroutinesApi</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">fun</span> <span class="cm-def">resetReplayCache</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">interface</span> <span class="cm-def">SharedFlow</span><span class="cm-operator">&lt;</span><span class="cm-keyword">out</span> <span class="cm-variable">T</span><span class="cm-operator">&gt;</span> : <span class="cm-variable">Flow</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">val</span> <span class="cm-def">replayCache</span>: <span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">interface</span> <span class="cm-def">Flow</span><span class="cm-operator">&lt;</span><span class="cm-keyword">out</span> <span class="cm-variable">T</span><span class="cm-operator">&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">@InternalCoroutinesApi</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">suspend</span> <span class="cm-keyword">fun</span> <span class="cm-def">collect</span>(<span class="cm-variable">collector</span>: <span class="cm-variable">FlowCollector</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 308px;"></div><div class="CodeMirror-gutters" style="display: none; height: 308px;"></div></div></div></pre><p><span>çœ‹å¾—å‡ºæä¾›äº†ä¸€äº›æ–¹æ³•æˆ–è€…å¸¸é‡çš„å®ç°æ¥å£æ–¹æ³•ã€‚</span></p><h3><a name="ä¸»æµç¨‹å®ç°åˆ†æ" class="md-header-anchor"></a><span>ä¸»æµç¨‹å®ç°åˆ†æ</span></h3><p><span>ä¸Šé¢çš„çŸ¥è¯†äº†è§£ä¹‹åï¼Œä¸‹é¢è¿›è¡Œä¸»æµç¨‹çš„åˆ†æã€‚</span></p><p><strong><span>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹å‘å°„</span><code>emit</code></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">override</span> <span class="cm-keyword">suspend</span> <span class="cm-keyword">fun</span> <span class="cm-def">emit</span>(<span class="cm-variable">value</span>: <span class="cm-variable">T</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">tryEmit</span>(<span class="cm-variable">value</span>)) <span class="cm-keyword">return</span> <span class="cm-comment">// fast-path</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emitSuspend</span>(<span class="cm-variable">value</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><p><span>å¥½çš„çœ‹å¾—å‡ºï¼Œä¼šå…ˆè¿›è¡Œ</span><code>tryEmit</code><span>è¿™ä¸ªè¿‡ç¨‹æ²¡æœ‰æŒ‚èµ·ï¼Œå¦‚æœå¯ä»¥è¿™æ—¶å€™å‘å°„çš„è¯ï¼Œå°±returnäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹ä¸€ä¸‹</span><code>tryEmit</code></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">override</span> <span class="cm-keyword">fun</span> <span class="cm-def">tryEmit</span>(<span class="cm-variable">value</span>: <span class="cm-variable">T</span>): <span class="cm-variable-3">Boolean</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">resumes</span>: <span class="cm-variable">Array</span><span class="cm-operator">&lt;</span><span class="cm-variable">Continuation</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;?&gt;</span> <span class="cm-operator">=</span> <span class="cm-variable">EMPTY_RESUMES</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">emitted</span> <span class="cm-operator">=</span> <span class="cm-variable">synchronized</span>(<span class="cm-keyword">this</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">tryEmitLocked</span>(<span class="cm-variable">value</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//è¿”å›äº† éœ€è¦æ¢å¤çš„è®¢é˜…è€… ä¸»è¦ä¾¿åˆ©äº†æ‰€æœ‰çš„å¡æ§½ï¼Œå°†éœ€è¦æ¢å¤çš„è®¢é˜…è€…continuationæ‹‰å‡ºæ¥</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">resumes</span> <span class="cm-operator">=</span> <span class="cm-variable">findSlotsToResumeLocked</span>(<span class="cm-variable">resumes</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-atom">true</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-atom">false</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">//æ¢å¤éœ€è¦æ¢å¤çš„è®¢é˜…è€…åˆ—è¡¨</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">cont</span> <span class="cm-keyword">in</span> <span class="cm-variable">resumes</span>) <span class="cm-variable">cont</span><span class="cm-operator">?</span>.<span class="cm-variable">resume</span>(<span class="cm-variable">Unit</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">emitted</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">private</span> <span class="cm-keyword">fun</span> <span class="cm-def">tryEmitLocked</span>(<span class="cm-variable">value</span>: <span class="cm-variable">T</span>): <span class="cm-variable-3">Boolean</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// Fast path without collectors -&gt; no buffering</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">nCollectors</span> <span class="cm-operator">==</span> <span class="cm-number">0</span>) <span class="cm-keyword">return</span> <span class="cm-variable">tryEmitNoCollectorsLocked</span>(<span class="cm-variable">value</span>) <span class="cm-comment">// always returns true</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// çœ‹çš„å‡ºåªæœ‰å½“å‰ç¼“å­˜å®¹é‡æœ‰å‰©ä½™ç©ºé—´çš„è¯æˆ–è€…DROP_OLDESTç­–ç•¥ï¼Œæ‰ä¼šç»§ç»­åé¢çš„æµç¨‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">bufferSize</span> <span class="cm-operator">&gt;=</span> <span class="cm-variable">bufferCapacity</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">minCollectorIndex</span> <span class="cm-operator">&lt;=</span> <span class="cm-variable">replayIndex</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">when</span> (<span class="cm-variable">onBufferOverflow</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">BufferOverflow</span>.<span class="cm-variable">SUSPEND</span> <span class="cm-operator">-&gt;</span> <span class="cm-keyword">return</span> <span class="cm-atom">false</span> <span class="cm-comment">// will suspend</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">BufferOverflow</span>.<span class="cm-variable">DROP_LATEST</span> <span class="cm-operator">-&gt;</span> <span class="cm-keyword">return</span> <span class="cm-atom">true</span> <span class="cm-comment">// just drop incoming</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">BufferOverflow</span>.<span class="cm-variable">DROP_OLDEST</span> <span class="cm-operator">-&gt;</span> {} <span class="cm-comment">// force enqueue &amp; drop oldest instead</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-comment">//ç¼“å­˜æ§ä»¶æœ‰å‰©ä½™æˆ–è€…DROP_OLDESTç­–ç•¥ï¼Œå…è®¸å‘å°„å€¼ï¼Œå‘é€è¿›å…¥bufferé˜Ÿåˆ—</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">enqueueLocked</span>(<span class="cm-variable">value</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-comment">//å…¶ä»–çŠ¶æ€è°ƒæ•´ï¼ŒåŒ…æ‹¬buffersizeç­‰ç›¸å…³çŠ¶æ€</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  ....</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-comment">//è¿”å›trueï¼Œä»£ç å‘ç”ŸæˆåŠŸ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-atom">true</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 726px;"></div><div class="CodeMirror-gutters" style="display: none; height: 726px;"></div></div></div></pre><p><span>å¯ä»¥å‘ç°åœ¨ç¼“å­˜åŒºæœ‰ç©ºé—²å‰©ä½™çš„æ—¶å€™ï¼Œå…è®¸ä¸æŒ‚èµ·ç›´æ¥å‘å°„å€¼ã€‚</span></p><p><span>è¿™é‡Œæ³¨æ„ä¸€ç‚¹ğŸ‘€ï¼Œ</span><strong><span>æ¯”å¦‚è®¾ç½®äº†replayå’ŒextraBufferCapacityå‡ä¸º0æ—¶ï¼Œå³ç›´æ¥æ„é€ çš„SharedFlowï¼Œæ­¤æ—¶</span><code>bufferSize &gt;= bufferCapacity &amp;&amp; minCollectorIndex &lt;= replayIndex == true</code><span>æ‰€ä»¥ä½¿ç”¨tryEmitçš„è¯ï¼Œæ°¸è¿œå‘å°„ä¸äº†å€¼</span></strong><span>ã€‚</span></p><p>&nbsp;</p><p><span>å¦‚æœç¼“å­˜åŒºä¸æ»¡è¶³ï¼Œæ¯”å¦‚ä¸Šé¢çš„æƒ…å†µï¼Œæ­¤æ—¶å°±å¿…é¡»è¦æŒ‚èµ·äº†ï¼Œæ‰€ä»¥ç»§ç»­çœ‹</span><code>emitSuspend</code><span>å‡½æ•°ã€‚</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">suspend</span> <span class="cm-keyword">fun</span> <span class="cm-def">emitSuspend</span>(<span class="cm-variable">value</span>: <span class="cm-variable">T</span>) <span class="cm-operator">=</span> <span class="cm-variable">suspendCancellableCoroutine</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;</span> <span class="cm-variable">sc@</span>{ <span class="cm-variable">cont</span> <span class="cm-operator">-&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">resumes</span>: <span class="cm-variable">Array</span><span class="cm-operator">&lt;</span><span class="cm-variable">Continuation</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;?&gt;</span> <span class="cm-operator">=</span> <span class="cm-variable">EMPTY_RESUMES</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//åŠ äº†é”  æ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">emitter</span> <span class="cm-operator">=</span> <span class="cm-variable">synchronized</span>(<span class="cm-keyword">this</span>) <span class="cm-variable">lock@</span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// è¿™ä¸€æ­¥é‡è¯•çš„ä¹‹å‰çš„tryEmit</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">tryEmitLocked</span>(<span class="cm-variable">value</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cont</span>.<span class="cm-variable">resume</span>(<span class="cm-variable">Unit</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">resumes</span> <span class="cm-operator">=</span> <span class="cm-variable">findSlotsToResumeLocked</span>(<span class="cm-variable">resumes</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span><span class="cm-variable">@lock</span> <span class="cm-atom">null</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// å‘ç°è¿˜ä¸è¡Œ åˆ›å»ºEmitterå¯¹è±¡ï¼Œè®°å½•ç›¸å…³ä¿¡æ¯</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Emitter</span>(<span class="cm-keyword">this</span>, <span class="cm-variable">head</span> <span class="cm-operator">+</span> <span class="cm-variable">totalSize</span>, <span class="cm-variable">value</span>, <span class="cm-variable">cont</span>).<span class="cm-variable">also</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">enqueueLocked</span>(<span class="cm-variable">it</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">queueSize</span><span class="cm-operator">++</span> <span class="cm-comment">// å‘å°„å™¨é˜Ÿåˆ—++</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// æŸ¥æ‰¾å¯ä»¥æ¢å¤çš„è®¢é˜…è€…</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">bufferCapacity</span> <span class="cm-operator">==</span> <span class="cm-number">0</span>) <span class="cm-variable">resumes</span> <span class="cm-operator">=</span> <span class="cm-variable">findSlotsToResumeLocked</span>(<span class="cm-variable">resumes</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// å°†EmitteråŠ å…¥å–æ¶ˆå›è°ƒï¼Œåœ¨å½“å‰åç¨‹å–æ¶ˆæ—¶ä¼šè§¦å‘onDisposeå‡½æ•°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">emitter</span><span class="cm-operator">?</span>.<span class="cm-variable">let</span> { <span class="cm-variable">cont</span>.<span class="cm-variable">disposeOnCancellation</span>(<span class="cm-variable">it</span>) }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// æ¢å¤é€šçŸ¥è®¢é˜…è€…</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">cont</span> <span class="cm-keyword">in</span> <span class="cm-variable">resumes</span>) <span class="cm-variable">cont</span><span class="cm-operator">?</span>.<span class="cm-variable">resume</span>(<span class="cm-variable">Unit</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 506px;"></div><div class="CodeMirror-gutters" style="display: none; height: 506px;"></div></div></div></pre><p><span>å¦‚æœå‰é¢çš„ä¸œè¥¿éƒ½ç†è§£çš„è¯ï¼Œå…¶å®ä¹Ÿæ¯”è¾ƒç®€å•çš„å§ã€‚ä¸»è¦æ˜¯å°†å½“å‰çš„å€¼å°è£…å­˜åˆ°æ•°ç»„é‡Œé¢ï¼Œç„¶åæ¢å¤é€šçŸ¥è®¢é˜…è€…ï¼Œè‡ªèº«æŒ‚èµ·ã€‚ç­‰å¾…è®¢é˜…è€…è°ƒç”¨æ¢å¤ã€‚</span></p><p>&nbsp;</p><p><strong><span>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹è®¢é˜…è€…</span><code>collect</code><span>çš„å®ç°</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">override</span> <span class="cm-keyword">suspend</span> <span class="cm-keyword">fun</span> <span class="cm-def">collect</span>(<span class="cm-variable">collector</span>: <span class="cm-variable">FlowCollector</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//è°ƒç”¨çˆ¶ç±»ï¼ˆAbstractSharedFlowï¼‰allocateSlot()  åˆ†é…å¡æ§½</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">slot</span> <span class="cm-operator">=</span> <span class="cm-variable">allocateSlot</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">collector</span> <span class="cm-keyword">is</span> <span class="cm-variable">SubscribedFlowCollector</span>) <span class="cm-variable">collector</span>.<span class="cm-variable">onSubscription</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">collectorJob</span> <span class="cm-operator">=</span> <span class="cm-variable">currentCoroutineContext</span>()[<span class="cm-variable">Job</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-atom">true</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">newValue</span>: <span class="cm-variable">Any</span><span class="cm-operator">?</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-atom">true</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//æŸ¥æ‰¾å€¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">newValue</span> <span class="cm-operator">=</span> <span class="cm-variable">tryTakeValue</span>(<span class="cm-variable">slot</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//å¦‚æœæŸ¥æ‰¾åˆ°å€¼ breakå½“å‰å¾ªç¯</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">newValue</span> <span class="cm-operator">!==</span> <span class="cm-variable">NO_VALUE</span>) <span class="cm-keyword">break</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//æ²¡æœ‰æ‰¾åˆ°å€¼å¯ä¾›å‘å°„ï¼Œåˆ™æŒ‚èµ·</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">awaitValue</span>(<span class="cm-variable">slot</span>) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">collectorJob</span><span class="cm-operator">?</span>.<span class="cm-variable">ensureActive</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//å½“ä¸Šä¸€ä¸ªå¾ªç¯é€€å‡ºæ—¶ï¼Œä»£è¡¨æ‰¾åˆ°äº†å€¼ï¼Œè°ƒç”¨collectorçš„emitè¿›è¡ŒçœŸæ­£çš„å‘å°„ï¼Œæ­¤æ—¶å°±ä¼šè°ƒç”¨åˆ°å¤–éƒ¨çš„collectç¨‹åºä½“äº†ã€‚å¦‚æœè¿™ä¸€å—ä¸æ¸…æ¥šï¼Œå¯ä»¥çœ‹åšä¸»ä¹‹å‰å¯¹äºflowç¯‡çš„è¯¦è§£ã€‚</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">collector</span>.<span class="cm-variable">emit</span>(<span class="cm-variable">newValue</span> <span class="cm-keyword">as</span> <span class="cm-variable">T</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">finally</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//å¡æ§½é‡Šæ”¾</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">freeSlot</span>(<span class="cm-variable">slot</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 572px;"></div><div class="CodeMirror-gutters" style="display: none; height: 572px;"></div></div></div></pre><p><span>çœ‹çš„å‡ºï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå¾ªç¯çš„è¿‡ç¨‹ã€‚å¦‚æœç¼“å­˜åŒºä¸€ç›´æœ‰å€¼ï¼Œå°±ä¸€ç›´ä¼šå‘å°„å€¼å‡ºå»ã€‚å¦‚æœæ²¡æœ‰å€¼åˆ™æŒ‚èµ·ç­‰å¾…æ¢å¤ã€‚æ‰€ä»¥æœ‰ä¸¤ä¸ªå…³é”®çš„æ–¹æ³•</span><code>tryTakeValue</code><span>æŸ¥æ‰¾å€¼ä»¥åŠ</span><code>awaitValue</code><span>æŒ‚èµ·ã€‚</span></p><p><span>ä¸‹é¢æˆ‘ä»¬åˆ†æä¸€ä¸‹è¿™ä¸¤ä¸ªæ–¹æ³•çš„å®ç°ğŸ‘€ã€‚</span></p><p><strong><span>tryTakeValue</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">fun</span> <span class="cm-def">tryTakeValue</span>(<span class="cm-variable">slot</span>: <span class="cm-variable">SharedFlowSlot</span>): <span class="cm-variable">Any</span><span class="cm-operator">?</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">resumes</span>: <span class="cm-variable">Array</span><span class="cm-operator">&lt;</span><span class="cm-variable">Continuation</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;?&gt;</span> <span class="cm-operator">=</span> <span class="cm-variable">EMPTY_RESUMES</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">value</span> <span class="cm-operator">=</span> <span class="cm-variable">synchronized</span>(<span class="cm-keyword">this</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//è·å–å½“å‰å¡æ§½çš„ç´¢å¼•indexï¼Œå¦‚æœindexéæ³•åˆ™è¿”å›-1ï¼Œä»£è¡¨æ²¡æœ‰æ‰¾åˆ°å€¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">index</span> <span class="cm-operator">=</span> <span class="cm-variable">tryPeekLocked</span>(<span class="cm-variable">slot</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">index</span> <span class="cm-operator">&lt;</span> <span class="cm-number">0</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">NO_VALUE</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//èµ°è¿™ä¸ªåˆ†æ”¯ï¼Œå¯ä»¥æ‰¾åˆ°æ­£å¸¸çš„index</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">oldIndex</span> <span class="cm-operator">=</span> <span class="cm-variable">slot</span>.<span class="cm-variable">index</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//æ ¹æ®ç´¢å¼•ï¼Œåœ¨bufferä¸­è·å–å€¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">newValue</span> <span class="cm-operator">=</span> <span class="cm-variable">getPeekedValueLockedAt</span>(<span class="cm-variable">index</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">slot</span>.<span class="cm-variable">index</span> <span class="cm-operator">=</span> <span class="cm-variable">index</span> <span class="cm-operator">+</span> <span class="cm-number">1</span> <span class="cm-comment">// æŒ‡å‘ä¸‹ä¸€ä¸ªå€¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//è¯¥æ–¹æ³•é‡Œé¢å„ç§é€»è¾‘å¤ªå¤šï¼Œå°±ä¸å±•å¼€åˆ†æäº†ã€‚</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//ä¸»è¦æ˜¯è·å–äº†å¯ä»¥æ¢å¤çš„å‘å°„å™¨ï¼Œæ ¹æ®ç¼“å­˜çš„sizeå’Œç›®å‰çš„å€¼çš„æ•°é‡ï¼Œåˆ¤æ–­å¯ä»¥æ¢å¤æ¢å¤çš„å‘å°„å™¨çš„æ•°é‡ã€‚</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//æ ¹æ®æ’é˜ŸæŒ‚èµ·çš„å‘å°„å™¨ï¼Œè·å–å¯¹åº”çš„æ•°é‡ï¼Œè¿›è¡Œæ¢å¤ã€‚å¦å¤–åœ¨è¯¥æ–¹æ³•åé¢è¿˜è°ƒç”¨äº†updateBufferLockedæ–¹æ³•ï¼Œè¿›è¡Œbufferæ•°ç»„å„ç§çŠ¶æ€çš„é‡æ–°è®¾ç½®ï¼Œæ¯”å¦‚headç­‰ç›¸å…³çŠ¶æ€ã€‚</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">resumes</span> <span class="cm-operator">=</span> <span class="cm-variable">updateCollectorIndexLocked</span>(<span class="cm-variable">oldIndex</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">newValue</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//æ¢å¤ç›¸åº”çš„å‘å°„å™¨</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">resume</span> <span class="cm-keyword">in</span> <span class="cm-variable">resumes</span>) <span class="cm-variable">resume</span><span class="cm-operator">?</span>.<span class="cm-variable">resume</span>(<span class="cm-variable">Unit</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 550px;"></div><div class="CodeMirror-gutters" style="display: none; height: 550px;"></div></div></div></pre><p><span>ä¸»è¦æ˜¯å¯¹è·å–å¡æ§½ï¼Œé€šè¿‡ç´¢å¼•è·å–å€¼ï¼Œå¦å¤–åˆ¤æ–­æ­¤æ—¶æœ‰å¤šå°‘å‘å°„å™¨å¯ä»¥æ¢å¤ï¼Œç„¶åè¿›è¡Œé€šçŸ¥å‘å°„å™¨çš„æ¢å¤ã€‚</span></p><p><strong><span>awaitValue</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">suspend</span> <span class="cm-keyword">fun</span> <span class="cm-def">awaitValue</span>(<span class="cm-variable">slot</span>: <span class="cm-variable">SharedFlowSlot</span>): <span class="cm-variable">Unit</span> <span class="cm-operator">=</span> <span class="cm-variable">suspendCancellableCoroutine</span> { <span class="cm-variable">cont</span> <span class="cm-operator">-&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">synchronized</span>(<span class="cm-keyword">this</span>) <span class="cm-variable">lock@</span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">index</span> <span class="cm-operator">=</span> <span class="cm-variable">tryPeekLocked</span>(<span class="cm-variable">slot</span>) <span class="cm-comment">// é‡æ–°ä½¿ç”¨tryPeekLockedåˆ¤æ–­æ˜¯å¦å­˜åœ¨å¯ç”¨çš„å€¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">index</span> <span class="cm-operator">&lt;</span> <span class="cm-number">0</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">slot</span>.<span class="cm-variable">cont</span> <span class="cm-operator">=</span> <span class="cm-variable">cont</span> <span class="cm-comment">// æ²¡æœ‰å€¼æŒ‚èµ·</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cont</span>.<span class="cm-variable">resume</span>(<span class="cm-variable">Unit</span>) <span class="cm-comment">// æœ‰å€¼ä¸éœ€è¦æŒ‚èµ·</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span><span class="cm-variable">@lock</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">slot</span>.<span class="cm-variable">cont</span> <span class="cm-operator">=</span> <span class="cm-variable">cont</span> <span class="cm-comment">// æŒ‚èµ·ç­‰å¾…</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 264px;"></div><div class="CodeMirror-gutters" style="display: none; height: 264px;"></div></div></div></pre><p><span>è¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œåˆ¤æ–­å¯ä»¥æŒ‚èµ·çš„è¯ï¼Œç›´æ¥å°†continuationèµ‹å€¼ç»™å¡æ§½ã€‚æŒ‚èµ·äº†ï¼Œç­‰å¾…å‘å°„å™¨çš„æ¢å¤ã€‚</span></p><h3><a name="æ€»ç»“ğŸ˜®" class="md-header-anchor"></a><span>æ€»ç»“ğŸ˜®</span></h3><p><span>ä»¥ä¸Šå°±æ˜¯SharedFlowåŸºæœ¬çš„æµç¨‹äº†ï¼Œå¯èƒ½æ¯”è¾ƒç»•å§ï¼Œå„ç§çŠ¶æ€çš„ï¼Œåšä¸»ä¹Ÿæ˜¯èŠ±äº†ä¸€äº›æ—¶é—´æ‰å®Œå…¨ç†æ¸…æ¥šã€‚å„ä½å†çœ‹çš„æ—¶å€™ï¼Œå¯ä»¥ç»“åˆæºç è¿›è¡Œåˆ†æï¼Œæœ‰äº›åšä¸»æ²¡æœ‰åˆ—ä¸¾å‡ºæ¥çš„æ–¹æ³•ï¼Œå»ºè®®éœ€è¦ç‚¹è¿›å»çœ‹ä¸€çœ‹ã€‚</span></p><p><span>å¦å¤–ï¼Œæœ‰ä¸ç†è§£çš„åœ°æ–¹éšæ—¶æ¬¢è¿ï¼Œç§ä¿¡åšä¸»ã€‚å¦‚æœ‰é”™è¯¯ä¹Ÿæ¬¢è¿æŒ‡æ­£ã€‚ğŸ™†â€â™€ï¸</span></p><h2><a name="ä¸‹ä¸€ç¯‡é¢„å‘Šæ·±å…¥ç†è§£åç¨‹çš„æŒ‚èµ·å’Œæ¢å¤ğŸ¦¾" class="md-header-anchor"></a><strong><span>ä¸‹ä¸€ç¯‡é¢„å‘Š</span></strong><span>ï¼šæ·±å…¥ç†è§£åç¨‹çš„æŒ‚èµ·å’Œæ¢å¤ğŸ¦¾</span></h2><h2><a name="repeatonlifecycle-apiè¯¦è§£è¯´æ˜" class="md-header-anchor"></a><span>repeatOnLifecycle APIè¯¦è§£è¯´æ˜</span></h2><p><strong><span>æºç ï¼š</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">suspend</span> <span class="cm-keyword">fun</span> <span class="cm-def">Lifecycle</span>.<span class="cm-variable">repeatOnLifecycle</span>(</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">state</span>: <span class="cm-variable">Lifecycle</span>.<span class="cm-variable">State</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">block</span>: <span class="cm-keyword">suspend</span> <span class="cm-variable">CoroutineScope</span>.() <span class="cm-operator">-&gt;</span> <span class="cm-variable">Unit</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">require</span>(<span class="cm-variable">state</span> <span class="cm-operator">!==</span> <span class="cm-variable">Lifecycle</span>.<span class="cm-variable">State</span>.<span class="cm-variable">INITIALIZED</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"repeatOnLifecycle cannot start work with the INITIALIZED lifecycle state."</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">currentState</span> <span class="cm-operator">===</span> <span class="cm-variable">Lifecycle</span>.<span class="cm-variable">State</span>.<span class="cm-variable">DESTROYED</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">coroutineScope</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">withContext</span>(<span class="cm-variable">Dispatchers</span>.<span class="cm-variable">Main</span>.<span class="cm-variable">immediate</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// Check the current state of the lifecycle as the previous check is not guaranteed</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// to be done on the main thread.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">currentState</span> <span class="cm-operator">===</span> <span class="cm-variable">Lifecycle</span>.<span class="cm-variable">State</span>.<span class="cm-variable">DESTROYED</span>) <span class="cm-keyword">return</span><span class="cm-variable">@withContext</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// Instance of the running repeating coroutine</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">launchedJob</span>: <span class="cm-variable">Job</span><span class="cm-operator">?</span> <span class="cm-operator">=</span> <span class="cm-atom">null</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// Registered observer</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">observer</span>: <span class="cm-variable">LifecycleEventObserver</span><span class="cm-operator">?</span> <span class="cm-operator">=</span> <span class="cm-atom">null</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â€‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// Suspend the coroutine until the lifecycle is destroyed or</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// the coroutine is cancelled</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">suspendCancellableCoroutine</span><span class="cm-operator">&lt;</span><span class="cm-variable">Unit</span><span class="cm-operator">&gt;</span> { <span class="cm-variable">cont</span> <span class="cm-operator">-&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// Lifecycle observers that executes `block` when the lifecycle reaches certain state, and</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// cancels when it moves falls below that state.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">startWorkEvent</span> <span class="cm-operator">=</span> <span class="cm-variable">Lifecycle</span>.<span class="cm-variable">Event</span>.<span class="cm-variable">upTo</span>(<span class="cm-variable">state</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">cancelWorkEvent</span> <span class="cm-operator">=</span> <span class="cm-variable">Lifecycle</span>.<span class="cm-variable">Event</span>.<span class="cm-variable">downFrom</span>(<span class="cm-variable">state</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">observer</span> <span class="cm-operator">=</span> <span class="cm-variable">LifecycleEventObserver</span> { <span class="cm-variable">_</span>, <span class="cm-variable">event</span> <span class="cm-operator">-&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">event</span> <span class="cm-operator">==</span> <span class="cm-variable">startWorkEvent</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// Launch the repeating work preserving the calling context</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">launchedJob</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span><span class="cm-variable">@coroutineScope</span>.<span class="cm-variable">launch</span>(<span class="cm-variable">block</span> <span class="cm-operator">=</span> <span class="cm-variable">block</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span><span class="cm-variable">@LifecycleEventObserver</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">event</span> <span class="cm-operator">==</span> <span class="cm-variable">cancelWorkEvent</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">launchedJob</span><span class="cm-operator">?</span>.<span class="cm-variable">cancel</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">launchedJob</span> <span class="cm-operator">=</span> <span class="cm-atom">null</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">event</span> <span class="cm-operator">==</span> <span class="cm-variable">Lifecycle</span>.<span class="cm-variable">Event</span>.<span class="cm-variable">ON_DESTROY</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cont</span>.<span class="cm-variable">resume</span>(<span class="cm-variable">Unit</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span><span class="cm-variable">@repeatOnLifecycle</span>.<span class="cm-variable">addObserver</span>(<span class="cm-variable">observer</span> <span class="cm-keyword">as</span> <span class="cm-variable">LifecycleEventObserver</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">finally</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">launchedJob</span><span class="cm-operator">?</span>.<span class="cm-variable">cancel</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">observer</span><span class="cm-operator">?</span>.<span class="cm-variable">let</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span><span class="cm-variable">@repeatOnLifecycle</span>.<span class="cm-variable">removeObserver</span>(<span class="cm-variable">it</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1254px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1254px;"></div></div></div></pre><p>&nbsp;</p><h1><a name="ä¸€ä¸ªä¸ä¼šäº§ç”Ÿæ•°ç»„æº¢å‡ºçš„æ•°ç»„ä½¿ç”¨æ‰©å®¹æ–¹æ¡ˆ" class="md-header-anchor"></a><span>ä¸€ä¸ªä¸ä¼šäº§ç”Ÿæ•°ç»„æº¢å‡ºçš„æ•°ç»„ä½¿ç”¨æ‰©å®¹æ–¹æ¡ˆ</span></h1><p><span>çœ‹æºç é‡Œé¢å­˜åœ¨è¿™æ ·çš„ä¸€ä¸ªå‡½æ•°</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">æºç é‡Œé¢arrayçš„å®¹é‡å§‹ç»ˆä¸º2^n</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span> <span class="cm-keyword">fun</span> <span class="cm-def">Array</span><span class="cm-operator">&lt;</span><span class="cm-variable">Any</span><span class="cm-operator">?&gt;</span>.<span class="cm-variable">getBufferAt</span>(<span class="cm-variable">index</span>: <span class="cm-variable-3">Long</span>) <span class="cm-operator">=</span> <span class="cm-keyword">get</span>(<span class="cm-variable">index</span>.<span class="cm-variable">toInt</span>() <span class="cm-variable">and</span> (<span class="cm-variable">size</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span> <span class="cm-keyword">fun</span> <span class="cm-def">Array</span><span class="cm-operator">&lt;</span><span class="cm-variable">Any</span><span class="cm-operator">?&gt;</span>.<span class="cm-variable">setBufferAt</span>(<span class="cm-variable">index</span>: <span class="cm-variable-3">Long</span>, <span class="cm-variable">item</span>: <span class="cm-variable">Any</span><span class="cm-operator">?</span>) <span class="cm-operator">=</span> <span class="cm-keyword">set</span>(<span class="cm-variable">index</span>.<span class="cm-variable">toInt</span>() <span class="cm-variable">and</span> (<span class="cm-variable">size</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>), <span class="cm-variable">item</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p><span>ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</span></p><p><span>æˆ‘ä»¬çŸ¥é“</span><code>a % b = a &amp; (b - 1)</code><span>åœ¨bä¸º2^næ—¶æˆç«‹ã€‚</span></p><p><span>å› ä¸ºæºç é‡Œé¢arrayçš„å®¹é‡å§‹ç»ˆä¸º2^nï¼Œæ‰€ä»¥ä¸Šè¿°get å’Œ set çš„indexå‡ä¸º </span><code>a % b</code><span>ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆå†™å‘¢ï¼Ÿ</span></p><p><span>ä¸‹é¢æˆ‘ä»¬å†™ä¸ªä¾‹å­çœ‹çœ‹ç»“æœğŸ™†â€â™€ï¸</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">intArray</span> <span class="cm-operator">=</span> <span class="cm-variable">Array</span>(<span class="cm-number">2</span>) { <span class="cm-variable">it</span> <span class="cm-operator">+</span> <span class="cm-number">1</span> }</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-number">0.</span>.<span class="cm-number">10</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-variable">intArray</span>[<span class="cm-variable">i</span> <span class="cm-variable">and</span> (<span class="cm-variable">intArray</span>.<span class="cm-variable">size</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>)])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//ç»“æœ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">1</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 352px;"></div><div class="CodeMirror-gutters" style="display: none; height: 352px;"></div></div></div></pre><p><span>çœ‹å¾—å‡ºï¼Œå–ä½™çš„æ—¶å€™ï¼Œæ°¸è¿œå°±æ²¡æœ‰æ•°ç»„è¶Šç•Œäº†ã€‚ğŸ˜®</span></p><p><span>ä½†æ˜¯ï¼Œä½¿ç”¨ä½è¿ç®—ç¬¦çš„æ–¹å¼ï¼Œåªèƒ½åœ¨bä¸º2^næ—¶æˆç«‹ï¼Œæ‰€ä»¥å¦‚æœæƒ³è¦ä»»ä½•é€‚åˆéƒ½å¯ä»¥ä½¿ç”¨çš„è¯ï¼Œå¯ä»¥ç›´æ¥å–ä½™ä¸é€šè¿‡ä½è¿ç®—ç¬¦ã€‚</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="kotlin" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="kotlin"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">val</span> <span class="cm-def">intArray</span> <span class="cm-operator">=</span> <span class="cm-variable">Array</span>(<span class="cm-number">3</span>) { <span class="cm-variable">it</span> <span class="cm-operator">+</span> <span class="cm-number">1</span> }</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-number">0.</span>.<span class="cm-number">10</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">println</span>(<span class="cm-variable">intArray</span>[<span class="cm-variable">i</span> <span class="cm-operator">%</span> <span class="cm-variable">intArray</span>.<span class="cm-variable">size</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//ç»“æœ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">2</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 352px;"></div><div class="CodeMirror-gutters" style="display: none; height: 352px;"></div></div></div></pre><p><strong><span>æ€»ç»“</span></strong></p><p><span>å¦‚æœä½ ä¸æƒ³è‡ªå·±å°è£…çš„ä»£ç åœ¨æ•°ç»„è¿™ä¸€å—å‡ºç°æ•°ç»„è¶Šç•Œå¼‚å¸¸çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ä½™æ•°åšå¤„ç†ã€‚</span></p><p><strong><span>å¦‚æœä½ ç¡®å®šè‡ªå·±çš„æ•°ç»„å®¹é‡å§‹ç»ˆä»¥æ—¶2çš„å€æ•°ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ä½è¿ç®—ç¬¦è¿›è¡Œå–ä½™æ“ä½œã€‚å¦åˆ™å¯ä»¥ç›´æ¥å–ä½™</span></strong><span>ã€‚ğŸ‘€</span></p><p><span>çœ‹æºç çœ‹åˆ°çš„ï¼Œåˆ†äº«ä¸€ä¸‹ å“ˆå“ˆå“ˆå“ˆã€‚</span></p><p>&nbsp;</p></div>
</body>
</html>